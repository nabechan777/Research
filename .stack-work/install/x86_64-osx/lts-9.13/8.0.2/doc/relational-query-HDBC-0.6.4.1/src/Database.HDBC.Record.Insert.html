<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-4"></a><span class="hs-comment">-- Module      : Database.HDBC.Record.Insert</span><span>
</span><a name="line-5"></a><span class="hs-comment">-- Copyright   : 2013 Kei Hibino</span><span>
</span><a name="line-6"></a><span class="hs-comment">-- License     : BSD3</span><span>
</span><a name="line-7"></a><span class="hs-comment">--</span><span>
</span><a name="line-8"></a><span class="hs-comment">-- Maintainer  : ex8k.hibino@gmail.com</span><span>
</span><a name="line-9"></a><span class="hs-comment">-- Stability   : experimental</span><span>
</span><a name="line-10"></a><span class="hs-comment">-- Portability : unknown</span><span>
</span><a name="line-11"></a><span class="hs-comment">--</span><span>
</span><a name="line-12"></a><span class="hs-comment">-- This module provides typed 'Insert' running sequence</span><span>
</span><a name="line-13"></a><span class="hs-comment">-- which intermediate structures are typed.</span><span>
</span><a name="line-14"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">HDBC</span><span class="hs-operator">.</span><span class="hs-identifier">Record</span><span class="hs-operator">.</span><span class="hs-identifier">Insert</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-15"></a><span>  </span><a href="Database.HDBC.Record.Insert.html#PreparedInsert"><span class="hs-identifier hs-type">PreparedInsert</span></a><span class="hs-special">,</span><span> </span><a href="Database.HDBC.Record.Insert.html#prepare"><span class="hs-identifier hs-var">prepare</span></a><span class="hs-special">,</span><span> </span><a href="Database.HDBC.Record.Insert.html#prepareInsert"><span class="hs-identifier hs-var">prepareInsert</span></a><span class="hs-special">,</span><span>
</span><a name="line-16"></a><span>
</span><a name="line-17"></a><span>  </span><a href="Database.HDBC.Record.Insert.html#runPreparedInsert"><span class="hs-identifier hs-var">runPreparedInsert</span></a><span class="hs-special">,</span><span> </span><a href="Database.HDBC.Record.Insert.html#runInsert"><span class="hs-identifier hs-var">runInsert</span></a><span class="hs-special">,</span><span> </span><a href="Database.HDBC.Record.Insert.html#mapInsert"><span class="hs-identifier hs-var">mapInsert</span></a><span class="hs-special">,</span><span>
</span><a name="line-18"></a><span>
</span><a name="line-19"></a><span>  </span><a href="Database.HDBC.Record.Insert.html#chunksInsert"><span class="hs-identifier hs-var">chunksInsert</span></a><span class="hs-special">,</span><span>
</span><a name="line-20"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-21"></a><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">HDBC</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IConnection</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">SqlValue</span><span class="hs-special">)</span><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">Relational</span><span class="hs-operator">.</span><span class="hs-identifier">Query</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Insert</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">untypeChunkInsert</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">chunkSizeOfInsert</span><span class="hs-special">)</span><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">Record</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ToSql</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">fromRecord</span><span class="hs-special">)</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><a href="Database.HDBC.Record.Statement.html"><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">HDBC</span><span class="hs-operator">.</span><span class="hs-identifier">Record</span><span class="hs-operator">.</span><span class="hs-identifier">Statement</span></a><span>
</span><a name="line-28"></a><span>  </span><span class="hs-special">(</span><a href="Database.HDBC.Record.Statement.html#prepareNoFetch"><span class="hs-identifier hs-var">prepareNoFetch</span></a><span class="hs-special">,</span><span> </span><a href="Database.HDBC.Record.Statement.html#withPrepareNoFetch"><span class="hs-identifier hs-var">withPrepareNoFetch</span></a><span class="hs-special">,</span><span> </span><a href="Database.HDBC.Record.Statement.html#withUnsafePrepare"><span class="hs-identifier hs-var">withUnsafePrepare</span></a><span class="hs-special">,</span><span> </span><a href="Database.HDBC.Record.Statement.html#PreparedStatement"><span class="hs-identifier hs-type">PreparedStatement</span></a><span class="hs-special">,</span><span> </span><a href="Database.HDBC.Record.Statement.html#untypePrepared"><span class="hs-identifier hs-var">untypePrepared</span></a><span class="hs-special">,</span><span>
</span><a name="line-29"></a><span>   </span><a href="Database.HDBC.Record.Statement.html#BoundStatement"><span class="hs-identifier hs-type">BoundStatement</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Database.HDBC.Record.Statement.html#runPreparedNoFetch"><span class="hs-identifier hs-var">runPreparedNoFetch</span></a><span class="hs-special">,</span><span> </span><a href="Database.HDBC.Record.Statement.html#runNoFetch"><span class="hs-identifier hs-var">runNoFetch</span></a><span class="hs-special">,</span><span> </span><a href="Database.HDBC.Record.Statement.html#mapNoFetch"><span class="hs-identifier hs-var">mapNoFetch</span></a><span class="hs-special">,</span><span> </span><a href="Database.HDBC.Record.Statement.html#executeNoFetch"><span class="hs-identifier hs-var">executeNoFetch</span></a><span class="hs-special">)</span><span>
</span><a name="line-30"></a><span>
</span><a name="line-31"></a><span>
</span><a name="line-32"></a><span class="hs-comment">-- | Typed prepared insert type.</span><span>
</span><a name="line-33"></a><span class="hs-keyword">type</span><span> </span><a name="PreparedInsert"><a href="Database.HDBC.Record.Insert.html#PreparedInsert"><span class="hs-identifier">PreparedInsert</span></a></a><span> </span><a name="local-6989586621679295048"><a href="#local-6989586621679295048"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Database.HDBC.Record.Statement.html#PreparedStatement"><span class="hs-identifier hs-type">PreparedStatement</span></a><span> </span><a href="#local-6989586621679295048"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span class="hs-comment">-- | Typed prepare insert operation.</span><span>
</span><a name="line-36"></a><span class="hs-identifier">prepare</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IConnection</span><span> </span><a href="#local-6989586621679295065"><span class="hs-identifier hs-type">conn</span></a><span>
</span><a name="line-37"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679295065"><span class="hs-identifier hs-type">conn</span></a><span>
</span><a name="line-38"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Insert</span><span> </span><a href="#local-6989586621679295066"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-39"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="Database.HDBC.Record.Insert.html#PreparedInsert"><span class="hs-identifier hs-type">PreparedInsert</span></a><span> </span><a href="#local-6989586621679295066"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-40"></a><a name="prepare"><a href="Database.HDBC.Record.Insert.html#prepare"><span class="hs-identifier">prepare</span></a></a><span> </span><span class="hs-glyph">=</span><span>  </span><a href="Database.HDBC.Record.Statement.html#prepareNoFetch"><span class="hs-identifier hs-var">prepareNoFetch</span></a><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a><span class="hs-comment">-- | Same as 'prepare'.</span><span>
</span><a name="line-43"></a><span class="hs-identifier">prepareInsert</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IConnection</span><span> </span><a href="#local-6989586621679295063"><span class="hs-identifier hs-type">conn</span></a><span>
</span><a name="line-44"></a><span>              </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679295063"><span class="hs-identifier hs-type">conn</span></a><span>
</span><a name="line-45"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Insert</span><span> </span><a href="#local-6989586621679295064"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-46"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="Database.HDBC.Record.Insert.html#PreparedInsert"><span class="hs-identifier hs-type">PreparedInsert</span></a><span> </span><a href="#local-6989586621679295064"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-47"></a><a name="prepareInsert"><a href="Database.HDBC.Record.Insert.html#prepareInsert"><span class="hs-identifier">prepareInsert</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Database.HDBC.Record.Insert.html#prepare"><span class="hs-identifier hs-var">prepare</span></a><span>
</span><a name="line-48"></a><span>
</span><a name="line-49"></a><span class="hs-comment">-- | Bind parameters, execute statement and get execution result.</span><span>
</span><a name="line-50"></a><span class="hs-identifier">runPreparedInsert</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ToSql</span><span> </span><span class="hs-identifier hs-type">SqlValue</span><span> </span><a href="#local-6989586621679295062"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-51"></a><span>                  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Database.HDBC.Record.Insert.html#PreparedInsert"><span class="hs-identifier hs-type">PreparedInsert</span></a><span> </span><a href="#local-6989586621679295062"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-52"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679295062"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-53"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-54"></a><a name="runPreparedInsert"><a href="Database.HDBC.Record.Insert.html#runPreparedInsert"><span class="hs-identifier">runPreparedInsert</span></a></a><span> </span><span class="hs-glyph">=</span><span>  </span><a href="Database.HDBC.Record.Statement.html#runPreparedNoFetch"><span class="hs-identifier hs-var">runPreparedNoFetch</span></a><span>
</span><a name="line-55"></a><span>
</span><a name="line-56"></a><span class="hs-comment">-- | Prepare insert statement, bind parameters,</span><span>
</span><a name="line-57"></a><span class="hs-comment">--   execute statement and get execution result.</span><span>
</span><a name="line-58"></a><span class="hs-identifier">runInsert</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IConnection</span><span> </span><a href="#local-6989586621679295060"><span class="hs-identifier hs-type">conn</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">ToSql</span><span> </span><span class="hs-identifier hs-type">SqlValue</span><span> </span><a href="#local-6989586621679295061"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-59"></a><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679295060"><span class="hs-identifier hs-type">conn</span></a><span>
</span><a name="line-60"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Insert</span><span> </span><a href="#local-6989586621679295061"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-61"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679295061"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-62"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-63"></a><a name="runInsert"><a href="Database.HDBC.Record.Insert.html#runInsert"><span class="hs-identifier">runInsert</span></a></a><span> </span><span class="hs-glyph">=</span><span>  </span><a href="Database.HDBC.Record.Statement.html#runNoFetch"><span class="hs-identifier hs-var">runNoFetch</span></a><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span class="hs-comment">-- | Prepare and insert each record.</span><span>
</span><a name="line-66"></a><span class="hs-identifier">mapInsert</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IConnection</span><span> </span><a href="#local-6989586621679295058"><span class="hs-identifier hs-type">conn</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">ToSql</span><span> </span><span class="hs-identifier hs-type">SqlValue</span><span> </span><a href="#local-6989586621679295059"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-67"></a><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679295058"><span class="hs-identifier hs-type">conn</span></a><span>
</span><a name="line-68"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Insert</span><span> </span><a href="#local-6989586621679295059"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-69"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295059"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-70"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">]</span><span>
</span><a name="line-71"></a><a name="mapInsert"><a href="Database.HDBC.Record.Insert.html#mapInsert"><span class="hs-identifier">mapInsert</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Database.HDBC.Record.Statement.html#mapNoFetch"><span class="hs-identifier hs-var">mapNoFetch</span></a><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span>
</span><a name="line-74"></a><span class="hs-comment">-- | Unsafely bind chunk of records.</span><span>
</span><a name="line-75"></a><span class="hs-identifier">chunkBind</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ToSql</span><span> </span><span class="hs-identifier hs-type">SqlValue</span><span> </span><a href="#local-6989586621679295057"><span class="hs-identifier hs-type">p</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Database.HDBC.Record.Statement.html#PreparedStatement"><span class="hs-identifier hs-type">PreparedStatement</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295057"><span class="hs-identifier hs-type">p</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295057"><span class="hs-identifier hs-type">p</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.HDBC.Record.Statement.html#BoundStatement"><span class="hs-identifier hs-type">BoundStatement</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-76"></a><a name="chunkBind"><a href="Database.HDBC.Record.Insert.html#chunkBind"><span class="hs-identifier">chunkBind</span></a></a><span> </span><a name="local-6989586621679295067"><a href="#local-6989586621679295067"><span class="hs-identifier">q</span></a></a><span> </span><a name="local-6989586621679295068"><a href="#local-6989586621679295068"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Database.HDBC.Record.Statement.html#BoundStatement"><span class="hs-identifier hs-var">BoundStatement</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">bound</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Database.HDBC.Record.Statement.html#untypePrepared"><span class="hs-identifier hs-var">untypePrepared</span></a><span> </span><a href="#local-6989586621679295067"><span class="hs-identifier hs-var">q</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">params</span><span> </span><span class="hs-glyph">=</span><span>  </span><a href="#local-6989586621679295068"><span class="hs-identifier hs-var">ps</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-identifier hs-var">fromRecord</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-77"></a><span>
</span><a name="line-78"></a><span class="hs-identifier">chunks</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295056"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295056"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295056"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-79"></a><a name="chunks"><a href="Database.HDBC.Record.Insert.html#chunks"><span class="hs-identifier">chunks</span></a></a><span> </span><a name="local-6989586621679295069"><a href="#local-6989586621679295069"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679295070"><span class="hs-identifier hs-var">rec'</span></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-80"></a><span>  </span><a name="local-6989586621679295070"><a href="#local-6989586621679295070"><span class="hs-identifier">rec'</span></a></a><span> </span><a name="local-6989586621679295071"><a href="#local-6989586621679295071"><span class="hs-identifier">xs</span></a></a><span>
</span><a name="line-81"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679295073"><span class="hs-identifier hs-var">tl</span></a><span>    </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">[</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679295072"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679295069"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-82"></a><span>                      </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621679295072"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-83"></a><span>                      </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">Left</span><span>  </span><a href="#local-6989586621679295072"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-84"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>  </span><span class="hs-glyph">=</span><span>  </span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621679295072"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679295070"><span class="hs-identifier hs-var">rec'</span></a><span> </span><a href="#local-6989586621679295073"><span class="hs-identifier hs-var">tl</span></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-85"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621679295072"><a href="#local-6989586621679295072"><span class="hs-identifier">c</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679295073"><a href="#local-6989586621679295073"><span class="hs-identifier">tl</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">splitAt</span><span> </span><a href="#local-6989586621679295069"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679295071"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-86"></a><span>
</span><a name="line-87"></a><span class="hs-identifier">withPrepareChunksInsert</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IConnection</span><span> </span><a href="#local-6989586621679295052"><span class="hs-identifier hs-type">conn</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">ToSql</span><span> </span><span class="hs-identifier hs-type">SqlValue</span><span> </span><a href="#local-6989586621679295053"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-88"></a><span>                        </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679295052"><span class="hs-identifier hs-type">conn</span></a><span>
</span><a name="line-89"></a><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Insert</span><span> </span><a href="#local-6989586621679295053"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-90"></a><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Database.HDBC.Record.Insert.html#PreparedInsert"><span class="hs-identifier hs-type">PreparedInsert</span></a><span> </span><a href="#local-6989586621679295053"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.HDBC.Record.Statement.html#PreparedStatement"><span class="hs-identifier hs-type">PreparedStatement</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295054"><span class="hs-identifier hs-type">p</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679295055"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-91"></a><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679295055"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-92"></a><a name="withPrepareChunksInsert"><a href="Database.HDBC.Record.Insert.html#withPrepareChunksInsert"><span class="hs-identifier">withPrepareChunksInsert</span></a></a><span> </span><a name="local-6989586621679295074"><a href="#local-6989586621679295074"><span class="hs-identifier">conn</span></a></a><span> </span><a name="local-6989586621679295075"><a href="#local-6989586621679295075"><span class="hs-identifier">i0</span></a></a><span> </span><a name="local-6989586621679295076"><a href="#local-6989586621679295076"><span class="hs-identifier">body</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-93"></a><span>  </span><a href="Database.HDBC.Record.Statement.html#withPrepareNoFetch"><span class="hs-identifier hs-var">withPrepareNoFetch</span></a><span> </span><a href="#local-6989586621679295074"><span class="hs-identifier hs-var">conn</span></a><span> </span><a href="#local-6989586621679295075"><span class="hs-identifier hs-var">i0</span></a><span>
</span><a name="line-94"></a><span>  </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679295077"><a href="#local-6989586621679295077"><span class="hs-identifier">ins</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.HDBC.Record.Statement.html#withUnsafePrepare"><span class="hs-identifier hs-var">withUnsafePrepare</span></a><span> </span><a href="#local-6989586621679295074"><span class="hs-identifier hs-var">conn</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">untypeChunkInsert</span><span> </span><a href="#local-6989586621679295075"><span class="hs-identifier hs-var">i0</span></a><span class="hs-special">)</span><span>
</span><a name="line-95"></a><span>           </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679295078"><a href="#local-6989586621679295078"><span class="hs-identifier">iChunk</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679295076"><span class="hs-identifier hs-var">body</span></a><span> </span><a href="#local-6989586621679295077"><span class="hs-identifier hs-var">ins</span></a><span> </span><a href="#local-6989586621679295078"><span class="hs-identifier hs-var">iChunk</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">chunkSizeOfInsert</span><span> </span><a href="#local-6989586621679295075"><span class="hs-identifier hs-var">i0</span></a><span class="hs-special">)</span><span>  </span><span class="hs-special">)</span><span>
</span><a name="line-96"></a><span>
</span><a name="line-97"></a><span class="hs-comment">-- Prepare and insert with chunk insert statement.</span><span>
</span><a name="line-98"></a><span class="hs-identifier">chunksInsertActions</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ToSql</span><span> </span><span class="hs-identifier hs-type">SqlValue</span><span> </span><a href="#local-6989586621679295051"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-99"></a><span>                 </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295051"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-100"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.HDBC.Record.Insert.html#PreparedInsert"><span class="hs-identifier hs-type">PreparedInsert</span></a><span> </span><a href="#local-6989586621679295051"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-101"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.HDBC.Record.Statement.html#PreparedStatement"><span class="hs-identifier hs-type">PreparedStatement</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295051"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-102"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-103"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-104"></a><a name="chunksInsertActions"><a href="Database.HDBC.Record.Insert.html#chunksInsertActions"><span class="hs-identifier">chunksInsertActions</span></a></a><span> </span><a name="local-6989586621679295079"><a href="#local-6989586621679295079"><span class="hs-identifier">rs</span></a></a><span> </span><a name="local-6989586621679295080"><a href="#local-6989586621679295080"><span class="hs-identifier">ins</span></a></a><span> </span><a name="local-6989586621679295081"><a href="#local-6989586621679295081"><span class="hs-identifier">iChunk</span></a></a><span> </span><a name="local-6989586621679295082"><a href="#local-6989586621679295082"><span class="hs-identifier">size</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-105"></a><span>    </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621679295083"><span class="hs-identifier hs-var">insert</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Database.HDBC.Record.Insert.html#chunks"><span class="hs-identifier hs-var">chunks</span></a><span> </span><a href="#local-6989586621679295082"><span class="hs-identifier hs-var">size</span></a><span> </span><a href="#local-6989586621679295079"><span class="hs-identifier hs-var">rs</span></a><span>
</span><a name="line-106"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-107"></a><span>    </span><a name="local-6989586621679295083"><a href="#local-6989586621679295083"><span class="hs-identifier">insert</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679295084"><a href="#local-6989586621679295084"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-108"></a><span>      </span><a name="local-6989586621679295085"><a href="#local-6989586621679295085"><span class="hs-identifier">rv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.HDBC.Record.Statement.html#executeNoFetch"><span class="hs-identifier hs-var">executeNoFetch</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Database.HDBC.Record.Insert.html#chunkBind"><span class="hs-identifier hs-var">chunkBind</span></a><span> </span><a href="#local-6989586621679295081"><span class="hs-identifier hs-var">iChunk</span></a><span> </span><a href="#local-6989586621679295084"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-109"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295085"><span class="hs-identifier hs-var">rv</span></a><span class="hs-special">]</span><span>
</span><a name="line-110"></a><span>    </span><span class="hs-identifier">insert</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span>  </span><a name="local-6989586621679295086"><a href="#local-6989586621679295086"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-111"></a><span>      </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="Database.HDBC.Record.Insert.html#runPreparedInsert"><span class="hs-identifier hs-var">runPreparedInsert</span></a><span> </span><a href="#local-6989586621679295080"><span class="hs-identifier hs-var">ins</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679295086"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-112"></a><span>
</span><a name="line-113"></a><span class="hs-comment">-- | Prepare and insert with chunk insert statement.</span><span>
</span><a name="line-114"></a><span class="hs-identifier">chunksInsert</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IConnection</span><span> </span><a href="#local-6989586621679295049"><span class="hs-identifier hs-type">conn</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">ToSql</span><span> </span><span class="hs-identifier hs-type">SqlValue</span><span> </span><a href="#local-6989586621679295050"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679295049"><span class="hs-identifier hs-type">conn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Insert</span><span> </span><a href="#local-6989586621679295050"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679295050"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-115"></a><a name="chunksInsert"><a href="Database.HDBC.Record.Insert.html#chunksInsert"><span class="hs-identifier">chunksInsert</span></a></a><span> </span><a name="local-6989586621679295087"><a href="#local-6989586621679295087"><span class="hs-identifier">conn</span></a></a><span> </span><a name="local-6989586621679295088"><a href="#local-6989586621679295088"><span class="hs-identifier">ins</span></a></a><span> </span><a name="local-6989586621679295089"><a href="#local-6989586621679295089"><span class="hs-identifier">rs</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-116"></a><span>  </span><a href="Database.HDBC.Record.Insert.html#withPrepareChunksInsert"><span class="hs-identifier hs-var">withPrepareChunksInsert</span></a><span> </span><a href="#local-6989586621679295087"><span class="hs-identifier hs-var">conn</span></a><span> </span><a href="#local-6989586621679295088"><span class="hs-identifier hs-var">ins</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Database.HDBC.Record.Insert.html#chunksInsertActions"><span class="hs-identifier hs-var">chunksInsertActions</span></a><span> </span><a href="#local-6989586621679295089"><span class="hs-identifier hs-var">rs</span></a><span>
</span><a name="line-117"></a></pre></body></html>