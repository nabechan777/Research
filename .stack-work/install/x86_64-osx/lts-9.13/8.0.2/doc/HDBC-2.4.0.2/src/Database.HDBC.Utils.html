<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-2"></a><span class="hs-comment">-- #hide</span><span>
</span><a name="line-3"></a><span class="hs-comment">{- |
   Module     : Database.HDBC.Utils
   Copyright  : Copyright (C) 2005-2011 John Goerzen
   License    : BSD3

   Maintainer : John Goerzen &lt;jgoerzen@complete.org&gt;
   Stability  : provisional
   Portability: portable

Internal module -- not exported directly.

Everything in here is expoerted by &quot;Database.HDBC&quot;.  Please use -- and read --
&quot;Database.HDBC&quot; directly.

Written by John Goerzen, jgoerzen\@complete.org
-}</span><span>
</span><a name="line-19"></a><span>
</span><a name="line-20"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">HDBC</span><span class="hs-operator">.</span><span class="hs-identifier">Utils</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><a href="Database.HDBC.Types.html"><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">HDBC</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span></a><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Map</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Exception</span><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span class="hs-operator">.</span><span class="hs-identifier">Unsafe</span><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span class="hs-special">(</span><span class="hs-identifier hs-var">genericLength</span><span class="hs-special">)</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span class="hs-comment">-- import Data.Dynamic below for GHC &lt; 6.10</span><span>
</span><a name="line-28"></a><span>
</span><a name="line-29"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 610</span><span>
</span><a name="line-30"></a><span class="hs-comment">{- | Execute the given IO action.

If it raises a 'SqlError', then execute the supplied handler and return its
return value.  Otherwise, proceed as normal. -}</span><span>
</span><a name="line-34"></a><span class="hs-identifier">catchSql</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679055043"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Database.HDBC.Statement.html#SqlError"><span class="hs-identifier hs-type">SqlError</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679055043"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679055043"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-35"></a><a name="catchSql"><a href="Database.HDBC.Utils.html#catchSql"><span class="hs-identifier">catchSql</span></a></a><span> </span><a name="local-6989586621679055044"><a href="#local-6989586621679055044"><span class="hs-identifier">action</span></a></a><span> </span><a name="local-6989586621679055045"><a href="#local-6989586621679055045"><span class="hs-identifier">handler</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><a name="line-36"></a><span>    </span><span class="hs-identifier hs-var">catchJust</span><span> </span><a href="Database.HDBC.Utils.html#sqlExceptions"><span class="hs-identifier hs-var">sqlExceptions</span></a><span> </span><a href="#local-6989586621679055044"><span class="hs-identifier hs-var">action</span></a><span> </span><a href="#local-6989586621679055045"><span class="hs-identifier hs-var">handler</span></a><span>
</span><a name="line-37"></a><span>
</span><a name="line-38"></a><span class="hs-comment">{- | Like 'catchSql', with the order of arguments reversed. -}</span><span>
</span><a name="line-39"></a><span class="hs-identifier">handleSql</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Database.HDBC.Statement.html#SqlError"><span class="hs-identifier hs-type">SqlError</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679055042"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679055042"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679055042"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-40"></a><a name="handleSql"><a href="Database.HDBC.Utils.html#handleSql"><span class="hs-identifier">handleSql</span></a></a><span> </span><a name="local-6989586621679055046"><a href="#local-6989586621679055046"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679055047"><a href="#local-6989586621679055047"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Database.HDBC.Utils.html#catchSql"><span class="hs-identifier hs-var">catchSql</span></a><span> </span><a href="#local-6989586621679055047"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679055046"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a><span class="hs-comment">{- | Given an Exception, return Just SqlError if it was an SqlError, or Nothing
otherwise. Useful with functions like catchJust. -}</span><span>
</span><a name="line-44"></a><span class="hs-identifier">sqlExceptions</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.HDBC.Statement.html#SqlError"><span class="hs-identifier hs-type">SqlError</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Database.HDBC.Statement.html#SqlError"><span class="hs-identifier hs-type">SqlError</span></a><span>
</span><a name="line-45"></a><a name="sqlExceptions"><a href="Database.HDBC.Utils.html#sqlExceptions"><span class="hs-identifier">sqlExceptions</span></a></a><span> </span><a name="local-6989586621679055048"><a href="#local-6989586621679055048"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679055048"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-46"></a><span>
</span><a name="line-47"></a><span class="hs-cpp">#else</span><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Dynamic</span><span>
</span><a name="line-49"></a><span>
</span><a name="line-50"></a><span class="hs-comment">{- | Execute the given IO action.

If it raises a 'SqlError', then execute the supplied handler and return its
return value.  Otherwise, proceed as normal. -}</span><span>
</span><a name="line-54"></a><span class="hs-identifier">catchSql</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">SqlError</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">a</span><span>
</span><a name="line-55"></a><span class="hs-identifier">catchSql</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">catchDyn</span><span>
</span><a name="line-56"></a><span>
</span><a name="line-57"></a><span class="hs-comment">{- | Like 'catchSql', with the order of arguments reversed. -}</span><span>
</span><a name="line-58"></a><span class="hs-identifier">handleSql</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">SqlError</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">a</span><span>
</span><a name="line-59"></a><span class="hs-identifier">handleSql</span><span> </span><span class="hs-identifier">h</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">catchDyn</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">h</span><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span class="hs-comment">{- | Given an Exception, return Just SqlError if it was an SqlError, or Nothing
otherwise. Useful with functions like catchJust. -}</span><span>
</span><a name="line-63"></a><span class="hs-identifier">sqlExceptions</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Exception</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">SqlError</span><span>
</span><a name="line-64"></a><span class="hs-identifier">sqlExceptions</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">dynExceptions</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-operator">&gt;&gt;=</span><span> </span><span class="hs-identifier">fromDynamic</span><span>
</span><a name="line-65"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-66"></a><span>
</span><a name="line-67"></a><span class="hs-comment">{- | Catches 'SqlError's, and re-raises them as IO errors with fail.
Useful if you don't care to catch SQL errors, but want to see a sane
error message if one happens.  One would often use this as a high-level
wrapper around SQL calls. -}</span><span>
</span><a name="line-71"></a><span class="hs-identifier">handleSqlError</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679055041"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679055041"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-72"></a><a name="handleSqlError"><a href="Database.HDBC.Utils.html#handleSqlError"><span class="hs-identifier">handleSqlError</span></a></a><span> </span><a name="local-6989586621679055049"><a href="#local-6989586621679055049"><span class="hs-identifier">action</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-73"></a><span>    </span><a href="Database.HDBC.Utils.html#catchSql"><span class="hs-identifier hs-var">catchSql</span></a><span> </span><a href="#local-6989586621679055049"><span class="hs-identifier hs-var">action</span></a><span> </span><a href="#local-6989586621679055050"><span class="hs-identifier hs-var">handler</span></a><span>
</span><a name="line-74"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679055050"><a href="#local-6989586621679055050"><span class="hs-identifier">handler</span></a></a><span> </span><a name="local-6989586621679055051"><a href="#local-6989586621679055051"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;SQL error: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679055051"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-75"></a><span>
</span><a name="line-76"></a><span class="hs-comment">{- | Like 'run', but take a list of Maybe Strings instead of 'SqlValue's. -}</span><span>
</span><a name="line-77"></a><span class="hs-identifier">sRun</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.HDBC.Types.html#IConnection"><span class="hs-identifier hs-type">IConnection</span></a><span> </span><a href="#local-6989586621679055040"><span class="hs-identifier hs-type">conn</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679055040"><span class="hs-identifier hs-type">conn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-78"></a><a name="sRun"><a href="Database.HDBC.Utils.html#sRun"><span class="hs-identifier">sRun</span></a></a><span> </span><a name="local-6989586621679055052"><a href="#local-6989586621679055052"><span class="hs-identifier">conn</span></a></a><span> </span><a name="local-6989586621679055053"><a href="#local-6989586621679055053"><span class="hs-identifier">qry</span></a></a><span> </span><a name="local-6989586621679055054"><a href="#local-6989586621679055054"><span class="hs-identifier">lst</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-79"></a><span>    </span><a href="Database.HDBC.Types.html#run"><span class="hs-identifier hs-var">run</span></a><span> </span><a href="#local-6989586621679055052"><span class="hs-identifier hs-var">conn</span></a><span> </span><a href="#local-6989586621679055053"><span class="hs-identifier hs-var">qry</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Database.HDBC.SqlValue.html#toSql"><span class="hs-identifier hs-var">toSql</span></a><span> </span><a href="#local-6989586621679055054"><span class="hs-identifier hs-var">lst</span></a><span class="hs-special">)</span><span>
</span><a name="line-80"></a><span>
</span><a name="line-81"></a><span class="hs-comment">{- | Like 'execute', but take a list of Maybe Strings instead of
   'SqlValue's. -}</span><span>
</span><a name="line-83"></a><span class="hs-identifier">sExecute</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.HDBC.Statement.html#Statement"><span class="hs-identifier hs-type">Statement</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-84"></a><a name="sExecute"><a href="Database.HDBC.Utils.html#sExecute"><span class="hs-identifier">sExecute</span></a></a><span> </span><a name="local-6989586621679055055"><a href="#local-6989586621679055055"><span class="hs-identifier">sth</span></a></a><span> </span><a name="local-6989586621679055056"><a href="#local-6989586621679055056"><span class="hs-identifier">lst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">execute</span><span> </span><a href="#local-6989586621679055055"><span class="hs-identifier hs-var">sth</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Database.HDBC.SqlValue.html#toSql"><span class="hs-identifier hs-var">toSql</span></a><span> </span><a href="#local-6989586621679055056"><span class="hs-identifier hs-var">lst</span></a><span class="hs-special">)</span><span>
</span><a name="line-85"></a><span>
</span><a name="line-86"></a><span class="hs-comment">{- | Like 'executeMany', but take a list of Maybe Strings instead of
   'SqlValue's. -}</span><span>
</span><a name="line-88"></a><span class="hs-identifier">sExecuteMany</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.HDBC.Statement.html#Statement"><span class="hs-identifier hs-type">Statement</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-89"></a><a name="sExecuteMany"><a href="Database.HDBC.Utils.html#sExecuteMany"><span class="hs-identifier">sExecuteMany</span></a></a><span> </span><a name="local-6989586621679055057"><a href="#local-6989586621679055057"><span class="hs-identifier">sth</span></a></a><span> </span><a name="local-6989586621679055058"><a href="#local-6989586621679055058"><span class="hs-identifier">lst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><a name="line-90"></a><span>    </span><span class="hs-identifier">executeMany</span><span> </span><a href="#local-6989586621679055057"><span class="hs-identifier hs-var">sth</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Database.HDBC.SqlValue.html#toSql"><span class="hs-identifier hs-var">toSql</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055058"><span class="hs-identifier hs-var">lst</span></a><span class="hs-special">)</span><span>
</span><a name="line-91"></a><span>
</span><a name="line-92"></a><span class="hs-comment">{- | Like 'fetchRow', but return a list of Maybe Strings instead of
   'SqlValue's. -}</span><span>
</span><a name="line-94"></a><span class="hs-identifier">sFetchRow</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.HDBC.Statement.html#Statement"><span class="hs-identifier hs-type">Statement</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-95"></a><a name="sFetchRow"><a href="Database.HDBC.Utils.html#sFetchRow"><span class="hs-identifier">sFetchRow</span></a></a><span> </span><a name="local-6989586621679055059"><a href="#local-6989586621679055059"><span class="hs-identifier">sth</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-96"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679055060"><a href="#local-6989586621679055060"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">fetchRow</span><span> </span><a href="#local-6989586621679055059"><span class="hs-identifier hs-var">sth</span></a><span>
</span><a name="line-97"></a><span>       </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679055060"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-98"></a><span>         </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-99"></a><span>         </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679055061"><a href="#local-6989586621679055061"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Database.HDBC.SqlValue.html#fromSql"><span class="hs-identifier hs-var">fromSql</span></a><span> </span><a href="#local-6989586621679055061"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-100"></a><span>
</span><a name="line-101"></a><span class="hs-comment">{- | Execute some code.  If any uncaught exception occurs, run
'rollback' and re-raise it.  Otherwise, run 'commit' and return.

This function, therefore, encapsulates the logical property that a transaction
is all about: all or nothing.

The 'IConnection' object passed in is passed directly to the specified
function as a convenience.

This function traps /all/ uncaught exceptions, not just SqlErrors.  Therefore,
you will get a rollback for any exception that you don't handle.  That's
probably what you want anyway.

Since all operations in HDBC are done in a transaction, this function doesn't
issue an explicit \&quot;begin\&quot; to the server.  You should ideally have
called 'Database.HDBC.commit' or 'Database.HDBC.rollback' before
calling this function.  If you haven't, this function will commit or rollback
more than just the changes made in the included action.

If there was an error while running 'rollback', this error will not be
reported since the original exception will be propogated back.  (You'd probably
like to know about the root cause for all of this anyway.)  Feedback
on this behavior is solicited.
-}</span><span>
</span><a name="line-125"></a><span class="hs-identifier">withTransaction</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.HDBC.Types.html#IConnection"><span class="hs-identifier hs-type">IConnection</span></a><span> </span><a href="#local-6989586621679055038"><span class="hs-identifier hs-type">conn</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679055038"><span class="hs-identifier hs-type">conn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055038"><span class="hs-identifier hs-type">conn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679055039"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679055039"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-126"></a><a name="withTransaction"><a href="Database.HDBC.Utils.html#withTransaction"><span class="hs-identifier">withTransaction</span></a></a><span> </span><a name="local-6989586621679055062"><a href="#local-6989586621679055062"><span class="hs-identifier">conn</span></a></a><span> </span><a name="local-6989586621679055063"><a href="#local-6989586621679055063"><span class="hs-identifier">func</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-127"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 610</span><span>
</span><a name="line-128"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679055066"><a href="#local-6989586621679055066"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">onException</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055063"><span class="hs-identifier hs-var">func</span></a><span> </span><a href="#local-6989586621679055062"><span class="hs-identifier hs-var">conn</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055064"><span class="hs-identifier hs-var">doRollback</span></a><span>
</span><a name="line-129"></a><span>       </span><a href="Database.HDBC.Types.html#commit"><span class="hs-identifier hs-var">commit</span></a><span> </span><a href="#local-6989586621679055062"><span class="hs-identifier hs-var">conn</span></a><span>
</span><a name="line-130"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679055066"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-131"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679055064"><a href="#local-6989586621679055064"><span class="hs-identifier">doRollback</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><a name="line-132"></a><span>              </span><span class="hs-comment">-- Discard any exception from (rollback conn) so original</span><span>
</span><a name="line-133"></a><span>              </span><span class="hs-comment">-- exception can be re-raised</span><span>
</span><a name="line-134"></a><span>              </span><span class="hs-identifier hs-var">Control</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Exception</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">catch</span><span> </span><span class="hs-special">(</span><a href="Database.HDBC.Types.html#rollback"><span class="hs-identifier hs-var">rollback</span></a><span> </span><a href="#local-6989586621679055062"><span class="hs-identifier hs-var">conn</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055065"><span class="hs-identifier hs-var">doRollbackHandler</span></a><span>
</span><a name="line-135"></a><span>          </span><span class="hs-identifier">doRollbackHandler</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SomeException</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-136"></a><span>          </span><a name="local-6989586621679055065"><a href="#local-6989586621679055065"><span class="hs-identifier">doRollbackHandler</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-137"></a><span class="hs-cpp">#else</span><span>
</span><a name="line-138"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">r</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">try</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">func</span><span> </span><span class="hs-identifier">conn</span><span class="hs-special">)</span><span>
</span><a name="line-139"></a><span>       </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">r</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-140"></a><span>         </span><span class="hs-identifier">Right</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">commit</span><span> </span><span class="hs-identifier">conn</span><span>
</span><a name="line-141"></a><span>                       </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">x</span><span>
</span><a name="line-142"></a><span>         </span><span class="hs-identifier">Left</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span>
</span><a name="line-143"></a><span>             </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">try</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">rollback</span><span> </span><span class="hs-identifier">conn</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Discard any exception here</span><span>
</span><a name="line-144"></a><span>                </span><span class="hs-identifier">throw</span><span> </span><span class="hs-identifier">e</span><span>
</span><a name="line-145"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-146"></a><span class="hs-comment">{- | Lazily fetch all rows from an executed 'Statement'.

You can think of this as hGetContents applied to a database result set.

The result of this is a lazy list, and each new row will be read, lazily, from
the database as the list is processed.

When you have exhausted the list, the 'Statement' will be 'finish'ed.

Please note that the careless use of this function can lead to some unpleasant
behavior.  In particular, if you have not consumed the entire list, then
attempt to 'finish' or re-execute the statement, and then attempt to consume
more elements from the list, the result will almost certainly not be what
you want.

But then, similar caveats apply with hGetContents.

Bottom line: this is a very convenient abstraction; use it wisely.

Use 'fetchAllRows'' if you need something that is strict, without
all these caveats.
-}</span><span>
</span><a name="line-168"></a><span class="hs-identifier">fetchAllRows</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.HDBC.Statement.html#Statement"><span class="hs-identifier hs-type">Statement</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="Database.HDBC.SqlValue.html#SqlValue"><span class="hs-identifier hs-type">SqlValue</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-169"></a><a name="fetchAllRows"><a href="Database.HDBC.Utils.html#fetchAllRows"><span class="hs-identifier">fetchAllRows</span></a></a><span> </span><a name="local-6989586621679055067"><a href="#local-6989586621679055067"><span class="hs-identifier">sth</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unsafeInterleaveIO</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-170"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679055081"><a href="#local-6989586621679055081"><span class="hs-identifier">row</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">fetchRow</span><span> </span><a href="#local-6989586621679055067"><span class="hs-identifier hs-var">sth</span></a><span>
</span><a name="line-171"></a><span>       </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679055081"><span class="hs-identifier hs-var">row</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-172"></a><span>         </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-173"></a><span>         </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679055082"><a href="#local-6989586621679055082"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679055083"><a href="#local-6989586621679055083"><span class="hs-identifier">remainder</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.HDBC.Utils.html#fetchAllRows"><span class="hs-identifier hs-var">fetchAllRows</span></a><span> </span><a href="#local-6989586621679055067"><span class="hs-identifier hs-var">sth</span></a><span>
</span><a name="line-174"></a><span>                      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679055082"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679055083"><span class="hs-identifier hs-var">remainder</span></a><span class="hs-special">)</span><span>
</span><a name="line-175"></a><span>
</span><a name="line-176"></a><span class="hs-identifier">evalAll</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="#local-6989586621679055037"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-177"></a><a name="evalAll"><a href="Database.HDBC.Utils.html#evalAll"><span class="hs-identifier">evalAll</span></a></a><span> </span><a name="local-6989586621679055084"><a href="#local-6989586621679055084"><span class="hs-identifier">inp</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-178"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679055810"><a href="#local-6989586621679055810"><span class="hs-identifier">r1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">evaluate</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">genericLength</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055084"><span class="hs-identifier hs-var">inp</span></a><span>
</span><a name="line-179"></a><span>       </span><span class="hs-identifier hs-var">evaluate</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">sum</span><span> </span><a href="#local-6989586621679055810"><span class="hs-identifier hs-var">r1</span></a><span class="hs-special">)</span><span>
</span><a name="line-180"></a><span>
</span><a name="line-181"></a><span class="hs-comment">{- | Strict version of 'fetchAllRows'.  Does not have the side-effects
of 'fetchAllRows', but forces the entire result set to be buffered
in memory. -}</span><span>
</span><a name="line-184"></a><span class="hs-identifier">fetchAllRows'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.HDBC.Statement.html#Statement"><span class="hs-identifier hs-type">Statement</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="Database.HDBC.SqlValue.html#SqlValue"><span class="hs-identifier hs-type">SqlValue</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-185"></a><a name="fetchAllRows%27"><a href="Database.HDBC.Utils.html#fetchAllRows%27"><span class="hs-identifier">fetchAllRows'</span></a></a><span> </span><a name="local-6989586621679055811"><a href="#local-6989586621679055811"><span class="hs-identifier">sth</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-186"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679055812"><a href="#local-6989586621679055812"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.HDBC.Utils.html#fetchAllRows"><span class="hs-identifier hs-var">fetchAllRows</span></a><span> </span><a href="#local-6989586621679055811"><span class="hs-identifier hs-var">sth</span></a><span>
</span><a name="line-187"></a><span>       </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.HDBC.Utils.html#evalAll"><span class="hs-identifier hs-var">evalAll</span></a><span> </span><a href="#local-6989586621679055812"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-188"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679055812"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-189"></a><span>
</span><a name="line-190"></a><span class="hs-comment">{- | Like 'fetchAllRows', but return Maybe Strings instead of 'SqlValue's. -}</span><span>
</span><a name="line-191"></a><span class="hs-identifier">sFetchAllRows</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.HDBC.Statement.html#Statement"><span class="hs-identifier hs-type">Statement</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-192"></a><a name="sFetchAllRows"><a href="Database.HDBC.Utils.html#sFetchAllRows"><span class="hs-identifier">sFetchAllRows</span></a></a><span> </span><a name="local-6989586621679055813"><a href="#local-6989586621679055813"><span class="hs-identifier">sth</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-193"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679055814"><a href="#local-6989586621679055814"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.HDBC.Utils.html#fetchAllRows"><span class="hs-identifier hs-var">fetchAllRows</span></a><span> </span><a href="#local-6989586621679055813"><span class="hs-identifier hs-var">sth</span></a><span>
</span><a name="line-194"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Database.HDBC.SqlValue.html#fromSql"><span class="hs-identifier hs-var">fromSql</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055814"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-195"></a><span>
</span><a name="line-196"></a><span class="hs-comment">{- | Strict version of 'sFetchAllRows'. -}</span><span>
</span><a name="line-197"></a><span class="hs-identifier">sFetchAllRows'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.HDBC.Statement.html#Statement"><span class="hs-identifier hs-type">Statement</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-198"></a><a name="sFetchAllRows%27"><a href="Database.HDBC.Utils.html#sFetchAllRows%27"><span class="hs-identifier">sFetchAllRows'</span></a></a><span> </span><a name="local-6989586621679055815"><a href="#local-6989586621679055815"><span class="hs-identifier">sth</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-199"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679055816"><a href="#local-6989586621679055816"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.HDBC.Utils.html#sFetchAllRows"><span class="hs-identifier hs-var">sFetchAllRows</span></a><span> </span><a href="#local-6989586621679055815"><span class="hs-identifier hs-var">sth</span></a><span>
</span><a name="line-200"></a><span>       </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.HDBC.Utils.html#evalAll"><span class="hs-identifier hs-var">evalAll</span></a><span> </span><a href="#local-6989586621679055816"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-201"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679055816"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-202"></a><span>
</span><a name="line-203"></a><span class="hs-comment">{- | Like 'fetchRow', but instead of returning a list, return an association
list from column name to value.

The keys of the column names are lowercase versions of the data returned
by 'getColumnNames'.  Please heed the warnings there.  Additionally,
results are undefined if multiple columns are returned with identical names.
-}</span><span>
</span><a name="line-210"></a><span class="hs-identifier">fetchRowAL</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.HDBC.Statement.html#Statement"><span class="hs-identifier hs-type">Statement</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><a href="Database.HDBC.SqlValue.html#SqlValue"><span class="hs-identifier hs-type">SqlValue</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-211"></a><a name="fetchRowAL"><a href="Database.HDBC.Utils.html#fetchRowAL"><span class="hs-identifier">fetchRowAL</span></a></a><span> </span><a name="local-6989586621679055817"><a href="#local-6989586621679055817"><span class="hs-identifier">sth</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-212"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679055818"><a href="#local-6989586621679055818"><span class="hs-identifier">row</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">fetchRow</span><span> </span><a href="#local-6989586621679055817"><span class="hs-identifier hs-var">sth</span></a><span>
</span><a name="line-213"></a><span>       </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679055818"><span class="hs-identifier hs-var">row</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-214"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-215"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679055819"><a href="#local-6989586621679055819"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679055820"><a href="#local-6989586621679055820"><span class="hs-identifier">names</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getColumnNames</span><span> </span><a href="#local-6989586621679055817"><span class="hs-identifier hs-var">sth</span></a><span>
</span><a name="line-216"></a><span>                     </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><a href="#local-6989586621679055820"><span class="hs-identifier hs-var">names</span></a><span> </span><a href="#local-6989586621679055819"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-217"></a><span>
</span><a name="line-218"></a><span class="hs-comment">{- | Strict version of 'fetchRowAL'. -}</span><span>
</span><a name="line-219"></a><span class="hs-identifier">fetchRowAL'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.HDBC.Statement.html#Statement"><span class="hs-identifier hs-type">Statement</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><a href="Database.HDBC.SqlValue.html#SqlValue"><span class="hs-identifier hs-type">SqlValue</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-220"></a><a name="fetchRowAL%27"><a href="Database.HDBC.Utils.html#fetchRowAL%27"><span class="hs-identifier">fetchRowAL'</span></a></a><span> </span><a name="local-6989586621679055821"><a href="#local-6989586621679055821"><span class="hs-identifier">sth</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-221"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679055822"><a href="#local-6989586621679055822"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.HDBC.Utils.html#fetchRowAL"><span class="hs-identifier hs-var">fetchRowAL</span></a><span> </span><a href="#local-6989586621679055821"><span class="hs-identifier hs-var">sth</span></a><span>
</span><a name="line-222"></a><span>       </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679055822"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-223"></a><span>         </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-224"></a><span>         </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679055823"><a href="#local-6989586621679055823"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">evaluate</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-var">genericLength</span><span> </span><a href="#local-6989586621679055823"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-glyph">::</span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">)</span><span>
</span><a name="line-225"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679055822"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-226"></a><span>
</span><a name="line-227"></a><span class="hs-comment">{- | Similar to 'fetchRowAL', but return a Map instead of an association list.
-}</span><span>
</span><a name="line-229"></a><span class="hs-identifier">fetchRowMap</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.HDBC.Statement.html#Statement"><span class="hs-identifier hs-type">Statement</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Map</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><a href="Database.HDBC.SqlValue.html#SqlValue"><span class="hs-identifier hs-type">SqlValue</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-230"></a><a name="fetchRowMap"><a href="Database.HDBC.Utils.html#fetchRowMap"><span class="hs-identifier">fetchRowMap</span></a></a><span> </span><a name="local-6989586621679055824"><a href="#local-6989586621679055824"><span class="hs-identifier">sth</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><a name="line-231"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679055825"><a href="#local-6989586621679055825"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.HDBC.Utils.html#fetchRowAL"><span class="hs-identifier hs-var">fetchRowAL</span></a><span> </span><a href="#local-6989586621679055824"><span class="hs-identifier hs-var">sth</span></a><span>
</span><a name="line-232"></a><span>       </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679055825"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-233"></a><span>              </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-234"></a><span>              </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679055826"><a href="#local-6989586621679055826"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><a href="#local-6989586621679055826"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-235"></a><span>
</span><a name="line-236"></a><span class="hs-comment">{- | Strict version of 'fetchRowMap'. -}</span><span>
</span><a name="line-237"></a><span class="hs-identifier">fetchRowMap'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.HDBC.Statement.html#Statement"><span class="hs-identifier hs-type">Statement</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Map</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><a href="Database.HDBC.SqlValue.html#SqlValue"><span class="hs-identifier hs-type">SqlValue</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-238"></a><a name="fetchRowMap%27"><a href="Database.HDBC.Utils.html#fetchRowMap%27"><span class="hs-identifier">fetchRowMap'</span></a></a><span> </span><a name="local-6989586621679055827"><a href="#local-6989586621679055827"><span class="hs-identifier">sth</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><a name="line-239"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679055828"><a href="#local-6989586621679055828"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.HDBC.Utils.html#fetchRowMap"><span class="hs-identifier hs-var">fetchRowMap</span></a><span> </span><a href="#local-6989586621679055827"><span class="hs-identifier hs-var">sth</span></a><span>
</span><a name="line-240"></a><span>       </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679055828"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-241"></a><span>            </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-242"></a><span>            </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679055829"><a href="#local-6989586621679055829"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">evaluate</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-var">genericLength</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toList</span><span> </span><a href="#local-6989586621679055829"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-glyph">::</span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">)</span><span>
</span><a name="line-243"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679055828"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-244"></a><span>
</span><a name="line-245"></a><span class="hs-comment">{- | Like 'fetchAllRows', but instead of returning a list for each
row, return an association list for each row, from column name to value.

See 'fetchRowAL' for more details. -}</span><span>
</span><a name="line-249"></a><span class="hs-identifier">fetchAllRowsAL</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.HDBC.Statement.html#Statement"><span class="hs-identifier hs-type">Statement</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><a href="Database.HDBC.SqlValue.html#SqlValue"><span class="hs-identifier hs-type">SqlValue</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-250"></a><a name="fetchAllRowsAL"><a href="Database.HDBC.Utils.html#fetchAllRowsAL"><span class="hs-identifier">fetchAllRowsAL</span></a></a><span> </span><a name="local-6989586621679055830"><a href="#local-6989586621679055830"><span class="hs-identifier">sth</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-251"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679055831"><a href="#local-6989586621679055831"><span class="hs-identifier">names</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getColumnNames</span><span> </span><a href="#local-6989586621679055830"><span class="hs-identifier hs-var">sth</span></a><span>
</span><a name="line-252"></a><span>       </span><a name="local-6989586621679055832"><a href="#local-6989586621679055832"><span class="hs-identifier">rows</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.HDBC.Utils.html#fetchAllRows"><span class="hs-identifier hs-var">fetchAllRows</span></a><span> </span><a href="#local-6989586621679055830"><span class="hs-identifier hs-var">sth</span></a><span>
</span><a name="line-253"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">zip</span><span> </span><a href="#local-6989586621679055831"><span class="hs-identifier hs-var">names</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679055832"><span class="hs-identifier hs-var">rows</span></a><span>
</span><a name="line-254"></a><span>
</span><a name="line-255"></a><span class="hs-comment">{- | Strict version of 'fetchAllRowsAL' -}</span><span>
</span><a name="line-256"></a><span class="hs-identifier">fetchAllRowsAL'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.HDBC.Statement.html#Statement"><span class="hs-identifier hs-type">Statement</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><a href="Database.HDBC.SqlValue.html#SqlValue"><span class="hs-identifier hs-type">SqlValue</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-257"></a><a name="fetchAllRowsAL%27"><a href="Database.HDBC.Utils.html#fetchAllRowsAL%27"><span class="hs-identifier">fetchAllRowsAL'</span></a></a><span> </span><a name="local-6989586621679055833"><a href="#local-6989586621679055833"><span class="hs-identifier">sth</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-258"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679055834"><a href="#local-6989586621679055834"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.HDBC.Utils.html#fetchAllRowsAL"><span class="hs-identifier hs-var">fetchAllRowsAL</span></a><span> </span><a href="#local-6989586621679055833"><span class="hs-identifier hs-var">sth</span></a><span>
</span><a name="line-259"></a><span>       </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.HDBC.Utils.html#evalAll"><span class="hs-identifier hs-var">evalAll</span></a><span> </span><a href="#local-6989586621679055834"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-260"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679055834"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-261"></a><span>
</span><a name="line-262"></a><span class="hs-comment">{- | Like 'fetchAllRowsAL', but return a list of Maps instead of a list of
association lists. -}</span><span>
</span><a name="line-264"></a><span class="hs-identifier">fetchAllRowsMap</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.HDBC.Statement.html#Statement"><span class="hs-identifier hs-type">Statement</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Map</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Map</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><a href="Database.HDBC.SqlValue.html#SqlValue"><span class="hs-identifier hs-type">SqlValue</span></a><span class="hs-special">]</span><span>
</span><a name="line-265"></a><a name="fetchAllRowsMap"><a href="Database.HDBC.Utils.html#fetchAllRowsMap"><span class="hs-identifier">fetchAllRowsMap</span></a></a><span> </span><a name="local-6989586621679055835"><a href="#local-6989586621679055835"><span class="hs-identifier">sth</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Database.HDBC.Utils.html#fetchAllRowsAL"><span class="hs-identifier hs-var">fetchAllRowsAL</span></a><span> </span><a href="#local-6989586621679055835"><span class="hs-identifier hs-var">sth</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">Map</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span class="hs-special">)</span><span>
</span><a name="line-266"></a><span>
</span><a name="line-267"></a><span class="hs-comment">{- | Strict version of 'fetchAllRowsMap' -}</span><span>
</span><a name="line-268"></a><span class="hs-identifier">fetchAllRowsMap'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.HDBC.Statement.html#Statement"><span class="hs-identifier hs-type">Statement</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Map</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Map</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><a href="Database.HDBC.SqlValue.html#SqlValue"><span class="hs-identifier hs-type">SqlValue</span></a><span class="hs-special">]</span><span>
</span><a name="line-269"></a><a name="fetchAllRowsMap%27"><a href="Database.HDBC.Utils.html#fetchAllRowsMap%27"><span class="hs-identifier">fetchAllRowsMap'</span></a></a><span> </span><a name="local-6989586621679055836"><a href="#local-6989586621679055836"><span class="hs-identifier">sth</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><a name="line-270"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679055837"><a href="#local-6989586621679055837"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.HDBC.Utils.html#fetchAllRowsMap"><span class="hs-identifier hs-var">fetchAllRowsMap</span></a><span> </span><a href="#local-6989586621679055836"><span class="hs-identifier hs-var">sth</span></a><span>
</span><a name="line-271"></a><span>       </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">evaluate</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-var">genericLength</span><span> </span><a href="#local-6989586621679055837"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">)</span><span class="hs-glyph">::</span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">)</span><span>
</span><a name="line-272"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679055837"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-273"></a><span>
</span><a name="line-274"></a><span class="hs-comment">{- | A quick way to do a query.  Similar to preparing, executing, and
then calling 'fetchAllRows' on a statement. See also 'quickQuery''. -}</span><span>
</span><a name="line-276"></a><span class="hs-identifier">quickQuery</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.HDBC.Types.html#IConnection"><span class="hs-identifier hs-type">IConnection</span></a><span> </span><a href="#local-6989586621679054544"><span class="hs-identifier hs-type">conn</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679054544"><span class="hs-identifier hs-type">conn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Database.HDBC.SqlValue.html#SqlValue"><span class="hs-identifier hs-type">SqlValue</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="Database.HDBC.SqlValue.html#SqlValue"><span class="hs-identifier hs-type">SqlValue</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-277"></a><a name="quickQuery"><a href="Database.HDBC.Utils.html#quickQuery"><span class="hs-identifier">quickQuery</span></a></a><span> </span><a name="local-6989586621679055838"><a href="#local-6989586621679055838"><span class="hs-identifier">conn</span></a></a><span> </span><a name="local-6989586621679055839"><a href="#local-6989586621679055839"><span class="hs-identifier">qrystr</span></a></a><span> </span><a name="local-6989586621679055840"><a href="#local-6989586621679055840"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-278"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679055841"><a href="#local-6989586621679055841"><span class="hs-identifier">sth</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.HDBC.Types.html#prepare"><span class="hs-identifier hs-var">prepare</span></a><span> </span><a href="#local-6989586621679055838"><span class="hs-identifier hs-var">conn</span></a><span> </span><a href="#local-6989586621679055839"><span class="hs-identifier hs-var">qrystr</span></a><span>
</span><a name="line-279"></a><span>       </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">execute</span><span> </span><a href="#local-6989586621679055841"><span class="hs-identifier hs-var">sth</span></a><span> </span><a href="#local-6989586621679055840"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-280"></a><span>       </span><a href="Database.HDBC.Utils.html#fetchAllRows"><span class="hs-identifier hs-var">fetchAllRows</span></a><span> </span><a href="#local-6989586621679055841"><span class="hs-identifier hs-var">sth</span></a><span>
</span><a name="line-281"></a><span>
</span><a name="line-282"></a><span class="hs-comment">{- | Strict version of 'quickQuery'. -}</span><span>
</span><a name="line-283"></a><span class="hs-identifier">quickQuery'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.HDBC.Types.html#IConnection"><span class="hs-identifier hs-type">IConnection</span></a><span> </span><a href="#local-6989586621679054543"><span class="hs-identifier hs-type">conn</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679054543"><span class="hs-identifier hs-type">conn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Database.HDBC.SqlValue.html#SqlValue"><span class="hs-identifier hs-type">SqlValue</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="Database.HDBC.SqlValue.html#SqlValue"><span class="hs-identifier hs-type">SqlValue</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-284"></a><a name="quickQuery%27"><a href="Database.HDBC.Utils.html#quickQuery%27"><span class="hs-identifier">quickQuery'</span></a></a><span> </span><a name="local-6989586621679055842"><a href="#local-6989586621679055842"><span class="hs-identifier">conn</span></a></a><span> </span><a name="local-6989586621679055843"><a href="#local-6989586621679055843"><span class="hs-identifier">qrystr</span></a></a><span> </span><a name="local-6989586621679055844"><a href="#local-6989586621679055844"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-285"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679055845"><a href="#local-6989586621679055845"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.HDBC.Utils.html#quickQuery"><span class="hs-identifier hs-var">quickQuery</span></a><span> </span><a href="#local-6989586621679055842"><span class="hs-identifier hs-var">conn</span></a><span> </span><a href="#local-6989586621679055843"><span class="hs-identifier hs-var">qrystr</span></a><span> </span><a href="#local-6989586621679055844"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-286"></a><span>       </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.HDBC.Utils.html#evalAll"><span class="hs-identifier hs-var">evalAll</span></a><span> </span><a href="#local-6989586621679055845"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-287"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679055845"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-288"></a><span>
</span><a name="line-289"></a><span class="hs-comment">{- | A utility function to throw a 'SqlError'.  The mechanics of throwing
such a thing differ between GHC 6.8.x, Hugs, and GHC 6.10.  This function
takes care of the special cases to make it simpler.

With GHC 6.10, it is a type-restricted alias for throw.  On all other systems,
it is a type-restricted alias for throwDyn. -}</span><span>
</span><a name="line-295"></a><span class="hs-identifier">throwSqlError</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.HDBC.Statement.html#SqlError"><span class="hs-identifier hs-type">SqlError</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679054542"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-296"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 610</span><span>
</span><a name="line-297"></a><a name="throwSqlError"><a href="Database.HDBC.Utils.html#throwSqlError"><span class="hs-identifier">throwSqlError</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">throw</span><span>
</span><a name="line-298"></a><span class="hs-cpp">#else</span><span>
</span><a name="line-299"></a><span class="hs-identifier">throwSqlError</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">throwDyn</span><span>
</span><a name="line-300"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-301"></a></pre></body></html>