<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE ExplicitForAll #-}</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE ParallelListComp #-}</span><span>
</span><a name="line-6"></a><span>
</span><a name="line-7"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-8"></a><span class="hs-comment">-- Module      : Database.Relational.Query.TH</span><span>
</span><a name="line-9"></a><span class="hs-comment">-- Copyright   : 2013-2017 Kei Hibino</span><span>
</span><a name="line-10"></a><span class="hs-comment">-- License     : BSD3</span><span>
</span><a name="line-11"></a><span class="hs-comment">--</span><span>
</span><a name="line-12"></a><span class="hs-comment">-- Maintainer  : ex8k.hibino@gmail.com</span><span>
</span><a name="line-13"></a><span class="hs-comment">-- Stability   : experimental</span><span>
</span><a name="line-14"></a><span class="hs-comment">-- Portability : unknown</span><span>
</span><a name="line-15"></a><span class="hs-comment">--</span><span>
</span><a name="line-16"></a><span class="hs-comment">-- This module defines templates for Haskell record type and type class instances</span><span>
</span><a name="line-17"></a><span class="hs-comment">-- to define column projection on SQL query like Haskell records.</span><span>
</span><a name="line-18"></a><span class="hs-comment">-- Templates are generated by also using functions of &quot;Database.Record.TH&quot; module,</span><span>
</span><a name="line-19"></a><span class="hs-comment">-- so mapping between list of untyped SQL type and Haskell record type will be done too.</span><span>
</span><a name="line-20"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">Relational</span><span class="hs-operator">.</span><span class="hs-identifier">Query</span><span class="hs-operator">.</span><span class="hs-identifier">TH</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-21"></a><span>  </span><span class="hs-comment">-- * All templates about table</span><span>
</span><a name="line-22"></a><span>  </span><a href="Database.Relational.Query.TH.html#defineTable"><span class="hs-identifier hs-var">defineTable</span></a><span class="hs-special">,</span><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span>  </span><span class="hs-comment">-- * Inlining typed 'Query'</span><span>
</span><a name="line-25"></a><span>  </span><a href="Database.Relational.Query.TH.html#unsafeInlineQuery"><span class="hs-identifier hs-var">unsafeInlineQuery</span></a><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>  </span><a href="Database.Relational.Query.TH.html#inlineQuery"><span class="hs-identifier hs-var">inlineQuery</span></a><span class="hs-special">,</span><span>
</span><a name="line-27"></a><span>
</span><a name="line-28"></a><span>  </span><span class="hs-comment">-- * Column projections and basic 'Relation' for Haskell record</span><span>
</span><a name="line-29"></a><span>  </span><a href="Database.Relational.Query.TH.html#defineTableTypesAndRecord"><span class="hs-identifier hs-var">defineTableTypesAndRecord</span></a><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>
</span><a name="line-31"></a><span>  </span><span class="hs-comment">-- * Constraint key templates</span><span>
</span><a name="line-32"></a><span>  </span><a href="Database.Relational.Query.TH.html#defineHasPrimaryKeyInstance"><span class="hs-identifier hs-var">defineHasPrimaryKeyInstance</span></a><span class="hs-special">,</span><span>
</span><a name="line-33"></a><span>  </span><a href="Database.Relational.Query.TH.html#defineHasPrimaryKeyInstanceWithConfig"><span class="hs-identifier hs-var">defineHasPrimaryKeyInstanceWithConfig</span></a><span class="hs-special">,</span><span>
</span><a name="line-34"></a><span>  </span><a href="Database.Relational.Query.TH.html#defineHasNotNullKeyInstance"><span class="hs-identifier hs-var">defineHasNotNullKeyInstance</span></a><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>  </span><a href="Database.Relational.Query.TH.html#defineHasNotNullKeyInstanceWithConfig"><span class="hs-identifier hs-var">defineHasNotNullKeyInstanceWithConfig</span></a><span class="hs-special">,</span><span>
</span><a name="line-36"></a><span>  </span><a href="Database.Relational.Query.Scalar.html#defineScalarDegree"><span class="hs-identifier hs-var">defineScalarDegree</span></a><span class="hs-special">,</span><span>
</span><a name="line-37"></a><span>
</span><a name="line-38"></a><span>  </span><span class="hs-comment">-- * Column projections</span><span>
</span><a name="line-39"></a><span>  </span><a href="Database.Relational.Query.TH.html#defineColumns"><span class="hs-identifier hs-var">defineColumns</span></a><span class="hs-special">,</span><span> </span><a href="Database.Relational.Query.TH.html#defineColumnsDefault"><span class="hs-identifier hs-var">defineColumnsDefault</span></a><span class="hs-special">,</span><span>
</span><a name="line-40"></a><span>
</span><a name="line-41"></a><span>  </span><a href="Database.Relational.Query.BaseTH.html#defineTuplePi"><span class="hs-identifier hs-var">defineTuplePi</span></a><span class="hs-special">,</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span>  </span><span class="hs-comment">-- * Table metadata type and basic 'Relation'</span><span>
</span><a name="line-44"></a><span>  </span><a href="Database.Relational.Query.TH.html#defineTableTypes"><span class="hs-identifier hs-var">defineTableTypes</span></a><span class="hs-special">,</span><span> </span><a href="Database.Relational.Query.TH.html#defineTableTypesWithConfig"><span class="hs-identifier hs-var">defineTableTypesWithConfig</span></a><span class="hs-special">,</span><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span>  </span><span class="hs-comment">-- * Basic SQL templates generate rules</span><span>
</span><a name="line-47"></a><span>  </span><a href="Database.Relational.Query.TH.html#definePrimaryQuery"><span class="hs-identifier hs-var">definePrimaryQuery</span></a><span class="hs-special">,</span><span>
</span><a name="line-48"></a><span>  </span><a href="Database.Relational.Query.TH.html#definePrimaryUpdate"><span class="hs-identifier hs-var">definePrimaryUpdate</span></a><span class="hs-special">,</span><span>
</span><a name="line-49"></a><span>
</span><a name="line-50"></a><span>  </span><span class="hs-comment">-- * Var expression templates</span><span>
</span><a name="line-51"></a><span>  </span><a href="Database.Relational.Query.TH.html#derivationExpDefault"><span class="hs-identifier hs-var">derivationExpDefault</span></a><span class="hs-special">,</span><span>
</span><a name="line-52"></a><span>  </span><a href="Database.Relational.Query.TH.html#tableVarExpDefault"><span class="hs-identifier hs-var">tableVarExpDefault</span></a><span class="hs-special">,</span><span>
</span><a name="line-53"></a><span>  </span><a href="Database.Relational.Query.TH.html#relationVarExp"><span class="hs-identifier hs-var">relationVarExp</span></a><span class="hs-special">,</span><span>
</span><a name="line-54"></a><span>
</span><a name="line-55"></a><span>  </span><span class="hs-comment">-- * Derived SQL templates from table definitions</span><span>
</span><a name="line-56"></a><span>  </span><a href="Database.Relational.Query.TH.html#defineSqlsWithPrimaryKey"><span class="hs-identifier hs-var">defineSqlsWithPrimaryKey</span></a><span class="hs-special">,</span><span>
</span><a name="line-57"></a><span>  </span><a href="Database.Relational.Query.TH.html#defineSqlsWithPrimaryKeyDefault"><span class="hs-identifier hs-var">defineSqlsWithPrimaryKeyDefault</span></a><span class="hs-special">,</span><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span>  </span><span class="hs-comment">-- * Add type class instance against record type</span><span>
</span><a name="line-60"></a><span>  </span><a href="Database.Relational.Query.BaseTH.html#defineProductConstructorInstance"><span class="hs-identifier hs-var">defineProductConstructorInstance</span></a><span class="hs-special">,</span><span>
</span><a name="line-61"></a><span>
</span><a name="line-62"></a><span>  </span><span class="hs-comment">-- * Reify</span><span>
</span><a name="line-63"></a><span>  </span><a href="Database.Relational.Query.TH.html#makeRelationalRecordDefault"><span class="hs-identifier hs-var">makeRelationalRecordDefault</span></a><span class="hs-special">,</span><span>
</span><a name="line-64"></a><span>  </span><a href="Database.Relational.Query.TH.html#reifyRelation"><span class="hs-identifier hs-var">reifyRelation</span></a><span class="hs-special">,</span><span>
</span><a name="line-65"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-66"></a><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Char</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toUpper</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">toLower</span><span class="hs-special">)</span><span>
</span><a name="line-68"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">foldl1'</span><span class="hs-special">)</span><span>
</span><a name="line-69"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Array</span><span class="hs-operator">.</span><span class="hs-identifier">IArray</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">!</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-70"></a><span>
</span><a name="line-71"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Language</span><span class="hs-operator">.</span><span class="hs-identifier">Haskell</span><span class="hs-operator">.</span><span class="hs-identifier">TH</span><span>
</span><a name="line-72"></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nameBase</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Q</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">reify</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AppT</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ConT</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">ExpQ</span><span class="hs-special">,</span><span>
</span><a name="line-73"></a><span>   </span><span class="hs-identifier hs-var">tupleT</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">appT</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">stringE</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">listE</span><span class="hs-special">)</span><span>
</span><a name="line-74"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Language</span><span class="hs-operator">.</span><span class="hs-identifier">Haskell</span><span class="hs-operator">.</span><span class="hs-identifier">TH</span><span class="hs-operator">.</span><span class="hs-identifier">Compat</span><span class="hs-operator">.</span><span class="hs-identifier">Reify</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unVarI</span><span class="hs-special">)</span><span>
</span><a name="line-75"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Language</span><span class="hs-operator">.</span><span class="hs-identifier">Haskell</span><span class="hs-operator">.</span><span class="hs-identifier">TH</span><span class="hs-operator">.</span><span class="hs-identifier">Name</span><span class="hs-operator">.</span><span class="hs-identifier">CamelCase</span><span>
</span><a name="line-76"></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-type">VarName</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">varName</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">ConName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConName</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">conName</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">varNameWithPrefix</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">varCamelcaseName</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">toVarExp</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">toTypeCon</span><span class="hs-special">)</span><span>
</span><a name="line-77"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Language</span><span class="hs-operator">.</span><span class="hs-identifier">Haskell</span><span class="hs-operator">.</span><span class="hs-identifier">TH</span><span class="hs-operator">.</span><span class="hs-identifier">Lib</span><span class="hs-operator">.</span><span class="hs-identifier">Extra</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">simpleValD</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">maybeD</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">integralE</span><span class="hs-special">)</span><span>
</span><a name="line-78"></a><span>
</span><a name="line-79"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">Record</span><span class="hs-operator">.</span><span class="hs-identifier">TH</span><span>
</span><a name="line-80"></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">columnOffsetsVarNameDefault</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">recordTypeName</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">recordTemplate</span><span class="hs-special">,</span><span>
</span><a name="line-81"></a><span>   </span><span class="hs-identifier hs-var">defineRecordTypeWithConfig</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">defineHasColumnConstraintInstance</span><span class="hs-special">)</span><span>
</span><a name="line-82"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">Record</span><span class="hs-operator">.</span><span class="hs-identifier">TH</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Record</span><span>
</span><a name="line-83"></a><span>
</span><a name="line-84"></a><span class="hs-keyword">import</span><span> </span><a href="Database.Relational.Query.html"><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">Relational</span><span class="hs-operator">.</span><span class="hs-identifier">Query</span></a><span>
</span><a name="line-85"></a><span>  </span><span class="hs-special">(</span><a href="Database.Relational.Query.Table.html#Table"><span class="hs-identifier hs-type">Table</span></a><span class="hs-special">,</span><span> </span><a href="Database.Relational.Query.Pi.Unsafe.html#Pi"><span class="hs-identifier hs-type">Pi</span></a><span class="hs-special">,</span><span> </span><a href="Database.Relational.Query.Pi.html#id%27"><span class="hs-identifier hs-var">id'</span></a><span class="hs-special">,</span><span> </span><a href="Database.Relational.Query.Monad.BaseType.html#Relation"><span class="hs-identifier hs-type">Relation</span></a><span class="hs-special">,</span><span> </span><a href="Database.Relational.Query.ProjectableClass.html#ShowConstantTermsSQL"><span class="hs-identifier hs-type">ShowConstantTermsSQL</span></a><span class="hs-special">,</span><span>
</span><a name="line-86"></a><span>   </span><a href="Database.Relational.Query.Internal.Config.html#NameConfig"><span class="hs-identifier hs-type">NameConfig</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Database.Relational.Query.Internal.Config.html#SchemaNameMode"><span class="hs-identifier hs-type">SchemaNameMode</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Database.Relational.Query.Internal.Config.html#IdentifierQuotation"><span class="hs-identifier hs-type">IdentifierQuotation</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-87"></a><span>   </span><a href="Database.Relational.Query.Internal.Config.html#Config"><span class="hs-identifier hs-type">Config</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">normalizedTableName</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">schemaNameMode</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">nameConfig</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">identifierQuotation</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-88"></a><span>   </span><a href="Database.Relational.Query.Type.html#relationalQuerySQL"><span class="hs-identifier hs-var">relationalQuerySQL</span></a><span class="hs-special">,</span><span> </span><a href="Database.Relational.Query.Type.html#Query"><span class="hs-identifier hs-type">Query</span></a><span class="hs-special">,</span><span> </span><a href="Database.Relational.Query.Type.html#relationalQuery"><span class="hs-identifier hs-var">relationalQuery</span></a><span class="hs-special">,</span><span> </span><a href="Database.Relational.Query.Type.html#KeyUpdate"><span class="hs-identifier hs-type">KeyUpdate</span></a><span class="hs-special">,</span><span>
</span><a name="line-89"></a><span>   </span><a href="Database.Relational.Query.Type.html#Insert"><span class="hs-identifier hs-type">Insert</span></a><span class="hs-special">,</span><span> </span><a href="Database.Relational.Query.Type.html#derivedInsert"><span class="hs-identifier hs-var">derivedInsert</span></a><span class="hs-special">,</span><span> </span><a href="Database.Relational.Query.Type.html#InsertQuery"><span class="hs-identifier hs-type">InsertQuery</span></a><span class="hs-special">,</span><span> </span><a href="Database.Relational.Query.Type.html#derivedInsertQuery"><span class="hs-identifier hs-var">derivedInsertQuery</span></a><span class="hs-special">,</span><span>
</span><a name="line-90"></a><span>   </span><a href="Database.Relational.Query.Constraint.html#HasConstraintKey"><span class="hs-identifier hs-type">HasConstraintKey</span></a><span class="hs-special">(</span><a href="Database.Relational.Query.Constraint.html#constraintKey"><span class="hs-identifier hs-var">constraintKey</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Primary</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">NotNull</span><span class="hs-special">,</span><span> </span><a href="Database.Relational.Query.Derives.html#primary"><span class="hs-identifier hs-var">primary</span></a><span class="hs-special">,</span><span> </span><a href="Database.Relational.Query.Derives.html#primaryUpdate"><span class="hs-identifier hs-var">primaryUpdate</span></a><span class="hs-special">)</span><span>
</span><a name="line-91"></a><span>
</span><a name="line-92"></a><span class="hs-keyword">import</span><span> </span><a href="Database.Relational.Query.BaseTH.html"><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">Relational</span><span class="hs-operator">.</span><span class="hs-identifier">Query</span><span class="hs-operator">.</span><span class="hs-identifier">BaseTH</span></a><span> </span><span class="hs-special">(</span><a href="Database.Relational.Query.BaseTH.html#defineProductConstructorInstance"><span class="hs-identifier hs-var">defineProductConstructorInstance</span></a><span class="hs-special">,</span><span> </span><a href="Database.Relational.Query.BaseTH.html#defineTuplePi"><span class="hs-identifier hs-var">defineTuplePi</span></a><span class="hs-special">)</span><span>
</span><a name="line-93"></a><span class="hs-keyword">import</span><span> </span><a href="Database.Relational.Query.Scalar.html"><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">Relational</span><span class="hs-operator">.</span><span class="hs-identifier">Query</span><span class="hs-operator">.</span><span class="hs-identifier">Scalar</span></a><span> </span><span class="hs-special">(</span><a href="Database.Relational.Query.Scalar.html#defineScalarDegree"><span class="hs-identifier hs-var">defineScalarDegree</span></a><span class="hs-special">)</span><span>
</span><a name="line-94"></a><span class="hs-keyword">import</span><span> </span><a href="Database.Relational.Query.Constraint.html"><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">Relational</span><span class="hs-operator">.</span><span class="hs-identifier">Query</span><span class="hs-operator">.</span><span class="hs-identifier">Constraint</span></a><span> </span><span class="hs-special">(</span><a href="Database.Relational.Query.Constraint.html#Key"><span class="hs-identifier hs-type">Key</span></a><span class="hs-special">,</span><span> </span><a href="Database.Relational.Query.Constraint.html#unsafeDefineConstraintKey"><span class="hs-identifier hs-var">unsafeDefineConstraintKey</span></a><span class="hs-special">)</span><span>
</span><a name="line-95"></a><span class="hs-keyword">import</span><span> </span><a href="Database.Relational.Query.Table.html"><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">Relational</span><span class="hs-operator">.</span><span class="hs-identifier">Query</span><span class="hs-operator">.</span><span class="hs-identifier">Table</span></a><span> </span><span class="hs-special">(</span><a href="Database.Relational.Query.Table.html#TableDerivable"><span class="hs-identifier hs-type">TableDerivable</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-96"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Database.Relational.Query.Table.html"><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">Relational</span><span class="hs-operator">.</span><span class="hs-identifier">Query</span><span class="hs-operator">.</span><span class="hs-identifier">Table</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Table</span><span>
</span><a name="line-97"></a><span class="hs-keyword">import</span><span> </span><a href="Database.Relational.Query.Relation.html"><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">Relational</span><span class="hs-operator">.</span><span class="hs-identifier">Query</span><span class="hs-operator">.</span><span class="hs-identifier">Relation</span></a><span> </span><span class="hs-special">(</span><a href="Database.Relational.Query.Relation.html#derivedRelation"><span class="hs-identifier hs-var">derivedRelation</span></a><span class="hs-special">)</span><span>
</span><a name="line-98"></a><span class="hs-keyword">import</span><span> </span><a href="Database.Relational.Query.SQL.html"><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">Relational</span><span class="hs-operator">.</span><span class="hs-identifier">Query</span><span class="hs-operator">.</span><span class="hs-identifier">SQL</span></a><span> </span><span class="hs-special">(</span><a href="Database.Relational.Query.SQL.html#QuerySuffix"><span class="hs-identifier hs-type">QuerySuffix</span></a><span class="hs-special">)</span><span>
</span><a name="line-99"></a><span class="hs-keyword">import</span><span> </span><a href="Database.Relational.Query.Type.html"><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">Relational</span><span class="hs-operator">.</span><span class="hs-identifier">Query</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span></a><span> </span><span class="hs-special">(</span><a href="Database.Relational.Query.Type.html#unsafeTypedQuery"><span class="hs-identifier hs-var">unsafeTypedQuery</span></a><span class="hs-special">)</span><span>
</span><a name="line-100"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Database.Relational.Query.Pi.Unsafe.html"><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">Relational</span><span class="hs-operator">.</span><span class="hs-identifier">Query</span><span class="hs-operator">.</span><span class="hs-identifier">Pi</span><span class="hs-operator">.</span><span class="hs-identifier">Unsafe</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">UnsafePi</span><span>
</span><a name="line-101"></a><span>
</span><a name="line-102"></a><span>
</span><a name="line-103"></a><span class="hs-comment">-- | Rule template to infer constraint key.</span><span>
</span><a name="line-104"></a><span class="hs-identifier">defineHasConstraintKeyInstance</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span>   </span><span class="hs-comment">-- ^ Constraint type</span><span>
</span><a name="line-105"></a><span>                               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span>   </span><span class="hs-comment">-- ^ Record type</span><span>
</span><a name="line-106"></a><span>                               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span>   </span><span class="hs-comment">-- ^ Key type</span><span>
</span><a name="line-107"></a><span>                               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- ^ Indexes specifies key</span><span>
</span><a name="line-108"></a><span>                               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Result 'HasConstraintKey' declaration</span><span>
</span><a name="line-109"></a><a name="defineHasConstraintKeyInstance"><a href="Database.Relational.Query.TH.html#defineHasConstraintKeyInstance"><span class="hs-identifier">defineHasConstraintKeyInstance</span></a></a><span> </span><a name="local-6989586621679521377"><a href="#local-6989586621679521377"><span class="hs-identifier">constraint</span></a></a><span> </span><a name="local-6989586621679521378"><a href="#local-6989586621679521378"><span class="hs-identifier">recType</span></a></a><span> </span><a name="local-6989586621679521379"><a href="#local-6989586621679521379"><span class="hs-identifier">colType</span></a></a><span> </span><a name="local-6989586621679521380"><a href="#local-6989586621679521380"><span class="hs-identifier">indexes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-110"></a><span>  </span><span class="hs-comment">-- kc &lt;- defineHasColumnConstraintInstance constraint recType index</span><span>
</span><a name="line-111"></a><span>  </span><a name="local-6989586621679521386"><a href="#local-6989586621679521386"><span class="hs-identifier">ck</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">d</span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">instance</span><span> </span><a href="Database.Relational.Query.Constraint.html#HasConstraintKey"><span class="hs-identifier hs-type">HasConstraintKey</span></a><span> </span><a href="#local-6989586621679521377"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">constraint</span></a><span> </span><a href="#local-6989586621679521378"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">recType</span></a><span> </span><a href="#local-6989586621679521379"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">colType</span></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-112"></a><span>              </span><a name="constraintKey"><a href="Database.Relational.Query.Constraint.html#constraintKey"><span class="hs-identifier">constraintKey</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Database.Relational.Query.Constraint.html#unsafeDefineConstraintKey"><span class="hs-identifier hs-var">unsafeDefineConstraintKey</span></a><span> </span><span class="hs-operator">$</span><span class="hs-special">(</span><span class="hs-identifier hs-var">listE</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">integralE</span><span> </span><a href="#local-6989586621679521385"><span class="hs-identifier hs-var">ix</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679521385"><a href="#local-6989586621679521385"><span class="hs-identifier">ix</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679521380"><span class="hs-identifier hs-var">indexes</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-113"></a><span>          </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-114"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679521386"><span class="hs-identifier hs-var">ck</span></a><span>
</span><a name="line-115"></a><span>
</span><a name="line-116"></a><span class="hs-comment">-- | Rule template to infer primary key.</span><span>
</span><a name="line-117"></a><span class="hs-identifier">defineHasPrimaryKeyInstance</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span>   </span><span class="hs-comment">-- ^ Record type</span><span>
</span><a name="line-118"></a><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span>   </span><span class="hs-comment">-- ^ Key type</span><span>
</span><a name="line-119"></a><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- ^ Indexes specifies key</span><span>
</span><a name="line-120"></a><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Result constraint key declarations</span><span>
</span><a name="line-121"></a><a name="defineHasPrimaryKeyInstance"><a href="Database.Relational.Query.TH.html#defineHasPrimaryKeyInstance"><span class="hs-identifier">defineHasPrimaryKeyInstance</span></a></a><span> </span><a name="local-6989586621679521387"><a href="#local-6989586621679521387"><span class="hs-identifier">recType</span></a></a><span> </span><a name="local-6989586621679521388"><a href="#local-6989586621679521388"><span class="hs-identifier">colType</span></a></a><span> </span><a name="local-6989586621679521389"><a href="#local-6989586621679521389"><span class="hs-identifier">indexes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-122"></a><span>  </span><a name="local-6989586621679521390"><a href="#local-6989586621679521390"><span class="hs-identifier">kc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">Record</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">defineHasPrimaryKeyInstance</span><span> </span><a href="#local-6989586621679521387"><span class="hs-identifier hs-var">recType</span></a><span> </span><a href="#local-6989586621679521389"><span class="hs-identifier hs-var">indexes</span></a><span>
</span><a name="line-123"></a><span>  </span><a name="local-6989586621679521391"><a href="#local-6989586621679521391"><span class="hs-identifier">ck</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.Relational.Query.TH.html#defineHasConstraintKeyInstance"><span class="hs-identifier hs-var">defineHasConstraintKeyInstance</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier">t</span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-type">Primary</span><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679521387"><span class="hs-identifier hs-var">recType</span></a><span> </span><a href="#local-6989586621679521388"><span class="hs-identifier hs-var">colType</span></a><span> </span><a href="#local-6989586621679521389"><span class="hs-identifier hs-var">indexes</span></a><span>
</span><a name="line-124"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679521390"><span class="hs-identifier hs-var">kc</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679521391"><span class="hs-identifier hs-var">ck</span></a><span>
</span><a name="line-125"></a><span>
</span><a name="line-126"></a><span class="hs-comment">-- | Rule template to infer primary key.</span><span>
</span><a name="line-127"></a><span class="hs-identifier">defineHasPrimaryKeyInstanceWithConfig</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Relational.Query.Internal.Config.html#Config"><span class="hs-identifier hs-type">Config</span></a><span>  </span><span class="hs-comment">-- ^ configuration parameters</span><span>
</span><a name="line-128"></a><span>                                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>  </span><span class="hs-comment">-- ^ Schema name</span><span>
</span><a name="line-129"></a><span>                                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>  </span><span class="hs-comment">-- ^ Table name</span><span>
</span><a name="line-130"></a><span>                                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span>   </span><span class="hs-comment">-- ^ Column type</span><span>
</span><a name="line-131"></a><span>                                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- ^ Primary key index</span><span>
</span><a name="line-132"></a><span>                                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Declarations of primary constraint key</span><span>
</span><a name="line-133"></a><a name="defineHasPrimaryKeyInstanceWithConfig"><a href="Database.Relational.Query.TH.html#defineHasPrimaryKeyInstanceWithConfig"><span class="hs-identifier">defineHasPrimaryKeyInstanceWithConfig</span></a></a><span> </span><a name="local-6989586621679521392"><a href="#local-6989586621679521392"><span class="hs-identifier">config</span></a></a><span> </span><a name="local-6989586621679521393"><a href="#local-6989586621679521393"><span class="hs-identifier">scm</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-134"></a><span>  </span><a href="Database.Relational.Query.TH.html#defineHasPrimaryKeyInstance"><span class="hs-identifier hs-var">defineHasPrimaryKeyInstance</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">recordTemplate</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">recordConfig</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">nameConfig</span><span> </span><a href="#local-6989586621679521392"><span class="hs-identifier hs-var">config</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679521393"><span class="hs-identifier hs-var">scm</span></a><span>
</span><a name="line-135"></a><span>
</span><a name="line-136"></a><span class="hs-comment">-- | Rule template to infer not-null key.</span><span>
</span><a name="line-137"></a><span class="hs-identifier">defineHasNotNullKeyInstance</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span>   </span><span class="hs-comment">-- ^ Record type</span><span>
</span><a name="line-138"></a><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>     </span><span class="hs-comment">-- ^ Column index</span><span>
</span><a name="line-139"></a><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Result 'ColumnConstraint' declaration</span><span>
</span><a name="line-140"></a><a name="defineHasNotNullKeyInstance"><a href="Database.Relational.Query.TH.html#defineHasNotNullKeyInstance"><span class="hs-identifier">defineHasNotNullKeyInstance</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-141"></a><span>  </span><span class="hs-identifier hs-var">defineHasColumnConstraintInstance</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">t</span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-type">NotNull</span><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-142"></a><span>
</span><a name="line-143"></a><span class="hs-comment">-- | Rule template to infer not-null key.</span><span>
</span><a name="line-144"></a><span class="hs-identifier">defineHasNotNullKeyInstanceWithConfig</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Relational.Query.Internal.Config.html#Config"><span class="hs-identifier hs-type">Config</span></a><span>  </span><span class="hs-comment">-- ^ configuration parameters</span><span>
</span><a name="line-145"></a><span>                                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>  </span><span class="hs-comment">-- ^ Schema name</span><span>
</span><a name="line-146"></a><span>                                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>  </span><span class="hs-comment">-- ^ Table name</span><span>
</span><a name="line-147"></a><span>                                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>     </span><span class="hs-comment">-- ^ NotNull key index</span><span>
</span><a name="line-148"></a><span>                                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Declaration of not-null constraint key</span><span>
</span><a name="line-149"></a><a name="defineHasNotNullKeyInstanceWithConfig"><a href="Database.Relational.Query.TH.html#defineHasNotNullKeyInstanceWithConfig"><span class="hs-identifier">defineHasNotNullKeyInstanceWithConfig</span></a></a><span> </span><a name="local-6989586621679521394"><a href="#local-6989586621679521394"><span class="hs-identifier">config</span></a></a><span> </span><a name="local-6989586621679521395"><a href="#local-6989586621679521395"><span class="hs-identifier">scm</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-150"></a><span>  </span><a href="Database.Relational.Query.TH.html#defineHasNotNullKeyInstance"><span class="hs-identifier hs-var">defineHasNotNullKeyInstance</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">recordTemplate</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">recordConfig</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">nameConfig</span><span> </span><a href="#local-6989586621679521394"><span class="hs-identifier hs-var">config</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679521395"><span class="hs-identifier hs-var">scm</span></a><span>
</span><a name="line-151"></a><span>
</span><a name="line-152"></a><span>
</span><a name="line-153"></a><span class="hs-comment">-- | Column projection path 'Pi' template.</span><span>
</span><a name="line-154"></a><span class="hs-identifier">columnTemplate'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span>   </span><span class="hs-comment">-- ^ Record type</span><span>
</span><a name="line-155"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">VarName</span><span> </span><span class="hs-comment">-- ^ Column declaration variable name</span><span>
</span><a name="line-156"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ExpQ</span><span>    </span><span class="hs-comment">-- ^ Column index expression in record (begin with 0)</span><span>
</span><a name="line-157"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span>   </span><span class="hs-comment">-- ^ Column type</span><span>
</span><a name="line-158"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Column projection path declaration</span><span>
</span><a name="line-159"></a><a name="columnTemplate%27"><a href="Database.Relational.Query.TH.html#columnTemplate%27"><span class="hs-identifier">columnTemplate'</span></a></a><span> </span><a name="local-6989586621679521396"><a href="#local-6989586621679521396"><span class="hs-identifier">recType</span></a></a><span> </span><a name="local-6989586621679521397"><a href="#local-6989586621679521397"><span class="hs-identifier">var'</span></a></a><span> </span><a name="local-6989586621679521398"><a href="#local-6989586621679521398"><span class="hs-identifier">iExp</span></a></a><span> </span><a name="local-6989586621679521399"><a href="#local-6989586621679521399"><span class="hs-identifier">colType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-160"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679521400"><a href="#local-6989586621679521400"><span class="hs-identifier">var</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">varName</span><span> </span><a href="#local-6989586621679521397"><span class="hs-identifier hs-var">var'</span></a><span>
</span><a name="line-161"></a><span>  </span><span class="hs-identifier hs-var">simpleValD</span><span> </span><a href="#local-6989586621679521400"><span class="hs-identifier hs-var">var</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier">t</span><span class="hs-glyph">|</span><span> </span><a href="Database.Relational.Query.Pi.Unsafe.html#Pi"><span class="hs-identifier hs-type">Pi</span></a><span> </span><a href="#local-6989586621679521396"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">recType</span></a><span> </span><a href="#local-6989586621679521399"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">colType</span></a><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-162"></a><span>    </span><span class="hs-special">[</span><span class="hs-glyph">|</span><span> </span><a href="Database.Relational.Query.Pi.Unsafe.html#definePi"><span class="hs-identifier hs-var">UnsafePi</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">definePi</span></a><span> </span><span class="hs-operator">$</span><span class="hs-special">(</span><a href="#local-6989586621679521398"><span class="hs-identifier hs-var">iExp</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-163"></a><span>
</span><a name="line-164"></a><span class="hs-comment">-- | Column projection path 'Pi' and constraint key template.</span><span>
</span><a name="line-165"></a><span class="hs-identifier">columnTemplate</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">TypeQ</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">VarName</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ May Constraint type and constraint object name</span><span>
</span><a name="line-166"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span>                  </span><span class="hs-comment">-- ^ Record type</span><span>
</span><a name="line-167"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">VarName</span><span>                </span><span class="hs-comment">-- ^ Column declaration variable name</span><span>
</span><a name="line-168"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ExpQ</span><span>                   </span><span class="hs-comment">-- ^ Column index expression in record (begin with 0)</span><span>
</span><a name="line-169"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span>                  </span><span class="hs-comment">-- ^ Column type</span><span>
</span><a name="line-170"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span>                </span><span class="hs-comment">-- ^ Column projection path declaration</span><span>
</span><a name="line-171"></a><a name="columnTemplate"><a href="Database.Relational.Query.TH.html#columnTemplate"><span class="hs-identifier">columnTemplate</span></a></a><span> </span><a name="local-6989586621679521404"><a href="#local-6989586621679521404"><span class="hs-identifier">mayConstraint</span></a></a><span> </span><a name="local-6989586621679521405"><a href="#local-6989586621679521405"><span class="hs-identifier">recType</span></a></a><span> </span><a name="local-6989586621679521406"><a href="#local-6989586621679521406"><span class="hs-identifier">var'</span></a></a><span> </span><a name="local-6989586621679521407"><a href="#local-6989586621679521407"><span class="hs-identifier">iExp</span></a></a><span> </span><a name="local-6989586621679521408"><a href="#local-6989586621679521408"><span class="hs-identifier">colType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-172"></a><span>  </span><a name="local-6989586621679521409"><a href="#local-6989586621679521409"><span class="hs-identifier">col</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.Relational.Query.TH.html#columnTemplate%27"><span class="hs-identifier hs-var">columnTemplate'</span></a><span> </span><a href="#local-6989586621679521405"><span class="hs-identifier hs-var">recType</span></a><span> </span><a href="#local-6989586621679521406"><span class="hs-identifier hs-var">var'</span></a><span> </span><a href="#local-6989586621679521407"><span class="hs-identifier hs-var">iExp</span></a><span> </span><a href="#local-6989586621679521408"><span class="hs-identifier hs-var">colType</span></a><span>
</span><a name="line-173"></a><span>  </span><a name="local-6989586621679521416"><a href="#local-6989586621679521416"><span class="hs-identifier">cr</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">maybe</span><span>
</span><a name="line-174"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-175"></a><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679521410"><a href="#local-6989586621679521410"><span class="hs-identifier">constraint</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679521411"><a href="#local-6989586621679521411"><span class="hs-identifier">cname'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-176"></a><span>         </span><span class="hs-identifier hs-var">simpleValD</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">varName</span><span> </span><a href="#local-6989586621679521411"><span class="hs-identifier hs-var">cname'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">t</span><span class="hs-glyph">|</span><span> </span><a href="Database.Relational.Query.Constraint.html#Key"><span class="hs-identifier hs-type">Key</span></a><span> </span><a href="#local-6989586621679521410"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">constraint</span></a><span> </span><a href="#local-6989586621679521405"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">recType</span></a><span> </span><a href="#local-6989586621679521408"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">colType</span></a><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-177"></a><span>           </span><span class="hs-special">[</span><span class="hs-glyph">|</span><span> </span><a href="Database.Relational.Query.Constraint.html#unsafeDefineConstraintKey"><span class="hs-identifier hs-var">unsafeDefineConstraintKey</span></a><span> </span><span class="hs-operator">$</span><span class="hs-special">(</span><a href="#local-6989586621679521407"><span class="hs-identifier hs-var">iExp</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-178"></a><span>    </span><a href="#local-6989586621679521404"><span class="hs-identifier hs-var">mayConstraint</span></a><span>
</span><a name="line-179"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679521409"><span class="hs-identifier hs-var">col</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679521416"><span class="hs-identifier hs-var">cr</span></a><span>
</span><a name="line-180"></a><span>
</span><a name="line-181"></a><span class="hs-comment">-- | Column projection path 'Pi' templates.</span><span>
</span><a name="line-182"></a><span class="hs-identifier">defineColumns</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ConName</span><span>                                      </span><span class="hs-comment">-- ^ Record type name</span><span>
</span><a name="line-183"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-type">VarName</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">TypeQ</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">VarName</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Column info list</span><span>
</span><a name="line-184"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span>                                      </span><span class="hs-comment">-- ^ Column projection path declarations</span><span>
</span><a name="line-185"></a><a name="defineColumns"><a href="Database.Relational.Query.TH.html#defineColumns"><span class="hs-identifier">defineColumns</span></a></a><span> </span><a name="local-6989586621679521417"><a href="#local-6989586621679521417"><span class="hs-identifier">recTypeName</span></a></a><span> </span><a name="local-6989586621679521418"><a href="#local-6989586621679521418"><span class="hs-identifier">cols</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-186"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679521419"><a href="#local-6989586621679521419"><span class="hs-identifier">defC</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679521420"><a href="#local-6989586621679521420"><span class="hs-identifier">cn</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679521421"><a href="#local-6989586621679521421"><span class="hs-identifier">ct</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679521422"><a href="#local-6989586621679521422"><span class="hs-identifier">mayCon</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679521423"><a href="#local-6989586621679521423"><span class="hs-identifier">ix</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Database.Relational.Query.TH.html#columnTemplate"><span class="hs-identifier hs-var">columnTemplate</span></a><span> </span><a href="#local-6989586621679521422"><span class="hs-identifier hs-var">mayCon</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toTypeCon</span><span> </span><a href="#local-6989586621679521417"><span class="hs-identifier hs-var">recTypeName</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679521420"><span class="hs-identifier hs-var">cn</span></a><span>
</span><a name="line-187"></a><span>                                   </span><span class="hs-special">[</span><span class="hs-glyph">|</span><span> </span><span class="hs-operator">$</span><span class="hs-special">(</span><span class="hs-identifier hs-var">toVarExp</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">columnOffsetsVarNameDefault</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">conName</span><span> </span><a href="#local-6989586621679521417"><span class="hs-identifier hs-var">recTypeName</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-operator">$</span><span class="hs-special">(</span><span class="hs-identifier hs-var">integralE</span><span> </span><a href="#local-6989586621679521423"><span class="hs-identifier hs-var">ix</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679521421"><span class="hs-identifier hs-var">ct</span></a><span>
</span><a name="line-188"></a><span>  </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">sequence</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">zipWith</span><span> </span><a href="#local-6989586621679521419"><span class="hs-identifier hs-var">defC</span></a><span> </span><a href="#local-6989586621679521418"><span class="hs-identifier hs-var">cols</span></a><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><a name="line-189"></a><span>
</span><a name="line-190"></a><span class="hs-comment">-- | Make column projection path and constraint key templates using default naming rule.</span><span>
</span><a name="line-191"></a><span class="hs-identifier">defineColumnsDefault</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ConName</span><span>                          </span><span class="hs-comment">-- ^ Record type name</span><span>
</span><a name="line-192"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Column info list</span><span>
</span><a name="line-193"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span>                          </span><span class="hs-comment">-- ^ Column projection path declarations</span><span>
</span><a name="line-194"></a><a name="defineColumnsDefault"><a href="Database.Relational.Query.TH.html#defineColumnsDefault"><span class="hs-identifier">defineColumnsDefault</span></a></a><span> </span><a name="local-6989586621679522234"><a href="#local-6989586621679522234"><span class="hs-identifier">recTypeName</span></a></a><span> </span><a name="local-6989586621679522235"><a href="#local-6989586621679522235"><span class="hs-identifier">cols</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-195"></a><span>  </span><a href="Database.Relational.Query.TH.html#defineColumns"><span class="hs-identifier hs-var">defineColumns</span></a><span> </span><a href="#local-6989586621679522234"><span class="hs-identifier hs-var">recTypeName</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679522236"><span class="hs-identifier hs-var">varN</span></a><span> </span><a href="#local-6989586621679522241"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679522242"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679522237"><span class="hs-identifier hs-var">withCName</span></a><span> </span><a href="#local-6989586621679522241"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679522243"><span class="hs-identifier hs-var">mayC</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679522241"><a href="#local-6989586621679522241"><span class="hs-identifier">n</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679522242"><a href="#local-6989586621679522242"><span class="hs-identifier">ct</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679522243"><a href="#local-6989586621679522243"><span class="hs-identifier">mayC</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679522235"><span class="hs-identifier hs-var">cols</span></a><span class="hs-special">]</span><span>
</span><a name="line-196"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679522236"><a href="#local-6989586621679522236"><span class="hs-identifier">varN</span></a></a><span>      </span><a name="local-6989586621679522238"><a href="#local-6989586621679522238"><span class="hs-identifier">name</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varCamelcaseName</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679522238"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;'&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-197"></a><span>        </span><a name="local-6989586621679522237"><a href="#local-6989586621679522237"><span class="hs-identifier">withCName</span></a></a><span> </span><a name="local-6989586621679522239"><a href="#local-6989586621679522239"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679522240"><a href="#local-6989586621679522240"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679522240"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">varCamelcaseName</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;constraint_key_&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679522239"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-198"></a><span>
</span><a name="line-199"></a><span class="hs-comment">-- | Rule template to infer table derivations.</span><span>
</span><a name="line-200"></a><span class="hs-identifier">defineTableDerivableInstance</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span>
</span><a name="line-201"></a><a name="defineTableDerivableInstance"><a href="Database.Relational.Query.TH.html#defineTableDerivableInstance"><span class="hs-identifier">defineTableDerivableInstance</span></a></a><span> </span><a name="local-6989586621679522244"><a href="#local-6989586621679522244"><span class="hs-identifier">recordType'</span></a></a><span> </span><a name="local-6989586621679522245"><a href="#local-6989586621679522245"><span class="hs-identifier">table</span></a></a><span> </span><a name="local-6989586621679522246"><a href="#local-6989586621679522246"><span class="hs-identifier">columns</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-202"></a><span>  </span><span class="hs-special">[</span><span class="hs-identifier">d</span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">instance</span><span> </span><a href="Database.Relational.Query.Table.html#TableDerivable"><span class="hs-identifier hs-type">TableDerivable</span></a><span> </span><a href="#local-6989586621679522244"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">recordType'</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-203"></a><span>        </span><a name="derivedTable"><a href="Database.Relational.Query.Table.html#derivedTable"><span class="hs-identifier">derivedTable</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Database.Relational.Query.Table.html#table"><span class="hs-identifier hs-var">Table</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">table</span></a><span> </span><span class="hs-operator">$</span><span class="hs-special">(</span><span class="hs-identifier hs-var">stringE</span><span> </span><a href="#local-6989586621679522245"><span class="hs-identifier hs-var">table</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator">$</span><span class="hs-special">(</span><span class="hs-identifier hs-var">listE</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">stringE</span><span> </span><a href="#local-6989586621679522246"><span class="hs-identifier hs-var">columns</span></a><span class="hs-special">)</span><span>
</span><a name="line-204"></a><span>    </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-205"></a><span>
</span><a name="line-206"></a><span class="hs-comment">-- | Template to define inferred entries from table type.</span><span>
</span><a name="line-207"></a><span class="hs-identifier">defineTableDerivations</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">VarName</span><span> </span><span class="hs-comment">-- ^ Table declaration variable name</span><span>
</span><a name="line-208"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">VarName</span><span> </span><span class="hs-comment">-- ^ Relation declaration variable name</span><span>
</span><a name="line-209"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">VarName</span><span> </span><span class="hs-comment">-- ^ Insert statement declaration variable name</span><span>
</span><a name="line-210"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">VarName</span><span> </span><span class="hs-comment">-- ^ InsertQuery statement declaration variable name</span><span>
</span><a name="line-211"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span>   </span><span class="hs-comment">-- ^ Record type</span><span>
</span><a name="line-212"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Table and Relation declaration</span><span>
</span><a name="line-213"></a><a name="defineTableDerivations"><a href="Database.Relational.Query.TH.html#defineTableDerivations"><span class="hs-identifier">defineTableDerivations</span></a></a><span> </span><a name="local-6989586621679522250"><a href="#local-6989586621679522250"><span class="hs-identifier">tableVar'</span></a></a><span> </span><a name="local-6989586621679522251"><a href="#local-6989586621679522251"><span class="hs-identifier">relVar'</span></a></a><span> </span><a name="local-6989586621679522252"><a href="#local-6989586621679522252"><span class="hs-identifier">insVar'</span></a></a><span> </span><a name="local-6989586621679522253"><a href="#local-6989586621679522253"><span class="hs-identifier">insQVar'</span></a></a><span> </span><a name="local-6989586621679522254"><a href="#local-6989586621679522254"><span class="hs-identifier">recordType'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-214"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679522255"><a href="#local-6989586621679522255"><span class="hs-identifier">tableVar</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">varName</span><span> </span><a href="#local-6989586621679522250"><span class="hs-identifier hs-var">tableVar'</span></a><span>
</span><a name="line-215"></a><span>  </span><a name="local-6989586621679522257"><a href="#local-6989586621679522257"><span class="hs-identifier">tableDs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">simpleValD</span><span> </span><a href="#local-6989586621679522255"><span class="hs-identifier hs-var">tableVar</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier">t</span><span class="hs-glyph">|</span><span> </span><a href="Database.Relational.Query.Table.html#Table"><span class="hs-identifier hs-type">Table</span></a><span> </span><a href="#local-6989586621679522254"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">recordType'</span></a><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-216"></a><span>             </span><span class="hs-special">[</span><span class="hs-glyph">|</span><span> </span><a href="Database.Relational.Query.Table.html#derivedTable"><span class="hs-identifier hs-var">derivedTable</span></a><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-217"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679522258"><a href="#local-6989586621679522258"><span class="hs-identifier">relVar</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">varName</span><span> </span><a href="#local-6989586621679522251"><span class="hs-identifier hs-var">relVar'</span></a><span>
</span><a name="line-218"></a><span>  </span><a name="local-6989586621679522260"><a href="#local-6989586621679522260"><span class="hs-identifier">relDs</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">simpleValD</span><span> </span><a href="#local-6989586621679522258"><span class="hs-identifier hs-var">relVar</span></a><span>   </span><span class="hs-special">[</span><span class="hs-identifier">t</span><span class="hs-glyph">|</span><span> </span><a href="Database.Relational.Query.Monad.BaseType.html#Relation"><span class="hs-identifier hs-type">Relation</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679522254"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">recordType'</span></a><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-219"></a><span>             </span><span class="hs-special">[</span><span class="hs-glyph">|</span><span> </span><a href="Database.Relational.Query.Relation.html#derivedRelation"><span class="hs-identifier hs-var">derivedRelation</span></a><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-220"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679522261"><a href="#local-6989586621679522261"><span class="hs-identifier">insVar</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">varName</span><span> </span><a href="#local-6989586621679522252"><span class="hs-identifier hs-var">insVar'</span></a><span>
</span><a name="line-221"></a><span>  </span><a name="local-6989586621679522263"><a href="#local-6989586621679522263"><span class="hs-identifier">insDs</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">simpleValD</span><span> </span><a href="#local-6989586621679522261"><span class="hs-identifier hs-var">insVar</span></a><span>   </span><span class="hs-special">[</span><span class="hs-identifier">t</span><span class="hs-glyph">|</span><span> </span><a href="Database.Relational.Query.Type.html#Insert"><span class="hs-identifier hs-type">Insert</span></a><span> </span><a href="#local-6989586621679522254"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">recordType'</span></a><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-222"></a><span>             </span><span class="hs-special">[</span><span class="hs-glyph">|</span><span> </span><a href="Database.Relational.Query.Type.html#derivedInsert"><span class="hs-identifier hs-var">derivedInsert</span></a><span> </span><a href="Database.Relational.Query.Pi.html#id%27"><span class="hs-identifier hs-var">id'</span></a><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-223"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679522264"><a href="#local-6989586621679522264"><span class="hs-identifier">insQVar</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">varName</span><span> </span><a href="#local-6989586621679522253"><span class="hs-identifier hs-var">insQVar'</span></a><span>
</span><a name="line-224"></a><span>  </span><a name="local-6989586621679522267"><a href="#local-6989586621679522267"><span class="hs-identifier">insQDs</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">simpleValD</span><span> </span><a href="#local-6989586621679522264"><span class="hs-identifier hs-var">insQVar</span></a><span>  </span><span class="hs-special">[</span><span class="hs-identifier">t</span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679522265"><a href="#local-6989586621679522265"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-operator">.</span><span> </span><a href="Database.Relational.Query.Monad.BaseType.html#Relation"><span class="hs-identifier hs-type">Relation</span></a><span> </span><a href="#local-6989586621679522265"><span class="hs-identifier hs-type">p</span></a><span> </span><a href="#local-6989586621679522254"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">recordType'</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Relational.Query.Type.html#InsertQuery"><span class="hs-identifier hs-type">InsertQuery</span></a><span> </span><a href="#local-6989586621679522265"><span class="hs-identifier hs-type">p</span></a><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-225"></a><span>             </span><span class="hs-special">[</span><span class="hs-glyph">|</span><span> </span><a href="Database.Relational.Query.Type.html#derivedInsertQuery"><span class="hs-identifier hs-var">derivedInsertQuery</span></a><span> </span><a href="Database.Relational.Query.Pi.html#id%27"><span class="hs-identifier hs-var">id'</span></a><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-226"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679522257"><span class="hs-identifier hs-var">tableDs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679522260"><span class="hs-identifier hs-var">relDs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679522263"><span class="hs-identifier hs-var">insDs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679522267"><span class="hs-identifier hs-var">insQDs</span></a><span class="hs-special">]</span><span>
</span><a name="line-227"></a><span>
</span><a name="line-228"></a><span class="hs-comment">-- | 'Table' and 'Relation' templates.</span><span>
</span><a name="line-229"></a><span class="hs-identifier">defineTableTypes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">VarName</span><span>  </span><span class="hs-comment">-- ^ Table declaration variable name</span><span>
</span><a name="line-230"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">VarName</span><span>  </span><span class="hs-comment">-- ^ Relation declaration variable name</span><span>
</span><a name="line-231"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">VarName</span><span>  </span><span class="hs-comment">-- ^ Insert statement declaration variable name</span><span>
</span><a name="line-232"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">VarName</span><span>  </span><span class="hs-comment">-- ^ InsertQuery statement declaration variable name</span><span>
</span><a name="line-233"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span>    </span><span class="hs-comment">-- ^ Record type</span><span>
</span><a name="line-234"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>   </span><span class="hs-comment">-- ^ Table name in SQL ex. FOO_SCHEMA.table0</span><span>
</span><a name="line-235"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Column names</span><span>
</span><a name="line-236"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- ^ Table and Relation declaration</span><span>
</span><a name="line-237"></a><a name="defineTableTypes"><a href="Database.Relational.Query.TH.html#defineTableTypes"><span class="hs-identifier">defineTableTypes</span></a></a><span> </span><a name="local-6989586621679522268"><a href="#local-6989586621679522268"><span class="hs-identifier">tableVar'</span></a></a><span> </span><a name="local-6989586621679522269"><a href="#local-6989586621679522269"><span class="hs-identifier">relVar'</span></a></a><span> </span><a name="local-6989586621679522270"><a href="#local-6989586621679522270"><span class="hs-identifier">insVar'</span></a></a><span> </span><a name="local-6989586621679522271"><a href="#local-6989586621679522271"><span class="hs-identifier">insQVar'</span></a></a><span> </span><a name="local-6989586621679522272"><a href="#local-6989586621679522272"><span class="hs-identifier">recordType'</span></a></a><span> </span><a name="local-6989586621679522273"><a href="#local-6989586621679522273"><span class="hs-identifier">table</span></a></a><span> </span><a name="local-6989586621679522274"><a href="#local-6989586621679522274"><span class="hs-identifier">columns</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-238"></a><span>  </span><a name="local-6989586621679522275"><a href="#local-6989586621679522275"><span class="hs-identifier">iDs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.Relational.Query.TH.html#defineTableDerivableInstance"><span class="hs-identifier hs-var">defineTableDerivableInstance</span></a><span> </span><a href="#local-6989586621679522272"><span class="hs-identifier hs-var">recordType'</span></a><span> </span><a href="#local-6989586621679522273"><span class="hs-identifier hs-var">table</span></a><span> </span><a href="#local-6989586621679522274"><span class="hs-identifier hs-var">columns</span></a><span>
</span><a name="line-239"></a><span>  </span><a name="local-6989586621679522276"><a href="#local-6989586621679522276"><span class="hs-identifier">dDs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.Relational.Query.TH.html#defineTableDerivations"><span class="hs-identifier hs-var">defineTableDerivations</span></a><span> </span><a href="#local-6989586621679522268"><span class="hs-identifier hs-var">tableVar'</span></a><span> </span><a href="#local-6989586621679522269"><span class="hs-identifier hs-var">relVar'</span></a><span> </span><a href="#local-6989586621679522270"><span class="hs-identifier hs-var">insVar'</span></a><span> </span><a href="#local-6989586621679522271"><span class="hs-identifier hs-var">insQVar'</span></a><span> </span><a href="#local-6989586621679522272"><span class="hs-identifier hs-var">recordType'</span></a><span>
</span><a name="line-240"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679522275"><span class="hs-identifier hs-var">iDs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679522276"><span class="hs-identifier hs-var">dDs</span></a><span>
</span><a name="line-241"></a><span>
</span><a name="line-242"></a><span class="hs-identifier">tableSQL</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Relational.Query.Internal.Config.html#SchemaNameMode"><span class="hs-identifier hs-type">SchemaNameMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Relational.Query.Internal.Config.html#IdentifierQuotation"><span class="hs-identifier hs-type">IdentifierQuotation</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-243"></a><a name="tableSQL"><a href="Database.Relational.Query.TH.html#tableSQL"><span class="hs-identifier">tableSQL</span></a></a><span> </span><a name="local-6989586621679522277"><a href="#local-6989586621679522277"><span class="hs-identifier">normalize</span></a></a><span> </span><a name="local-6989586621679522278"><a href="#local-6989586621679522278"><span class="hs-identifier">snm</span></a></a><span> </span><a name="local-6989586621679522279"><a href="#local-6989586621679522279"><span class="hs-identifier">iq</span></a></a><span> </span><a name="local-6989586621679522280"><a href="#local-6989586621679522280"><span class="hs-identifier">schema</span></a></a><span> </span><a name="local-6989586621679522281"><a href="#local-6989586621679522281"><span class="hs-identifier">table</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679522278"><span class="hs-identifier hs-var">snm</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-244"></a><span>  </span><a href="Database.Relational.Query.Internal.Config.html#SchemaQualified"><span class="hs-identifier hs-var">SchemaQualified</span></a><span>     </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-special">(</span><a href="#local-6989586621679522284"><span class="hs-identifier hs-var">qt</span></a><span> </span><a href="#local-6989586621679522282"><span class="hs-identifier hs-var">normalizeS</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-char">'.'</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679522284"><span class="hs-identifier hs-var">qt</span></a><span> </span><a href="#local-6989586621679522283"><span class="hs-identifier hs-var">normalizeT</span></a><span class="hs-special">)</span><span>
</span><a name="line-245"></a><span>  </span><a href="Database.Relational.Query.Internal.Config.html#SchemaNotQualified"><span class="hs-identifier hs-var">SchemaNotQualified</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-special">(</span><a href="#local-6989586621679522284"><span class="hs-identifier hs-var">qt</span></a><span> </span><a href="#local-6989586621679522283"><span class="hs-identifier hs-var">normalizeT</span></a><span class="hs-special">)</span><span>
</span><a name="line-246"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-247"></a><span>    </span><a name="local-6989586621679522282"><a href="#local-6989586621679522282"><span class="hs-identifier">normalizeS</span></a></a><span>
</span><a name="line-248"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679522277"><span class="hs-identifier hs-var">normalize</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">toUpper</span><span> </span><a href="#local-6989586621679522280"><span class="hs-identifier hs-var">schema</span></a><span>
</span><a name="line-249"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679522280"><span class="hs-identifier hs-var">schema</span></a><span>
</span><a name="line-250"></a><span>    </span><a name="local-6989586621679522283"><a href="#local-6989586621679522283"><span class="hs-identifier">normalizeT</span></a></a><span>
</span><a name="line-251"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679522277"><span class="hs-identifier hs-var">normalize</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">toLower</span><span> </span><a href="#local-6989586621679522281"><span class="hs-identifier hs-var">table</span></a><span>
</span><a name="line-252"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679522281"><span class="hs-identifier hs-var">table</span></a><span>
</span><a name="line-253"></a><span>    </span><a name="local-6989586621679522284"><a href="#local-6989586621679522284"><span class="hs-identifier">qt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Database.Relational.Query.TH.html#quote"><span class="hs-identifier hs-var">quote</span></a><span> </span><a href="#local-6989586621679522279"><span class="hs-identifier hs-var">iq</span></a><span>
</span><a name="line-254"></a><span>
</span><a name="line-255"></a><span class="hs-identifier">quote</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Relational.Query.Internal.Config.html#IdentifierQuotation"><span class="hs-identifier hs-type">IdentifierQuotation</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-256"></a><a name="quote"><a href="Database.Relational.Query.TH.html#quote"><span class="hs-identifier">quote</span></a></a><span> </span><a href="Database.Relational.Query.Internal.Config.html#NoQuotation"><span class="hs-identifier hs-var">NoQuotation</span></a><span>   </span><a name="local-6989586621679522562"><a href="#local-6989586621679522562"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679522562"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-257"></a><span class="hs-identifier">quote</span><span> </span><span class="hs-special">(</span><a href="Database.Relational.Query.Internal.Config.html#Quotation"><span class="hs-identifier hs-var">Quotation</span></a><span> </span><a name="local-6989586621679522563"><a href="#local-6989586621679522563"><span class="hs-identifier">q</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679522564"><a href="#local-6989586621679522564"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679522563"><span class="hs-identifier hs-var">q</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679522565"><span class="hs-identifier hs-var">escape</span></a><span> </span><a href="#local-6989586621679522564"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679522563"><span class="hs-identifier hs-var">q</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-258"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679522565"><a href="#local-6989586621679522565"><span class="hs-identifier">escape</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679522566"><a href="#local-6989586621679522566"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679522566"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679522563"><span class="hs-identifier hs-var">q</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679522563"><span class="hs-identifier hs-var">q</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679522563"><span class="hs-identifier hs-var">q</span></a><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679522566"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-259"></a><span>
</span><a name="line-260"></a><span class="hs-identifier">derivationVarNameDefault</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">VarName</span><span>
</span><a name="line-261"></a><a name="derivationVarNameDefault"><a href="Database.Relational.Query.TH.html#derivationVarNameDefault"><span class="hs-identifier">derivationVarNameDefault</span></a></a><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">varNameWithPrefix</span><span class="hs-special">`</span><span> </span><span class="hs-string">&quot;derivationFrom&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-262"></a><span>
</span><a name="line-263"></a><span class="hs-comment">-- | Make 'TableDerivation' variable expression template from table name using default naming rule.</span><span>
</span><a name="line-264"></a><span class="hs-identifier">derivationExpDefault</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-comment">-- ^ Table name string</span><span>
</span><a name="line-265"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ExpQ</span><span>   </span><span class="hs-comment">-- ^ Result var Exp</span><span>
</span><a name="line-266"></a><a name="derivationExpDefault"><a href="Database.Relational.Query.TH.html#derivationExpDefault"><span class="hs-identifier">derivationExpDefault</span></a></a><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-identifier hs-var">toVarExp</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Database.Relational.Query.TH.html#derivationVarNameDefault"><span class="hs-identifier hs-var">derivationVarNameDefault</span></a><span>
</span><a name="line-267"></a><span>
</span><a name="line-268"></a><span class="hs-identifier">tableVarNameDefault</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">VarName</span><span>
</span><a name="line-269"></a><a name="tableVarNameDefault"><a href="Database.Relational.Query.TH.html#tableVarNameDefault"><span class="hs-identifier">tableVarNameDefault</span></a></a><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">varNameWithPrefix</span><span class="hs-special">`</span><span> </span><span class="hs-string">&quot;tableOf&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-270"></a><span>
</span><a name="line-271"></a><span class="hs-comment">-- | Make 'Table' variable expression template from table name using default naming rule.</span><span>
</span><a name="line-272"></a><span class="hs-identifier">tableVarExpDefault</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-comment">-- ^ Table name string</span><span>
</span><a name="line-273"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ExpQ</span><span>   </span><span class="hs-comment">-- ^ Result var Exp</span><span>
</span><a name="line-274"></a><a name="tableVarExpDefault"><a href="Database.Relational.Query.TH.html#tableVarExpDefault"><span class="hs-identifier">tableVarExpDefault</span></a></a><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-identifier hs-var">toVarExp</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Database.Relational.Query.TH.html#tableVarNameDefault"><span class="hs-identifier hs-var">tableVarNameDefault</span></a><span>
</span><a name="line-275"></a><span>
</span><a name="line-276"></a><span class="hs-comment">-- | Make 'Relation' variable expression template from table name using specified naming rule.</span><span>
</span><a name="line-277"></a><span class="hs-identifier">relationVarExp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Relational.Query.Internal.Config.html#Config"><span class="hs-identifier hs-type">Config</span></a><span> </span><span class="hs-comment">-- ^ Configuration which has  naming rules of templates</span><span>
</span><a name="line-278"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-comment">-- ^ Schema name string</span><span>
</span><a name="line-279"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-comment">-- ^ Table name string</span><span>
</span><a name="line-280"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ExpQ</span><span>   </span><span class="hs-comment">-- ^ Result var Exp</span><span>
</span><a name="line-281"></a><a name="relationVarExp"><a href="Database.Relational.Query.TH.html#relationVarExp"><span class="hs-identifier">relationVarExp</span></a></a><span> </span><a name="local-6989586621679522567"><a href="#local-6989586621679522567"><span class="hs-identifier">config</span></a></a><span> </span><a name="local-6989586621679522568"><a href="#local-6989586621679522568"><span class="hs-identifier">scm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toVarExp</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">relationVarName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">nameConfig</span><span> </span><a href="#local-6989586621679522567"><span class="hs-identifier hs-var">config</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679522568"><span class="hs-identifier hs-var">scm</span></a><span>
</span><a name="line-282"></a><span>
</span><a name="line-283"></a><span class="hs-comment">-- | Make template for record 'ProductConstructor' instance using specified naming rule.</span><span>
</span><a name="line-284"></a><span class="hs-identifier">defineProductConstructorInstanceWithConfig</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Relational.Query.Internal.Config.html#Config"><span class="hs-identifier hs-type">Config</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TypeQ</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span>
</span><a name="line-285"></a><a name="defineProductConstructorInstanceWithConfig"><a href="Database.Relational.Query.TH.html#defineProductConstructorInstanceWithConfig"><span class="hs-identifier">defineProductConstructorInstanceWithConfig</span></a></a><span> </span><a name="local-6989586621679522569"><a href="#local-6989586621679522569"><span class="hs-identifier">config</span></a></a><span> </span><a name="local-6989586621679522570"><a href="#local-6989586621679522570"><span class="hs-identifier">schema</span></a></a><span> </span><a name="local-6989586621679522571"><a href="#local-6989586621679522571"><span class="hs-identifier">table</span></a></a><span> </span><a name="local-6989586621679522572"><a href="#local-6989586621679522572"><span class="hs-identifier">colTypes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-286"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679522573"><a href="#local-6989586621679522573"><span class="hs-identifier">tp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">recordTemplate</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">recordConfig</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">nameConfig</span><span> </span><a href="#local-6989586621679522569"><span class="hs-identifier hs-var">config</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679522570"><span class="hs-identifier hs-var">schema</span></a><span> </span><a href="#local-6989586621679522571"><span class="hs-identifier hs-var">table</span></a><span>
</span><a name="line-287"></a><span>  </span><span class="hs-identifier hs-var">uncurry</span><span> </span><a href="Database.Relational.Query.BaseTH.html#defineProductConstructorInstance"><span class="hs-identifier hs-var">defineProductConstructorInstance</span></a><span> </span><a href="#local-6989586621679522573"><span class="hs-identifier hs-var">tp</span></a><span> </span><a href="#local-6989586621679522572"><span class="hs-identifier hs-var">colTypes</span></a><span>
</span><a name="line-288"></a><span>
</span><a name="line-289"></a><span class="hs-comment">-- | Make templates about table and column metadatas using specified naming rule.</span><span>
</span><a name="line-290"></a><span class="hs-identifier">defineTableTypesWithConfig</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Relational.Query.Internal.Config.html#Config"><span class="hs-identifier hs-type">Config</span></a><span>                           </span><span class="hs-comment">-- ^ Configuration to generate query with</span><span>
</span><a name="line-291"></a><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>                           </span><span class="hs-comment">-- ^ Schema name</span><span>
</span><a name="line-292"></a><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>                           </span><span class="hs-comment">-- ^ Table name</span><span>
</span><a name="line-293"></a><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Column names and types and constraint type</span><span>
</span><a name="line-294"></a><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span>                          </span><span class="hs-comment">-- ^ Result declarations</span><span>
</span><a name="line-295"></a><a name="defineTableTypesWithConfig"><a href="Database.Relational.Query.TH.html#defineTableTypesWithConfig"><span class="hs-identifier">defineTableTypesWithConfig</span></a></a><span> </span><a name="local-6989586621679522574"><a href="#local-6989586621679522574"><span class="hs-identifier">config</span></a></a><span> </span><a name="local-6989586621679522575"><a href="#local-6989586621679522575"><span class="hs-identifier">schema</span></a></a><span> </span><a name="local-6989586621679522576"><a href="#local-6989586621679522576"><span class="hs-identifier">table</span></a></a><span> </span><a name="local-6989586621679522577"><a href="#local-6989586621679522577"><span class="hs-identifier">columns</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-296"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679522578"><a href="#local-6989586621679522578"><span class="hs-identifier">nmconfig</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">nameConfig</span><span> </span><a href="#local-6989586621679522574"><span class="hs-identifier hs-var">config</span></a><span>
</span><a name="line-297"></a><span>      </span><a name="local-6989586621679522579"><a href="#local-6989586621679522579"><span class="hs-identifier">recConfig</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">recordConfig</span><span> </span><a href="#local-6989586621679522578"><span class="hs-identifier hs-var">nmconfig</span></a><span>
</span><a name="line-298"></a><span>  </span><a name="local-6989586621679522580"><a href="#local-6989586621679522580"><span class="hs-identifier">tableDs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.Relational.Query.TH.html#defineTableTypes"><span class="hs-identifier hs-var">defineTableTypes</span></a><span>
</span><a name="line-299"></a><span>             </span><span class="hs-special">(</span><a href="Database.Relational.Query.TH.html#tableVarNameDefault"><span class="hs-identifier hs-var">tableVarNameDefault</span></a><span> </span><a href="#local-6989586621679522576"><span class="hs-identifier hs-var">table</span></a><span class="hs-special">)</span><span>
</span><a name="line-300"></a><span>             </span><span class="hs-special">(</span><span class="hs-identifier">relationVarName</span><span> </span><a href="#local-6989586621679522578"><span class="hs-identifier hs-var">nmconfig</span></a><span> </span><a href="#local-6989586621679522575"><span class="hs-identifier hs-var">schema</span></a><span> </span><a href="#local-6989586621679522576"><span class="hs-identifier hs-var">table</span></a><span class="hs-special">)</span><span>
</span><a name="line-301"></a><span>             </span><span class="hs-special">(</span><a href="#local-6989586621679522576"><span class="hs-identifier hs-var">table</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">varNameWithPrefix</span><span class="hs-special">`</span><span> </span><span class="hs-string">&quot;insert&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-302"></a><span>             </span><span class="hs-special">(</span><a href="#local-6989586621679522576"><span class="hs-identifier hs-var">table</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">varNameWithPrefix</span><span class="hs-special">`</span><span> </span><span class="hs-string">&quot;insertQuery&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-303"></a><span>             </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">recordTemplate</span><span> </span><a href="#local-6989586621679522579"><span class="hs-identifier hs-var">recConfig</span></a><span> </span><a href="#local-6989586621679522575"><span class="hs-identifier hs-var">schema</span></a><span> </span><a href="#local-6989586621679522576"><span class="hs-identifier hs-var">table</span></a><span class="hs-special">)</span><span>
</span><a name="line-304"></a><span>             </span><span class="hs-special">(</span><a href="Database.Relational.Query.TH.html#tableSQL"><span class="hs-identifier hs-var">tableSQL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">normalizedTableName</span><span> </span><a href="#local-6989586621679522574"><span class="hs-identifier hs-var">config</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">schemaNameMode</span><span> </span><a href="#local-6989586621679522574"><span class="hs-identifier hs-var">config</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">identifierQuotation</span><span> </span><a href="#local-6989586621679522574"><span class="hs-identifier hs-var">config</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679522575"><span class="hs-identifier hs-var">schema</span></a><span> </span><a href="#local-6989586621679522576"><span class="hs-identifier hs-var">table</span></a><span class="hs-special">)</span><span>
</span><a name="line-305"></a><span>             </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Database.Relational.Query.TH.html#quote"><span class="hs-identifier hs-var">quote</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">identifierQuotation</span><span> </span><a href="#local-6989586621679522574"><span class="hs-identifier hs-var">config</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fst</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679522577"><span class="hs-identifier hs-var">columns</span></a><span class="hs-special">)</span><span>
</span><a name="line-306"></a><span>  </span><a name="local-6989586621679522581"><a href="#local-6989586621679522581"><span class="hs-identifier">colsDs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.Relational.Query.TH.html#defineColumnsDefault"><span class="hs-identifier hs-var">defineColumnsDefault</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">recordTypeName</span><span> </span><a href="#local-6989586621679522579"><span class="hs-identifier hs-var">recConfig</span></a><span> </span><a href="#local-6989586621679522575"><span class="hs-identifier hs-var">schema</span></a><span> </span><a href="#local-6989586621679522576"><span class="hs-identifier hs-var">table</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679522577"><span class="hs-identifier hs-var">columns</span></a><span>
</span><a name="line-307"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679522580"><span class="hs-identifier hs-var">tableDs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679522581"><span class="hs-identifier hs-var">colsDs</span></a><span>
</span><a name="line-308"></a><span>
</span><a name="line-309"></a><span class="hs-comment">-- | Make templates about table, column and haskell record using specified naming rule.</span><span>
</span><a name="line-310"></a><span class="hs-identifier">defineTableTypesAndRecord</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Relational.Query.Internal.Config.html#Config"><span class="hs-identifier hs-type">Config</span></a><span>            </span><span class="hs-comment">-- ^ Configuration to generate query with</span><span>
</span><a name="line-311"></a><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>            </span><span class="hs-comment">-- ^ Schema name</span><span>
</span><a name="line-312"></a><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>            </span><span class="hs-comment">-- ^ Table name</span><span>
</span><a name="line-313"></a><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Column names and types</span><span>
</span><a name="line-314"></a><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span>            </span><span class="hs-comment">-- ^ Record derivings</span><span>
</span><a name="line-315"></a><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span>           </span><span class="hs-comment">-- ^ Result declarations</span><span>
</span><a name="line-316"></a><a name="defineTableTypesAndRecord"><a href="Database.Relational.Query.TH.html#defineTableTypesAndRecord"><span class="hs-identifier">defineTableTypesAndRecord</span></a></a><span> </span><a name="local-6989586621679522582"><a href="#local-6989586621679522582"><span class="hs-identifier">config</span></a></a><span> </span><a name="local-6989586621679522583"><a href="#local-6989586621679522583"><span class="hs-identifier">schema</span></a></a><span> </span><a name="local-6989586621679522584"><a href="#local-6989586621679522584"><span class="hs-identifier">table</span></a></a><span> </span><a name="local-6989586621679522585"><a href="#local-6989586621679522585"><span class="hs-identifier">columns</span></a></a><span> </span><a name="local-6989586621679522586"><a href="#local-6989586621679522586"><span class="hs-identifier">derives</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-317"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679522587"><a href="#local-6989586621679522587"><span class="hs-identifier">recConfig</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">recordConfig</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">nameConfig</span><span> </span><a href="#local-6989586621679522582"><span class="hs-identifier hs-var">config</span></a><span>
</span><a name="line-318"></a><span>  </span><a name="local-6989586621679522588"><a href="#local-6989586621679522588"><span class="hs-identifier">recD</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">defineRecordTypeWithConfig</span><span> </span><a href="#local-6989586621679522587"><span class="hs-identifier hs-var">recConfig</span></a><span> </span><a href="#local-6989586621679522583"><span class="hs-identifier hs-var">schema</span></a><span> </span><a href="#local-6989586621679522584"><span class="hs-identifier hs-var">table</span></a><span> </span><a href="#local-6989586621679522585"><span class="hs-identifier hs-var">columns</span></a><span> </span><a href="#local-6989586621679522586"><span class="hs-identifier hs-var">derives</span></a><span>
</span><a name="line-319"></a><span>  </span><a name="local-6989586621679522590"><a href="#local-6989586621679522590"><span class="hs-identifier">rconD</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.Relational.Query.TH.html#defineProductConstructorInstanceWithConfig"><span class="hs-identifier hs-var">defineProductConstructorInstanceWithConfig</span></a><span> </span><a href="#local-6989586621679522582"><span class="hs-identifier hs-var">config</span></a><span> </span><a href="#local-6989586621679522583"><span class="hs-identifier hs-var">schema</span></a><span> </span><a href="#local-6989586621679522584"><span class="hs-identifier hs-var">table</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679522589"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679522589"><a href="#local-6989586621679522589"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679522585"><span class="hs-identifier hs-var">columns</span></a><span class="hs-special">]</span><span>
</span><a name="line-320"></a><span>  </span><a name="local-6989586621679522592"><a href="#local-6989586621679522592"><span class="hs-identifier">ctD</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">d</span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">instance</span><span> </span><a href="Database.Relational.Query.ProjectableClass.html#ShowConstantTermsSQL"><span class="hs-identifier hs-type">ShowConstantTermsSQL</span></a><span> </span><span class="hs-operator">$</span><span class="hs-special">(</span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">recordTemplate</span><span> </span><a href="#local-6989586621679522587"><span class="hs-identifier hs-var">recConfig</span></a><span> </span><a href="#local-6989586621679522583"><span class="hs-identifier hs-var">schema</span></a><span> </span><a href="#local-6989586621679522584"><span class="hs-identifier hs-var">table</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-321"></a><span>  </span><a name="local-6989586621679522594"><a href="#local-6989586621679522594"><span class="hs-identifier">tableDs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.Relational.Query.TH.html#defineTableTypesWithConfig"><span class="hs-identifier hs-var">defineTableTypesWithConfig</span></a><span> </span><a href="#local-6989586621679522582"><span class="hs-identifier hs-var">config</span></a><span> </span><a href="#local-6989586621679522583"><span class="hs-identifier hs-var">schema</span></a><span> </span><a href="#local-6989586621679522584"><span class="hs-identifier hs-var">table</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679522593"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679522593"><a href="#local-6989586621679522593"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679522585"><span class="hs-identifier hs-var">columns</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-322"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679522588"><span class="hs-identifier hs-var">recD</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679522590"><span class="hs-identifier hs-var">rconD</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679522592"><span class="hs-identifier hs-var">ctD</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679522594"><span class="hs-identifier hs-var">tableDs</span></a><span>
</span><a name="line-323"></a><span>
</span><a name="line-324"></a><span class="hs-comment">-- | Template of derived primary 'Query'.</span><span>
</span><a name="line-325"></a><span class="hs-identifier">definePrimaryQuery</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">VarName</span><span> </span><span class="hs-comment">-- ^ Variable name of result declaration</span><span>
</span><a name="line-326"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span>   </span><span class="hs-comment">-- ^ Parameter type of 'Query'</span><span>
</span><a name="line-327"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span>   </span><span class="hs-comment">-- ^ Record type of 'Query'</span><span>
</span><a name="line-328"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ExpQ</span><span>    </span><span class="hs-comment">-- ^ 'Relation' expression</span><span>
</span><a name="line-329"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Result 'Query' declaration</span><span>
</span><a name="line-330"></a><a name="definePrimaryQuery"><a href="Database.Relational.Query.TH.html#definePrimaryQuery"><span class="hs-identifier">definePrimaryQuery</span></a></a><span> </span><a name="local-6989586621679522595"><a href="#local-6989586621679522595"><span class="hs-identifier">toDef'</span></a></a><span> </span><a name="local-6989586621679522596"><a href="#local-6989586621679522596"><span class="hs-identifier">paramType</span></a></a><span> </span><a name="local-6989586621679522597"><a href="#local-6989586621679522597"><span class="hs-identifier">recType</span></a></a><span> </span><a name="local-6989586621679522598"><a href="#local-6989586621679522598"><span class="hs-identifier">relE</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-331"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679522599"><a href="#local-6989586621679522599"><span class="hs-identifier">toDef</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">varName</span><span> </span><a href="#local-6989586621679522595"><span class="hs-identifier hs-var">toDef'</span></a><span>
</span><a name="line-332"></a><span>  </span><span class="hs-identifier hs-var">simpleValD</span><span> </span><a href="#local-6989586621679522599"><span class="hs-identifier hs-var">toDef</span></a><span>
</span><a name="line-333"></a><span>    </span><span class="hs-special">[</span><span class="hs-identifier">t</span><span class="hs-glyph">|</span><span> </span><a href="Database.Relational.Query.Type.html#Query"><span class="hs-identifier hs-type">Query</span></a><span> </span><a href="#local-6989586621679522596"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">paramType</span></a><span> </span><a href="#local-6989586621679522597"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">recType</span></a><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-334"></a><span>    </span><span class="hs-special">[</span><span class="hs-glyph">|</span><span>  </span><a href="Database.Relational.Query.Type.html#relationalQuery"><span class="hs-identifier hs-var">relationalQuery</span></a><span> </span><span class="hs-special">(</span><a href="Database.Relational.Query.Derives.html#primary"><span class="hs-identifier hs-var">primary</span></a><span> </span><a href="#local-6989586621679522598"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">relE</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-335"></a><span>
</span><a name="line-336"></a><span class="hs-comment">-- | Template of derived primary 'Update'.</span><span>
</span><a name="line-337"></a><span class="hs-identifier">definePrimaryUpdate</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">VarName</span><span> </span><span class="hs-comment">-- ^ Variable name of result declaration</span><span>
</span><a name="line-338"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span>   </span><span class="hs-comment">-- ^ Parameter type of 'Update'</span><span>
</span><a name="line-339"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span>   </span><span class="hs-comment">-- ^ Record type of 'Update'</span><span>
</span><a name="line-340"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ExpQ</span><span>    </span><span class="hs-comment">-- ^ 'Table' expression</span><span>
</span><a name="line-341"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Result 'Update' declaration</span><span>
</span><a name="line-342"></a><a name="definePrimaryUpdate"><a href="Database.Relational.Query.TH.html#definePrimaryUpdate"><span class="hs-identifier">definePrimaryUpdate</span></a></a><span> </span><a name="local-6989586621679522603"><a href="#local-6989586621679522603"><span class="hs-identifier">toDef'</span></a></a><span> </span><a name="local-6989586621679522604"><a href="#local-6989586621679522604"><span class="hs-identifier">paramType</span></a></a><span> </span><a name="local-6989586621679522605"><a href="#local-6989586621679522605"><span class="hs-identifier">recType</span></a></a><span> </span><a name="local-6989586621679522606"><a href="#local-6989586621679522606"><span class="hs-identifier">tableE</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-343"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679522607"><a href="#local-6989586621679522607"><span class="hs-identifier">toDef</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">varName</span><span> </span><a href="#local-6989586621679522603"><span class="hs-identifier hs-var">toDef'</span></a><span>
</span><a name="line-344"></a><span>  </span><span class="hs-identifier hs-var">simpleValD</span><span> </span><a href="#local-6989586621679522607"><span class="hs-identifier hs-var">toDef</span></a><span>
</span><a name="line-345"></a><span>    </span><span class="hs-special">[</span><span class="hs-identifier">t</span><span class="hs-glyph">|</span><span> </span><a href="Database.Relational.Query.Type.html#KeyUpdate"><span class="hs-identifier hs-type">KeyUpdate</span></a><span> </span><a href="#local-6989586621679522604"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">paramType</span></a><span> </span><a href="#local-6989586621679522605"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">recType</span></a><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-346"></a><span>    </span><span class="hs-special">[</span><span class="hs-glyph">|</span><span>  </span><a href="Database.Relational.Query.Derives.html#primaryUpdate"><span class="hs-identifier hs-var">primaryUpdate</span></a><span> </span><a href="#local-6989586621679522606"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">tableE</span></a><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-347"></a><span>
</span><a name="line-348"></a><span>
</span><a name="line-349"></a><span class="hs-comment">-- | SQL templates derived from primary key.</span><span>
</span><a name="line-350"></a><span class="hs-identifier">defineSqlsWithPrimaryKey</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">VarName</span><span> </span><span class="hs-comment">-- ^ Variable name of select query definition from primary key</span><span>
</span><a name="line-351"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">VarName</span><span> </span><span class="hs-comment">-- ^ Variable name of update statement definition from primary key</span><span>
</span><a name="line-352"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span>   </span><span class="hs-comment">-- ^ Primary key type</span><span>
</span><a name="line-353"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span>   </span><span class="hs-comment">-- ^ Record type</span><span>
</span><a name="line-354"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ExpQ</span><span>    </span><span class="hs-comment">-- ^ Relation expression</span><span>
</span><a name="line-355"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ExpQ</span><span>    </span><span class="hs-comment">-- ^ Table expression</span><span>
</span><a name="line-356"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Result declarations</span><span>
</span><a name="line-357"></a><a name="defineSqlsWithPrimaryKey"><a href="Database.Relational.Query.TH.html#defineSqlsWithPrimaryKey"><span class="hs-identifier">defineSqlsWithPrimaryKey</span></a></a><span> </span><a name="local-6989586621679522611"><a href="#local-6989586621679522611"><span class="hs-identifier">sel</span></a></a><span> </span><a name="local-6989586621679522612"><a href="#local-6989586621679522612"><span class="hs-identifier">upd</span></a></a><span> </span><a name="local-6989586621679522613"><a href="#local-6989586621679522613"><span class="hs-identifier">paramType</span></a></a><span> </span><a name="local-6989586621679522614"><a href="#local-6989586621679522614"><span class="hs-identifier">recType</span></a></a><span> </span><a name="local-6989586621679522615"><a href="#local-6989586621679522615"><span class="hs-identifier">relE</span></a></a><span> </span><a name="local-6989586621679522616"><a href="#local-6989586621679522616"><span class="hs-identifier">tableE</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-358"></a><span>  </span><a name="local-6989586621679522617"><a href="#local-6989586621679522617"><span class="hs-identifier">selD</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.Relational.Query.TH.html#definePrimaryQuery"><span class="hs-identifier hs-var">definePrimaryQuery</span></a><span>  </span><a href="#local-6989586621679522611"><span class="hs-identifier hs-var">sel</span></a><span> </span><a href="#local-6989586621679522613"><span class="hs-identifier hs-var">paramType</span></a><span> </span><a href="#local-6989586621679522614"><span class="hs-identifier hs-var">recType</span></a><span> </span><a href="#local-6989586621679522615"><span class="hs-identifier hs-var">relE</span></a><span>
</span><a name="line-359"></a><span>  </span><a name="local-6989586621679522618"><a href="#local-6989586621679522618"><span class="hs-identifier">updD</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.Relational.Query.TH.html#definePrimaryUpdate"><span class="hs-identifier hs-var">definePrimaryUpdate</span></a><span> </span><a href="#local-6989586621679522612"><span class="hs-identifier hs-var">upd</span></a><span> </span><a href="#local-6989586621679522613"><span class="hs-identifier hs-var">paramType</span></a><span> </span><a href="#local-6989586621679522614"><span class="hs-identifier hs-var">recType</span></a><span> </span><a href="#local-6989586621679522616"><span class="hs-identifier hs-var">tableE</span></a><span>
</span><a name="line-360"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679522617"><span class="hs-identifier hs-var">selD</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679522618"><span class="hs-identifier hs-var">updD</span></a><span>
</span><a name="line-361"></a><span>
</span><a name="line-362"></a><span class="hs-comment">-- | SQL templates derived from primary key using default naming rule.</span><span>
</span><a name="line-363"></a><span class="hs-identifier">defineSqlsWithPrimaryKeyDefault</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>  </span><span class="hs-comment">-- ^ Table name of Database</span><span>
</span><a name="line-364"></a><span>                                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span>   </span><span class="hs-comment">-- ^ Primary key type</span><span>
</span><a name="line-365"></a><span>                                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span>   </span><span class="hs-comment">-- ^ Record type</span><span>
</span><a name="line-366"></a><span>                                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ExpQ</span><span>    </span><span class="hs-comment">-- ^ Relation expression</span><span>
</span><a name="line-367"></a><span>                                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ExpQ</span><span>    </span><span class="hs-comment">-- ^ Table expression</span><span>
</span><a name="line-368"></a><span>                                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Result declarations</span><span>
</span><a name="line-369"></a><a name="defineSqlsWithPrimaryKeyDefault"><a href="Database.Relational.Query.TH.html#defineSqlsWithPrimaryKeyDefault"><span class="hs-identifier">defineSqlsWithPrimaryKeyDefault</span></a></a><span> </span><a name="local-6989586621679522619"><a href="#local-6989586621679522619"><span class="hs-identifier">table</span></a></a><span>  </span><span class="hs-glyph">=</span><span>
</span><a name="line-370"></a><span>  </span><a href="Database.Relational.Query.TH.html#defineSqlsWithPrimaryKey"><span class="hs-identifier hs-var">defineSqlsWithPrimaryKey</span></a><span> </span><a href="#local-6989586621679522620"><span class="hs-identifier hs-var">sel</span></a><span> </span><a href="#local-6989586621679522621"><span class="hs-identifier hs-var">upd</span></a><span>
</span><a name="line-371"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-372"></a><span>    </span><a name="local-6989586621679522620"><a href="#local-6989586621679522620"><span class="hs-identifier">sel</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679522619"><span class="hs-identifier hs-var">table</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">varNameWithPrefix</span><span class="hs-special">`</span><span> </span><span class="hs-string">&quot;select&quot;</span><span>
</span><a name="line-373"></a><span>    </span><a name="local-6989586621679522621"><a href="#local-6989586621679522621"><span class="hs-identifier">upd</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679522619"><span class="hs-identifier hs-var">table</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">varNameWithPrefix</span><span class="hs-special">`</span><span> </span><span class="hs-string">&quot;update&quot;</span><span>
</span><a name="line-374"></a><span>
</span><a name="line-375"></a><span class="hs-comment">-- | All templates about primary key.</span><span>
</span><a name="line-376"></a><span class="hs-identifier">defineWithPrimaryKey</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Relational.Query.Internal.Config.html#Config"><span class="hs-identifier hs-type">Config</span></a><span>
</span><a name="line-377"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>  </span><span class="hs-comment">-- ^ Schema name</span><span>
</span><a name="line-378"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>  </span><span class="hs-comment">-- ^ Table name string</span><span>
</span><a name="line-379"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span>   </span><span class="hs-comment">-- ^ Type of primary key</span><span>
</span><a name="line-380"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- ^ Indexes specifies primary key</span><span>
</span><a name="line-381"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Result declarations</span><span>
</span><a name="line-382"></a><a name="defineWithPrimaryKey"><a href="Database.Relational.Query.TH.html#defineWithPrimaryKey"><span class="hs-identifier">defineWithPrimaryKey</span></a></a><span> </span><a name="local-6989586621679522622"><a href="#local-6989586621679522622"><span class="hs-identifier">config</span></a></a><span> </span><a name="local-6989586621679522623"><a href="#local-6989586621679522623"><span class="hs-identifier">schema</span></a></a><span> </span><a name="local-6989586621679522624"><a href="#local-6989586621679522624"><span class="hs-identifier">table</span></a></a><span> </span><a name="local-6989586621679522625"><a href="#local-6989586621679522625"><span class="hs-identifier">keyType</span></a></a><span> </span><a name="local-6989586621679522626"><a href="#local-6989586621679522626"><span class="hs-identifier">ixs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-383"></a><span>  </span><a name="local-6989586621679522627"><a href="#local-6989586621679522627"><span class="hs-identifier">instD</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.Relational.Query.TH.html#defineHasPrimaryKeyInstanceWithConfig"><span class="hs-identifier hs-var">defineHasPrimaryKeyInstanceWithConfig</span></a><span> </span><a href="#local-6989586621679522622"><span class="hs-identifier hs-var">config</span></a><span> </span><a href="#local-6989586621679522623"><span class="hs-identifier hs-var">schema</span></a><span> </span><a href="#local-6989586621679522624"><span class="hs-identifier hs-var">table</span></a><span> </span><a href="#local-6989586621679522625"><span class="hs-identifier hs-var">keyType</span></a><span> </span><a href="#local-6989586621679522626"><span class="hs-identifier hs-var">ixs</span></a><span>
</span><a name="line-384"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679522628"><a href="#local-6989586621679522628"><span class="hs-identifier">recType</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">recordTemplate</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">recordConfig</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">nameConfig</span><span> </span><a href="#local-6989586621679522622"><span class="hs-identifier hs-var">config</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679522623"><span class="hs-identifier hs-var">schema</span></a><span> </span><a href="#local-6989586621679522624"><span class="hs-identifier hs-var">table</span></a><span>
</span><a name="line-385"></a><span>      </span><a name="local-6989586621679522629"><a href="#local-6989586621679522629"><span class="hs-identifier">tableE</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Database.Relational.Query.TH.html#tableVarExpDefault"><span class="hs-identifier hs-var">tableVarExpDefault</span></a><span> </span><a href="#local-6989586621679522624"><span class="hs-identifier hs-var">table</span></a><span>
</span><a name="line-386"></a><span>      </span><a name="local-6989586621679522630"><a href="#local-6989586621679522630"><span class="hs-identifier">relE</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Database.Relational.Query.TH.html#relationVarExp"><span class="hs-identifier hs-var">relationVarExp</span></a><span> </span><a href="#local-6989586621679522622"><span class="hs-identifier hs-var">config</span></a><span> </span><a href="#local-6989586621679522623"><span class="hs-identifier hs-var">schema</span></a><span> </span><a href="#local-6989586621679522624"><span class="hs-identifier hs-var">table</span></a><span>
</span><a name="line-387"></a><span>  </span><a name="local-6989586621679522631"><a href="#local-6989586621679522631"><span class="hs-identifier">sqlsD</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.Relational.Query.TH.html#defineSqlsWithPrimaryKeyDefault"><span class="hs-identifier hs-var">defineSqlsWithPrimaryKeyDefault</span></a><span> </span><a href="#local-6989586621679522624"><span class="hs-identifier hs-var">table</span></a><span> </span><a href="#local-6989586621679522625"><span class="hs-identifier hs-var">keyType</span></a><span> </span><a href="#local-6989586621679522628"><span class="hs-identifier hs-var">recType</span></a><span> </span><a href="#local-6989586621679522630"><span class="hs-identifier hs-var">relE</span></a><span> </span><a href="#local-6989586621679522629"><span class="hs-identifier hs-var">tableE</span></a><span>
</span><a name="line-388"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679522627"><span class="hs-identifier hs-var">instD</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679522631"><span class="hs-identifier hs-var">sqlsD</span></a><span>
</span><a name="line-389"></a><span>
</span><a name="line-390"></a><span class="hs-comment">-- | All templates about not-null key.</span><span>
</span><a name="line-391"></a><span class="hs-identifier">defineWithNotNullKeyWithConfig</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Relational.Query.Internal.Config.html#Config"><span class="hs-identifier hs-type">Config</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span>
</span><a name="line-392"></a><a name="defineWithNotNullKeyWithConfig"><a href="Database.Relational.Query.TH.html#defineWithNotNullKeyWithConfig"><span class="hs-identifier">defineWithNotNullKeyWithConfig</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Database.Relational.Query.TH.html#defineHasNotNullKeyInstanceWithConfig"><span class="hs-identifier hs-var">defineHasNotNullKeyInstanceWithConfig</span></a><span>
</span><a name="line-393"></a><span>
</span><a name="line-394"></a><span class="hs-comment">-- | Generate all templtes about table using specified naming rule.</span><span>
</span><a name="line-395"></a><span class="hs-identifier">defineTable</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Relational.Query.Internal.Config.html#Config"><span class="hs-identifier hs-type">Config</span></a><span>            </span><span class="hs-comment">-- ^ Configuration to generate query with</span><span>
</span><a name="line-396"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>            </span><span class="hs-comment">-- ^ Schema name string of Database</span><span>
</span><a name="line-397"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>            </span><span class="hs-comment">-- ^ Table name string of Database</span><span>
</span><a name="line-398"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Column names and types</span><span>
</span><a name="line-399"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span>            </span><span class="hs-comment">-- ^ derivings for Record type</span><span>
</span><a name="line-400"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span>             </span><span class="hs-comment">-- ^ Primary key index</span><span>
</span><a name="line-401"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Int</span><span>         </span><span class="hs-comment">-- ^ Not null key index</span><span>
</span><a name="line-402"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span>           </span><span class="hs-comment">-- ^ Result declarations</span><span>
</span><a name="line-403"></a><a name="defineTable"><a href="Database.Relational.Query.TH.html#defineTable"><span class="hs-identifier">defineTable</span></a></a><span> </span><a name="local-6989586621679522632"><a href="#local-6989586621679522632"><span class="hs-identifier">config</span></a></a><span> </span><a name="local-6989586621679522633"><a href="#local-6989586621679522633"><span class="hs-identifier">schema</span></a></a><span> </span><a name="local-6989586621679522634"><a href="#local-6989586621679522634"><span class="hs-identifier">table</span></a></a><span> </span><a name="local-6989586621679522635"><a href="#local-6989586621679522635"><span class="hs-identifier">columns</span></a></a><span> </span><a name="local-6989586621679522636"><a href="#local-6989586621679522636"><span class="hs-identifier">derives</span></a></a><span> </span><a name="local-6989586621679522637"><a href="#local-6989586621679522637"><span class="hs-identifier">primaryIxs</span></a></a><span> </span><a name="local-6989586621679522638"><a href="#local-6989586621679522638"><span class="hs-identifier">mayNotNullIdx</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-404"></a><span>  </span><a name="local-6989586621679522639"><a href="#local-6989586621679522639"><span class="hs-identifier">tblD</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.Relational.Query.TH.html#defineTableTypesAndRecord"><span class="hs-identifier hs-var">defineTableTypesAndRecord</span></a><span> </span><a href="#local-6989586621679522632"><span class="hs-identifier hs-var">config</span></a><span> </span><a href="#local-6989586621679522633"><span class="hs-identifier hs-var">schema</span></a><span> </span><a href="#local-6989586621679522634"><span class="hs-identifier hs-var">table</span></a><span> </span><a href="#local-6989586621679522635"><span class="hs-identifier hs-var">columns</span></a><span> </span><a href="#local-6989586621679522636"><span class="hs-identifier hs-var">derives</span></a><span>
</span><a name="line-405"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679522640"><a href="#local-6989586621679522640"><span class="hs-identifier">pairT</span></a></a><span> </span><a name="local-6989586621679522642"><a href="#local-6989586621679522642"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679522643"><a href="#local-6989586621679522643"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">appT</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">appT</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tupleT</span><span> </span><span class="hs-number">2</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679522642"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679522643"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-406"></a><span>      </span><a name="local-6989586621679522641"><a href="#local-6989586621679522641"><span class="hs-identifier">keyType</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl1'</span><span> </span><a href="#local-6989586621679522640"><span class="hs-identifier hs-var">pairT</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679522635"><span class="hs-identifier hs-var">columns</span></a><span> </span><span class="hs-operator hs-var">!!</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679522637"><span class="hs-identifier hs-var">primaryIxs</span></a><span>
</span><a name="line-407"></a><span>  </span><a name="local-6989586621679522645"><a href="#local-6989586621679522645"><span class="hs-identifier">primD</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679522637"><span class="hs-identifier hs-var">primaryIxs</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-408"></a><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-409"></a><span>    </span><a name="local-6989586621679522644"><a href="#local-6989586621679522644"><span class="hs-identifier">ixs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Relational.Query.TH.html#defineWithPrimaryKey"><span class="hs-identifier hs-var">defineWithPrimaryKey</span></a><span> </span><a href="#local-6989586621679522632"><span class="hs-identifier hs-var">config</span></a><span> </span><a href="#local-6989586621679522633"><span class="hs-identifier hs-var">schema</span></a><span> </span><a href="#local-6989586621679522634"><span class="hs-identifier hs-var">table</span></a><span> </span><a href="#local-6989586621679522641"><span class="hs-identifier hs-var">keyType</span></a><span> </span><a href="#local-6989586621679522644"><span class="hs-identifier hs-var">ixs</span></a><span>
</span><a name="line-410"></a><span>  </span><a name="local-6989586621679522647"><a href="#local-6989586621679522647"><span class="hs-identifier">nnD</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">maybeD</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679522646"><a href="#local-6989586621679522646"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Relational.Query.TH.html#defineWithNotNullKeyWithConfig"><span class="hs-identifier hs-var">defineWithNotNullKeyWithConfig</span></a><span> </span><a href="#local-6989586621679522632"><span class="hs-identifier hs-var">config</span></a><span> </span><a href="#local-6989586621679522633"><span class="hs-identifier hs-var">schema</span></a><span> </span><a href="#local-6989586621679522634"><span class="hs-identifier hs-var">table</span></a><span> </span><a href="#local-6989586621679522646"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679522638"><span class="hs-identifier hs-var">mayNotNullIdx</span></a><span>
</span><a name="line-411"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679522639"><span class="hs-identifier hs-var">tblD</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679522645"><span class="hs-identifier hs-var">primD</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679522647"><span class="hs-identifier hs-var">nnD</span></a><span>
</span><a name="line-412"></a><span>
</span><a name="line-413"></a><span>
</span><a name="line-414"></a><span class="hs-comment">-- | Unsafely inlining SQL string 'Query' in compile type.</span><span>
</span><a name="line-415"></a><span class="hs-identifier">unsafeInlineQuery</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span>   </span><span class="hs-comment">-- ^ Query parameter type</span><span>
</span><a name="line-416"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span>   </span><span class="hs-comment">-- ^ Query result type</span><span>
</span><a name="line-417"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>  </span><span class="hs-comment">-- ^ SQL string query to inline</span><span>
</span><a name="line-418"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">VarName</span><span> </span><span class="hs-comment">-- ^ Variable name for inlined query</span><span>
</span><a name="line-419"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Result declarations</span><span>
</span><a name="line-420"></a><a name="unsafeInlineQuery"><a href="Database.Relational.Query.TH.html#unsafeInlineQuery"><span class="hs-identifier">unsafeInlineQuery</span></a></a><span> </span><a name="local-6989586621679522648"><a href="#local-6989586621679522648"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679522649"><a href="#local-6989586621679522649"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679522650"><a href="#local-6989586621679522650"><span class="hs-identifier">sql</span></a></a><span> </span><a name="local-6989586621679522651"><a href="#local-6989586621679522651"><span class="hs-identifier">qVar'</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-421"></a><span>  </span><span class="hs-identifier hs-var">simpleValD</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">varName</span><span> </span><a href="#local-6989586621679522651"><span class="hs-identifier hs-var">qVar'</span></a><span class="hs-special">)</span><span>
</span><a name="line-422"></a><span>    </span><span class="hs-special">[</span><span class="hs-identifier">t</span><span class="hs-glyph">|</span><span> </span><a href="Database.Relational.Query.Type.html#Query"><span class="hs-identifier hs-type">Query</span></a><span> </span><a href="#local-6989586621679522648"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679522649"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-423"></a><span>    </span><span class="hs-special">[</span><span class="hs-glyph">|</span><span>  </span><a href="Database.Relational.Query.Type.html#unsafeTypedQuery"><span class="hs-identifier hs-var">unsafeTypedQuery</span></a><span> </span><span class="hs-operator">$</span><span class="hs-special">(</span><span class="hs-identifier hs-var">stringE</span><span> </span><a href="#local-6989586621679522650"><span class="hs-identifier hs-var">sql</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-424"></a><span>
</span><a name="line-425"></a><span class="hs-comment">-- | Extract param type and result type from defined Relation</span><span>
</span><a name="line-426"></a><span class="hs-identifier">reifyRelation</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Name</span><span>           </span><span class="hs-comment">-- ^ Variable name which has Relation type</span><span>
</span><a name="line-427"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Extracted param type and result type from Relation type</span><span>
</span><a name="line-428"></a><a name="reifyRelation"><a href="Database.Relational.Query.TH.html#reifyRelation"><span class="hs-identifier">reifyRelation</span></a></a><span> </span><a name="local-6989586621679522655"><a href="#local-6989586621679522655"><span class="hs-identifier">relVar</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-429"></a><span>  </span><a name="local-6989586621679522656"><a href="#local-6989586621679522656"><span class="hs-identifier">relInfo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">reify</span><span> </span><a href="#local-6989586621679522655"><span class="hs-identifier hs-var">relVar</span></a><span>
</span><a name="line-430"></a><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">unVarI</span><span> </span><a href="#local-6989586621679522656"><span class="hs-identifier hs-var">relInfo</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-431"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AppT</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AppT</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConT</span><span> </span><a name="local-6989586621679522666"><a href="#local-6989586621679522666"><span class="hs-identifier">prn</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679522667"><a href="#local-6989586621679522667"><span class="hs-identifier">p</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679522668"><a href="#local-6989586621679522668"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-432"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679522666"><span class="hs-identifier hs-var">prn</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-char">''Relation    -&gt;  return (p, r)
    _                        -&gt;
      fail $ &quot;expandRelation: Variable must have Relation type: &quot; ++ show relVar

-- | Inlining composed 'Query' in compile type.
inlineQuery :: Name         -- ^ Top-level variable name which has 'Relation' type
            -&gt; Relation p r -- ^ Object which has 'Relation' type
            -&gt; Config       -- ^ Configuration to generate SQL
            -&gt; QuerySuffix  -- ^ suffix SQL words
            -&gt; String       -- ^ Variable name to define as inlined query
            -&gt; Q [Dec]      -- ^ Result declarations
inlineQuery relVar rel config sufs qns = do
  (p, r) &lt;- reifyRelation relVar
  unsafeInlineQuery (return p) (return r)
    (relationalQuerySQL config rel sufs)
    (varCamelcaseName qns)

-- | Generate all templates against defined record like type constructor
--   other than depending on sql-value type.
makeRelationalRecordDefault :: Name    -- ^ Type constructor name
                            -&gt; Q [Dec] -- ^ Result declaration
makeRelationalRecordDefault recTypeName = do
  let recTypeConName = ConName recTypeName
  ((tyCon, dataCon), (mayNs, cts)) &lt;- Record.reifyRecordType recTypeName
  pw &lt;- Record.defineColumnOffsets recTypeConName cts
  cs &lt;- maybe
        (return [])
        (\ns -&gt; defineColumnsDefault recTypeConName
                [ ((nameBase n, ct), Nothing) | n  &lt;- ns  | ct &lt;- cts ])
        mayNs
  pc &lt;- defineProductConstructorInstance tyCon dataCon cts
  ct &lt;- [d| instance ShowConstantTermsSQL $tyCon |]
  return $ concat [pw, cs, pc, ct]
</span></pre></body></html>