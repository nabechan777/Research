<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><a name="line-4"></a><span>
</span><a name="line-5"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-6"></a><span class="hs-comment">-- Module      : Database.Record.TH</span><span>
</span><a name="line-7"></a><span class="hs-comment">-- Copyright   : 2013-2017 Kei Hibino</span><span>
</span><a name="line-8"></a><span class="hs-comment">-- License     : BSD3</span><span>
</span><a name="line-9"></a><span class="hs-comment">--</span><span>
</span><a name="line-10"></a><span class="hs-comment">-- Maintainer  : ex8k.hibino@gmail.com</span><span>
</span><a name="line-11"></a><span class="hs-comment">-- Stability   : experimental</span><span>
</span><a name="line-12"></a><span class="hs-comment">-- Portability : unknown</span><span>
</span><a name="line-13"></a><span class="hs-comment">--</span><span>
</span><a name="line-14"></a><span class="hs-comment">-- This module defines templates for Haskell record type and</span><span>
</span><a name="line-15"></a><span class="hs-comment">-- type class instances to map between list of untyped SQL type and Haskell record type.</span><span>
</span><a name="line-16"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">Record</span><span class="hs-operator">.</span><span class="hs-identifier">TH</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-17"></a><span>  </span><span class="hs-comment">-- * Generate all templates about record</span><span>
</span><a name="line-18"></a><span>  </span><a href="Database.Record.TH.html#defineRecord"><span class="hs-identifier hs-var">defineRecord</span></a><span class="hs-special">,</span><span>
</span><a name="line-19"></a><span>  </span><a href="Database.Record.TH.html#defineRecordWithConfig"><span class="hs-identifier hs-var">defineRecordWithConfig</span></a><span class="hs-special">,</span><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span>  </span><span class="hs-comment">-- * Table constraint specified by key</span><span>
</span><a name="line-22"></a><span>  </span><a href="Database.Record.TH.html#defineHasColumnConstraintInstance"><span class="hs-identifier hs-var">defineHasColumnConstraintInstance</span></a><span class="hs-special">,</span><span>
</span><a name="line-23"></a><span>  </span><a href="Database.Record.TH.html#defineHasPrimaryConstraintInstanceDerived"><span class="hs-identifier hs-var">defineHasPrimaryConstraintInstanceDerived</span></a><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>  </span><a href="Database.Record.TH.html#defineHasPrimaryKeyInstance"><span class="hs-identifier hs-var">defineHasPrimaryKeyInstance</span></a><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>  </span><a href="Database.Record.TH.html#defineHasNotNullKeyInstance"><span class="hs-identifier hs-var">defineHasNotNullKeyInstance</span></a><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span>  </span><span class="hs-comment">-- * Record type</span><span>
</span><a name="line-28"></a><span>  </span><a href="Database.Record.TH.html#defineRecordType"><span class="hs-identifier hs-var">defineRecordType</span></a><span class="hs-special">,</span><span>
</span><a name="line-29"></a><span>  </span><a href="Database.Record.TH.html#defineRecordTypeWithConfig"><span class="hs-identifier hs-var">defineRecordTypeWithConfig</span></a><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>
</span><a name="line-31"></a><span>  </span><span class="hs-comment">-- * Function declarations against defined record types</span><span>
</span><a name="line-32"></a><span>  </span><a href="Database.Record.TH.html#defineColumnOffsets"><span class="hs-identifier hs-var">defineColumnOffsets</span></a><span class="hs-special">,</span><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span>  </span><a href="Database.Record.TH.html#recordWidthTemplate"><span class="hs-identifier hs-var">recordWidthTemplate</span></a><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span>  </span><span class="hs-comment">-- * Reify</span><span>
</span><a name="line-37"></a><span>  </span><a href="Database.Record.TH.html#reifyRecordType"><span class="hs-identifier hs-var">reifyRecordType</span></a><span class="hs-special">,</span><span>
</span><a name="line-38"></a><span>
</span><a name="line-39"></a><span>  </span><span class="hs-comment">-- * Templates about record name</span><span>
</span><a name="line-40"></a><span>  </span><a href="Database.Record.TH.html#NameConfig"><span class="hs-identifier hs-type">NameConfig</span></a><span class="hs-special">,</span><span>  </span><a href="Database.Record.TH.html#defaultNameConfig"><span class="hs-identifier hs-var">defaultNameConfig</span></a><span class="hs-special">,</span><span>
</span><a name="line-41"></a><span>  </span><a href="Database.Record.TH.html#recordTypeName"><span class="hs-identifier hs-var">recordTypeName</span></a><span class="hs-special">,</span><span> </span><a href="Database.Record.TH.html#columnName"><span class="hs-identifier hs-var">columnName</span></a><span class="hs-special">,</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span>  </span><a href="Database.Record.TH.html#recordTemplate"><span class="hs-identifier hs-var">recordTemplate</span></a><span class="hs-special">,</span><span>
</span><a name="line-44"></a><span>
</span><a name="line-45"></a><span>  </span><a href="Database.Record.TH.html#columnOffsetsVarNameDefault"><span class="hs-identifier hs-var">columnOffsetsVarNameDefault</span></a><span class="hs-special">,</span><span>
</span><a name="line-46"></a><span>
</span><a name="line-47"></a><span>  </span><span class="hs-comment">-- * Not nullable single column type</span><span>
</span><a name="line-48"></a><span>  </span><a href="Database.Record.TH.html#deriveNotNullType"><span class="hs-identifier hs-var">deriveNotNullType</span></a><span class="hs-special">,</span><span>
</span><a name="line-49"></a><span>
</span><a name="line-50"></a><span>  </span><span class="hs-comment">-- * Template for tuple types</span><span>
</span><a name="line-51"></a><span>  </span><a href="Database.Record.InternalTH.html#defineTupleInstances"><span class="hs-identifier hs-var">defineTupleInstances</span></a><span class="hs-special">,</span><span>
</span><a name="line-52"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-53"></a><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC</span><span class="hs-operator">.</span><span class="hs-identifier">Generics</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">)</span><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Array</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Array</span><span class="hs-special">)</span><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Language</span><span class="hs-operator">.</span><span class="hs-identifier">Haskell</span><span class="hs-operator">.</span><span class="hs-identifier">TH</span><span class="hs-operator">.</span><span class="hs-identifier">Name</span><span class="hs-operator">.</span><span class="hs-identifier">CamelCase</span><span>
</span><a name="line-57"></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ConName</span><span class="hs-special">(</span><span class="hs-identifier">conName</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">VarName</span><span class="hs-special">(</span><span class="hs-identifier">varName</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-58"></a><span>   </span><span class="hs-identifier hs-var">conCamelcaseName</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">varCamelcaseName</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">varNameWithPrefix</span><span class="hs-special">,</span><span>
</span><a name="line-59"></a><span>   </span><span class="hs-identifier hs-var">toTypeCon</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">toDataCon</span><span class="hs-special">,</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Language</span><span class="hs-operator">.</span><span class="hs-identifier">Haskell</span><span class="hs-operator">.</span><span class="hs-identifier">TH</span><span class="hs-operator">.</span><span class="hs-identifier">Lib</span><span class="hs-operator">.</span><span class="hs-identifier">Extra</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">integralE</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">simpleValD</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">reportWarning</span><span class="hs-special">)</span><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Language</span><span class="hs-operator">.</span><span class="hs-identifier">Haskell</span><span class="hs-operator">.</span><span class="hs-identifier">TH</span><span class="hs-operator">.</span><span class="hs-identifier">Compat</span><span class="hs-operator">.</span><span class="hs-identifier">Data</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dataD'</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">unDataD</span><span class="hs-special">)</span><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Language</span><span class="hs-operator">.</span><span class="hs-identifier">Haskell</span><span class="hs-operator">.</span><span class="hs-identifier">TH</span><span>
</span><a name="line-63"></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Q</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nameBase</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">reify</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Info</span><span class="hs-special">(</span><span class="hs-identifier hs-var">TyConI</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Name</span><span class="hs-special">,</span><span>
</span><a name="line-64"></a><span>   </span><span class="hs-identifier hs-type">TypeQ</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">conT</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Con</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NormalC</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">RecC</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-65"></a><span>   </span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">,</span><span>
</span><a name="line-66"></a><span>   </span><span class="hs-identifier hs-type">ExpQ</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">conE</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">listE</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">sigE</span><span class="hs-special">,</span><span>
</span><a name="line-67"></a><span>   </span><span class="hs-identifier hs-var">recC</span><span class="hs-special">,</span><span>
</span><a name="line-68"></a><span>   </span><span class="hs-identifier hs-var">cxt</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">varStrictType</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">strictType</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">isStrict</span><span class="hs-special">)</span><span>
</span><a name="line-69"></a><span>
</span><a name="line-70"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Arrow</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">&amp;&amp;&amp;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-71"></a><span>
</span><a name="line-72"></a><span class="hs-keyword">import</span><span> </span><a href="Database.Record.html"><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">Record</span></a><span>
</span><a name="line-73"></a><span>  </span><span class="hs-special">(</span><a href="Database.Record.KeyConstraint.html#HasColumnConstraint"><span class="hs-identifier hs-type">HasColumnConstraint</span></a><span class="hs-special">(</span><a href="Database.Record.KeyConstraint.html#columnConstraint"><span class="hs-identifier hs-var">columnConstraint</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Database.Record.KeyConstraint.html#Primary"><span class="hs-identifier hs-type">Primary</span></a><span class="hs-special">,</span><span> </span><a href="Database.Record.KeyConstraint.html#NotNull"><span class="hs-identifier hs-type">NotNull</span></a><span class="hs-special">,</span><span>
</span><a name="line-74"></a><span>   </span><a href="Database.Record.KeyConstraint.html#HasKeyConstraint"><span class="hs-identifier hs-type">HasKeyConstraint</span></a><span class="hs-special">(</span><a href="Database.Record.KeyConstraint.html#keyConstraint"><span class="hs-identifier hs-var">keyConstraint</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Database.Record.KeyConstraint.html#derivedCompositePrimary"><span class="hs-identifier hs-var">derivedCompositePrimary</span></a><span class="hs-special">,</span><span>
</span><a name="line-75"></a><span>   </span><a href="Database.Record.Persistable.html#PersistableRecordWidth"><span class="hs-identifier hs-type">PersistableRecordWidth</span></a><span class="hs-special">,</span><span> </span><a href="Database.Record.Persistable.html#PersistableWidth"><span class="hs-identifier hs-type">PersistableWidth</span></a><span class="hs-special">(</span><a href="Database.Record.Persistable.html#persistableWidth"><span class="hs-identifier hs-var">persistableWidth</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-76"></a><span>   </span><a href="Database.Record.FromSql.html#FromSql"><span class="hs-identifier hs-type">FromSql</span></a><span class="hs-special">,</span><span> </span><a href="Database.Record.ToSql.html#ToSql"><span class="hs-identifier hs-type">ToSql</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-77"></a><span>
</span><a name="line-78"></a><span class="hs-keyword">import</span><span> </span><a href="Database.Record.KeyConstraint.html"><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">Record</span><span class="hs-operator">.</span><span class="hs-identifier">KeyConstraint</span></a><span>
</span><a name="line-79"></a><span>  </span><span class="hs-special">(</span><a href="Database.Record.KeyConstraint.html#unsafeSpecifyColumnConstraint"><span class="hs-identifier hs-var">unsafeSpecifyColumnConstraint</span></a><span class="hs-special">,</span><span> </span><a href="Database.Record.KeyConstraint.html#unsafeSpecifyNotNullValue"><span class="hs-identifier hs-var">unsafeSpecifyNotNullValue</span></a><span class="hs-special">,</span><span> </span><a href="Database.Record.KeyConstraint.html#unsafeSpecifyKeyConstraint"><span class="hs-identifier hs-var">unsafeSpecifyKeyConstraint</span></a><span class="hs-special">)</span><span>
</span><a name="line-80"></a><span class="hs-keyword">import</span><span> </span><a href="Database.Record.Persistable.html"><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">Record</span><span class="hs-operator">.</span><span class="hs-identifier">Persistable</span></a><span>
</span><a name="line-81"></a><span>  </span><span class="hs-special">(</span><a href="Database.Record.Persistable.html#runPersistableRecordWidth"><span class="hs-identifier hs-var">runPersistableRecordWidth</span></a><span class="hs-special">,</span><span>
</span><a name="line-82"></a><span>   </span><a href="Database.Record.Persistable.html#ProductConst"><span class="hs-identifier hs-type">ProductConst</span></a><span class="hs-special">,</span><span> </span><a href="Database.Record.Persistable.html#getProductConst"><span class="hs-identifier hs-var">getProductConst</span></a><span class="hs-special">,</span><span> </span><a href="Database.Record.Persistable.html#genericFieldOffsets"><span class="hs-identifier hs-var">genericFieldOffsets</span></a><span class="hs-special">)</span><span>
</span><a name="line-83"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Database.Record.Persistable.html"><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">Record</span><span class="hs-operator">.</span><span class="hs-identifier">Persistable</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Persistable</span><span>
</span><a name="line-84"></a><span class="hs-keyword">import</span><span> </span><a href="Database.Record.InternalTH.html"><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">Record</span><span class="hs-operator">.</span><span class="hs-identifier">InternalTH</span></a><span> </span><span class="hs-special">(</span><a href="Database.Record.InternalTH.html#defineTupleInstances"><span class="hs-identifier hs-var">defineTupleInstances</span></a><span class="hs-special">)</span><span>
</span><a name="line-85"></a><span>
</span><a name="line-86"></a><span>
</span><a name="line-87"></a><span class="hs-comment">-- | 'NameConfig' type to customize names of expanded record templates.</span><span>
</span><a name="line-88"></a><span class="hs-keyword">data</span><span> </span><a name="NameConfig"><a href="Database.Record.TH.html#NameConfig"><span class="hs-identifier">NameConfig</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-89"></a><span>  </span><a name="NameConfig"><a href="Database.Record.TH.html#NameConfig"><span class="hs-identifier">NameConfig</span></a></a><span>
</span><a name="line-90"></a><span>  </span><span class="hs-special">{</span><span> </span><a name="recordTypeName"><a href="Database.Record.TH.html#recordTypeName"><span class="hs-identifier">recordTypeName</span></a></a><span>  </span><span class="hs-glyph">::</span><span>  </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ConName</span><span>
</span><a name="line-91"></a><span>    </span><span class="hs-comment">-- ^ Make record type symbol name from schema name and table name in SQL</span><span>
</span><a name="line-92"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="columnName"><a href="Database.Record.TH.html#columnName"><span class="hs-identifier">columnName</span></a></a><span>      </span><span class="hs-glyph">::</span><span>  </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">VarName</span><span>
</span><a name="line-93"></a><span>    </span><span class="hs-comment">-- ^ Make column variable symbol name from table name and column name in SQL</span><span>
</span><a name="line-94"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-95"></a><span>
</span><a name="line-96"></a><span class="hs-comment">-- | Dummy show instance. Handy to define show instance recursively.</span><span>
</span><a name="line-97"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="Database.Record.TH.html#NameConfig"><span class="hs-identifier hs-type">NameConfig</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-98"></a><span>  </span><a name="local-8214565720323790731"><span class="hs-identifier">show</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-string">&quot;&lt;nameConfig&gt;&quot;</span><span>
</span><a name="line-99"></a><span>
</span><a name="line-100"></a><span class="hs-comment">-- | Default implementation of 'NameConfig' type.</span><span>
</span><a name="line-101"></a><span class="hs-comment">--   To customize this, use record update syntax.</span><span>
</span><a name="line-102"></a><span class="hs-identifier">defaultNameConfig</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Record.TH.html#NameConfig"><span class="hs-identifier hs-type">NameConfig</span></a><span>
</span><a name="line-103"></a><a name="defaultNameConfig"><a href="Database.Record.TH.html#defaultNameConfig"><span class="hs-identifier">defaultNameConfig</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-104"></a><span>  </span><a href="Database.Record.TH.html#NameConfig"><span class="hs-identifier hs-var">NameConfig</span></a><span>
</span><a name="line-105"></a><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">recordTypeName</span><span>  </span><span class="hs-glyph">=</span><span>  </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">conCamelcaseName</span><span>
</span><a name="line-106"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">columnName</span><span>      </span><span class="hs-glyph">=</span><span>  </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">varCamelcaseName</span><span>
</span><a name="line-107"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-108"></a><span>
</span><a name="line-109"></a><span class="hs-comment">-- | Record constructor templates from SQL table name 'String'.</span><span>
</span><a name="line-110"></a><span class="hs-identifier">recordTemplate</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Record.TH.html#NameConfig"><span class="hs-identifier hs-type">NameConfig</span></a><span>    </span><span class="hs-comment">-- ^ name rule config</span><span>
</span><a name="line-111"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>        </span><span class="hs-comment">-- ^ Schema name string in SQL</span><span>
</span><a name="line-112"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>        </span><span class="hs-comment">-- ^ Table name string in SQL</span><span>
</span><a name="line-113"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">TypeQ</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">ExpQ</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Record type and data constructor</span><span>
</span><a name="line-114"></a><a name="recordTemplate"><a href="Database.Record.TH.html#recordTemplate"><span class="hs-identifier">recordTemplate</span></a></a><span> </span><a name="local-6989586621679103574"><a href="#local-6989586621679103574"><span class="hs-identifier">config</span></a></a><span> </span><a name="local-6989586621679103575"><a href="#local-6989586621679103575"><span class="hs-identifier">scm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toTypeCon</span><span> </span><span class="hs-operator hs-var">&amp;&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">toDataCon</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">recordTypeName</span><span> </span><a href="#local-6989586621679103574"><span class="hs-identifier hs-var">config</span></a><span> </span><a href="#local-6989586621679103575"><span class="hs-identifier hs-var">scm</span></a><span>
</span><a name="line-115"></a><span>
</span><a name="line-116"></a><span class="hs-comment">-- | Variable expression of record column offset array.</span><span>
</span><a name="line-117"></a><span class="hs-identifier">columnOffsetsVarNameDefault</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Name</span><span>    </span><span class="hs-comment">-- ^ Table type name</span><span>
</span><a name="line-118"></a><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">VarName</span><span> </span><span class="hs-comment">-- ^ Result expression variable name</span><span>
</span><a name="line-119"></a><a name="columnOffsetsVarNameDefault"><a href="Database.Record.TH.html#columnOffsetsVarNameDefault"><span class="hs-identifier">columnOffsetsVarNameDefault</span></a></a><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">varNameWithPrefix</span><span class="hs-special">`</span><span> </span><span class="hs-string">&quot;columnOffsets&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">nameBase</span><span>
</span><a name="line-120"></a><span>
</span><a name="line-121"></a><span class="hs-comment">-- | Template of 'HasColumnConstraint' instance.</span><span>
</span><a name="line-122"></a><span class="hs-identifier">defineHasColumnConstraintInstance</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span>   </span><span class="hs-comment">-- ^ Type which represent constraint type</span><span>
</span><a name="line-123"></a><span>                                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span>   </span><span class="hs-comment">-- ^ Type constructor of record</span><span>
</span><a name="line-124"></a><span>                                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>     </span><span class="hs-comment">-- ^ Key index which specifies this constraint</span><span>
</span><a name="line-125"></a><span>                                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Result declaration template</span><span>
</span><a name="line-126"></a><a name="defineHasColumnConstraintInstance"><a href="Database.Record.TH.html#defineHasColumnConstraintInstance"><span class="hs-identifier">defineHasColumnConstraintInstance</span></a></a><span> </span><a name="local-6989586621679103576"><a href="#local-6989586621679103576"><span class="hs-identifier">constraint</span></a></a><span> </span><a name="local-6989586621679103577"><a href="#local-6989586621679103577"><span class="hs-identifier">typeCon</span></a></a><span> </span><a name="local-6989586621679103578"><a href="#local-6989586621679103578"><span class="hs-identifier">index</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-127"></a><span>  </span><span class="hs-special">[</span><span class="hs-identifier">d</span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">instance</span><span> </span><a href="Database.Record.KeyConstraint.html#HasColumnConstraint"><span class="hs-identifier hs-type">HasColumnConstraint</span></a><span> </span><a href="#local-6989586621679103576"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">constraint</span></a><span> </span><a href="#local-6989586621679103577"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">typeCon</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-128"></a><span>        </span><a name="columnConstraint"><a href="Database.Record.KeyConstraint.html#columnConstraint"><span class="hs-identifier">columnConstraint</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Database.Record.KeyConstraint.html#unsafeSpecifyColumnConstraint"><span class="hs-identifier hs-var">unsafeSpecifyColumnConstraint</span></a><span> </span><span class="hs-operator">$</span><span class="hs-special">(</span><span class="hs-identifier hs-var">integralE</span><span> </span><a href="#local-6989586621679103578"><span class="hs-identifier hs-var">index</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-129"></a><span>
</span><a name="line-130"></a><span class="hs-comment">-- | Template of 'HasKeyConstraint' instance.</span><span>
</span><a name="line-131"></a><span class="hs-identifier">defineHasPrimaryConstraintInstanceDerived</span><span> </span><span class="hs-glyph">::</span><span class="hs-identifier hs-type">TypeQ</span><span>    </span><span class="hs-comment">-- ^ Type constructor of record</span><span>
</span><a name="line-132"></a><span>                                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Result declaration template</span><span>
</span><a name="line-133"></a><a name="defineHasPrimaryConstraintInstanceDerived"><a href="Database.Record.TH.html#defineHasPrimaryConstraintInstanceDerived"><span class="hs-identifier">defineHasPrimaryConstraintInstanceDerived</span></a></a><span> </span><a name="local-6989586621679103582"><a href="#local-6989586621679103582"><span class="hs-identifier">typeCon</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-134"></a><span>  </span><span class="hs-special">[</span><span class="hs-identifier">d</span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">instance</span><span> </span><a href="Database.Record.KeyConstraint.html#HasKeyConstraint"><span class="hs-identifier hs-type">HasKeyConstraint</span></a><span> </span><a href="Database.Record.KeyConstraint.html#Primary"><span class="hs-identifier hs-type">Primary</span></a><span> </span><a href="#local-6989586621679103582"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">typeCon</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-135"></a><span>        </span><a name="keyConstraint"><a href="Database.Record.KeyConstraint.html#keyConstraint"><span class="hs-identifier">keyConstraint</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Database.Record.KeyConstraint.html#derivedCompositePrimary"><span class="hs-identifier hs-var">derivedCompositePrimary</span></a><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-136"></a><span>
</span><a name="line-137"></a><span class="hs-comment">-- | Template of 'HasColumnConstraint' 'Primary' instance.</span><span>
</span><a name="line-138"></a><span class="hs-identifier">defineHasPrimaryKeyInstance</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span>   </span><span class="hs-comment">-- ^ Type constructor of record</span><span>
</span><a name="line-139"></a><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- ^ Key index which specifies this constraint</span><span>
</span><a name="line-140"></a><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Declaration of primary key constraint instance</span><span>
</span><a name="line-141"></a><a name="defineHasPrimaryKeyInstance"><a href="Database.Record.TH.html#defineHasPrimaryKeyInstance"><span class="hs-identifier">defineHasPrimaryKeyInstance</span></a></a><span> </span><a name="local-6989586621679103584"><a href="#local-6989586621679103584"><span class="hs-identifier">typeCon</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679103585"><span class="hs-identifier hs-var">d</span></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-142"></a><span>  </span><a name="local-6989586621679103585"><a href="#local-6989586621679103585"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-143"></a><span>  </span><span class="hs-identifier">d</span><span> </span><span class="hs-special">[</span><a name="local-6989586621679103586"><a href="#local-6989586621679103586"><span class="hs-identifier">ix</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-144"></a><span>    </span><a name="local-6989586621679103587"><a href="#local-6989586621679103587"><span class="hs-identifier">col</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.Record.TH.html#defineHasColumnConstraintInstance"><span class="hs-identifier hs-var">defineHasColumnConstraintInstance</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier">t</span><span class="hs-glyph">|</span><span> </span><a href="Database.Record.KeyConstraint.html#Primary"><span class="hs-identifier hs-type">Primary</span></a><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679103584"><span class="hs-identifier hs-var">typeCon</span></a><span> </span><a href="#local-6989586621679103586"><span class="hs-identifier hs-var">ix</span></a><span>
</span><a name="line-145"></a><span>    </span><a name="local-6989586621679103588"><a href="#local-6989586621679103588"><span class="hs-identifier">comp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Database.Record.TH.html#defineHasPrimaryConstraintInstanceDerived"><span class="hs-identifier hs-var">defineHasPrimaryConstraintInstanceDerived</span></a><span> </span><a href="#local-6989586621679103584"><span class="hs-identifier hs-var">typeCon</span></a><span>
</span><a name="line-146"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679103587"><span class="hs-identifier hs-var">col</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679103588"><span class="hs-identifier hs-var">comp</span></a><span>
</span><a name="line-147"></a><span>  </span><span class="hs-identifier">d</span><span> </span><a name="local-6989586621679103589"><a href="#local-6989586621679103589"><span class="hs-identifier">ixs</span></a></a><span>  </span><span class="hs-glyph">=</span><span>
</span><a name="line-148"></a><span>    </span><span class="hs-special">[</span><span class="hs-identifier">d</span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">instance</span><span> </span><a href="Database.Record.KeyConstraint.html#HasKeyConstraint"><span class="hs-identifier hs-type">HasKeyConstraint</span></a><span> </span><a href="Database.Record.KeyConstraint.html#Primary"><span class="hs-identifier hs-type">Primary</span></a><span> </span><a href="#local-6989586621679103584"><span class="hs-operator hs-var">$</span><span class="hs-identifier hs-var">typeCon</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-149"></a><span>          </span><a name="keyConstraint"><a href="Database.Record.KeyConstraint.html#keyConstraint"><span class="hs-identifier">keyConstraint</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Database.Record.KeyConstraint.html#unsafeSpecifyKeyConstraint"><span class="hs-identifier hs-var">unsafeSpecifyKeyConstraint</span></a><span>
</span><a name="line-150"></a><span>                          </span><span class="hs-operator">$</span><span class="hs-special">(</span><span class="hs-identifier hs-var">listE</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">integralE</span><span> </span><a href="#local-6989586621679103592"><span class="hs-identifier hs-var">ix</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679103592"><a href="#local-6989586621679103592"><span class="hs-identifier">ix</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679103589"><span class="hs-identifier hs-var">ixs</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-151"></a><span>      </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-152"></a><span>
</span><a name="line-153"></a><span class="hs-comment">-- | Template of 'HasColumnConstraint' 'NotNull' instance.</span><span>
</span><a name="line-154"></a><span class="hs-identifier">defineHasNotNullKeyInstance</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span>   </span><span class="hs-comment">-- ^ Type constructor of record</span><span>
</span><a name="line-155"></a><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>     </span><span class="hs-comment">-- ^ Key index which specifies this constraint</span><span>
</span><a name="line-156"></a><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Declaration of not null key constraint instance</span><span>
</span><a name="line-157"></a><a name="defineHasNotNullKeyInstance"><a href="Database.Record.TH.html#defineHasNotNullKeyInstance"><span class="hs-identifier">defineHasNotNullKeyInstance</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-158"></a><span>  </span><a href="Database.Record.TH.html#defineHasColumnConstraintInstance"><span class="hs-identifier hs-var">defineHasColumnConstraintInstance</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier">t</span><span class="hs-glyph">|</span><span> </span><a href="Database.Record.KeyConstraint.html#NotNull"><span class="hs-identifier hs-type">NotNull</span></a><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-159"></a><span>
</span><a name="line-160"></a><span class="hs-comment">-- | Record type width expression template.</span><span>
</span><a name="line-161"></a><span class="hs-identifier">recordWidthTemplate</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span> </span><span class="hs-comment">-- ^ Record type constructor.</span><span>
</span><a name="line-162"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ExpQ</span><span>  </span><span class="hs-comment">-- ^ Expression to get record width.</span><span>
</span><a name="line-163"></a><a name="recordWidthTemplate"><a href="Database.Record.TH.html#recordWidthTemplate"><span class="hs-identifier">recordWidthTemplate</span></a></a><span> </span><a name="local-6989586621679103593"><a href="#local-6989586621679103593"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-164"></a><span>  </span><span class="hs-special">[</span><span class="hs-glyph">|</span><span> </span><a href="Database.Record.Persistable.html#runPersistableRecordWidth"><span class="hs-identifier hs-var">runPersistableRecordWidth</span></a><span>
</span><a name="line-165"></a><span>     </span><span class="hs-operator">$</span><span class="hs-special">(</span><span class="hs-identifier hs-var">sigE</span><span> </span><span class="hs-special">[</span><span class="hs-glyph">|</span><span> </span><a href="Database.Record.Persistable.html#persistableWidth"><span class="hs-identifier hs-var">persistableWidth</span></a><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">t</span><span class="hs-glyph">|</span><span> </span><a href="Database.Record.Persistable.html#PersistableRecordWidth"><span class="hs-identifier hs-type">PersistableRecordWidth</span></a><span> </span><span class="hs-operator">$</span><span class="hs-special">(</span><a href="#local-6989586621679103593"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-166"></a><span>   </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-167"></a><span>
</span><a name="line-168"></a><span class="hs-comment">-- | Column offset array and 'PersistableWidth' instance declaration.</span><span>
</span><a name="line-169"></a><span class="hs-identifier">defineColumnOffsets</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ConName</span><span> </span><span class="hs-comment">-- ^ Record type constructor.</span><span>
</span><a name="line-170"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TypeQ</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Types of record columns.</span><span>
</span><a name="line-171"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Declaration of 'PersistableWidth' instance.</span><span>
</span><a name="line-172"></a><a name="defineColumnOffsets"><a href="Database.Record.TH.html#defineColumnOffsets"><span class="hs-identifier">defineColumnOffsets</span></a></a><span> </span><a name="local-6989586621679103596"><a href="#local-6989586621679103596"><span class="hs-identifier">typeName'</span></a></a><span> </span><a name="local-6989586621679103597"><a href="#local-6989586621679103597"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-173"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679103598"><a href="#local-6989586621679103598"><span class="hs-identifier">ofsVar</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Database.Record.TH.html#columnOffsetsVarNameDefault"><span class="hs-identifier hs-var">columnOffsetsVarNameDefault</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">conName</span><span> </span><a href="#local-6989586621679103596"><span class="hs-identifier hs-var">typeName'</span></a><span>
</span><a name="line-174"></a><span>      </span><a name="local-6989586621679103599"><a href="#local-6989586621679103599"><span class="hs-identifier">widthIxE</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">integralE</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679103597"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-175"></a><span>  </span><a name="local-6989586621679103601"><a href="#local-6989586621679103601"><span class="hs-identifier">ar</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">simpleValD</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">varName</span><span> </span><a href="#local-6989586621679103598"><span class="hs-identifier hs-var">ofsVar</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">t</span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-type">Array</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-176"></a><span>        </span><span class="hs-special">[</span><span class="hs-glyph">|</span><span> </span><a href="Database.Record.Persistable.html#getProductConst"><span class="hs-identifier hs-var">getProductConst</span></a><span> </span><span class="hs-special">(</span><a href="Database.Record.Persistable.html#genericFieldOffsets"><span class="hs-identifier hs-var">genericFieldOffsets</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Database.Record.Persistable.html#ProductConst"><span class="hs-identifier hs-type">ProductConst</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Array</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-operator">$</span><span class="hs-special">(</span><span class="hs-identifier hs-var">toTypeCon</span><span> </span><a href="#local-6989586621679103596"><span class="hs-identifier hs-var">typeName'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-177"></a><span>  </span><a name="local-6989586621679103603"><a href="#local-6989586621679103603"><span class="hs-identifier">pw</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">d</span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">instance</span><span> </span><a href="Database.Record.Persistable.html#PersistableWidth"><span class="hs-identifier hs-type">PersistableWidth</span></a><span> </span><span class="hs-operator">$</span><span class="hs-special">(</span><span class="hs-identifier hs-var">toTypeCon</span><span> </span><a href="#local-6989586621679103596"><span class="hs-identifier hs-var">typeName'</span></a><span class="hs-special">)</span><span>
</span><a name="line-178"></a><span>          </span><span class="hs-glyph">|</span><span class="hs-special">]</span><span>
</span><a name="line-179"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679103601"><span class="hs-identifier hs-var">ar</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679103603"><span class="hs-identifier hs-var">pw</span></a><span>
</span><a name="line-180"></a><span>
</span><a name="line-181"></a><span class="hs-comment">-- | Record type declaration template.</span><span>
</span><a name="line-182"></a><span class="hs-identifier">defineRecordType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ConName</span><span>            </span><span class="hs-comment">-- ^ Name of the data type of table record type.</span><span>
</span><a name="line-183"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">VarName</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">TypeQ</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ List of columns in the table. Must be legal, properly cased record columns.</span><span>
</span><a name="line-184"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span>             </span><span class="hs-comment">-- ^ Deriving type class names.</span><span>
</span><a name="line-185"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span>            </span><span class="hs-comment">-- ^ The data type record declaration.</span><span>
</span><a name="line-186"></a><a name="defineRecordType"><a href="Database.Record.TH.html#defineRecordType"><span class="hs-identifier">defineRecordType</span></a></a><span> </span><a name="local-6989586621679103604"><a href="#local-6989586621679103604"><span class="hs-identifier">typeName'</span></a></a><span> </span><a name="local-6989586621679103605"><a href="#local-6989586621679103605"><span class="hs-identifier">columns</span></a></a><span> </span><a name="local-6989586621679103606"><a href="#local-6989586621679103606"><span class="hs-identifier">derives</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-187"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679103607"><a href="#local-6989586621679103607"><span class="hs-identifier">typeName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">conName</span><span> </span><a href="#local-6989586621679103604"><span class="hs-identifier hs-var">typeName'</span></a><span>
</span><a name="line-188"></a><span>      </span><a name="local-6989586621679103608"><a href="#local-6989586621679103608"><span class="hs-identifier">fld</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679103609"><a href="#local-6989586621679103609"><span class="hs-identifier">n</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679103610"><a href="#local-6989586621679103610"><span class="hs-identifier">tq</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">varStrictType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">varName</span><span> </span><a href="#local-6989586621679103609"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">strictType</span><span> </span><span class="hs-identifier hs-var">isStrict</span><span> </span><a href="#local-6989586621679103610"><span class="hs-identifier hs-var">tq</span></a><span class="hs-special">)</span><span>
</span><a name="line-189"></a><span>  </span><a name="local-6989586621679103611"><a href="#local-6989586621679103611"><span class="hs-identifier">derives1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="hs-char">''Generic `notElem` derives)
              then do reportWarning &quot;HRR needs Generic instance, please add ''Generic manually.&quot;
                      return $ ''Generic : derives
                      {- DROP this hack in future version ups. -}
              else    return   derives
  rec' &lt;- dataD' (cxt []) typeName [] [recC typeName (map fld columns)] derives1
  offs &lt;- defineColumnOffsets typeName' [ty | (_, ty) &lt;- columns]
  return $ rec' : offs

-- | Record type declaration template with configured names.
defineRecordTypeWithConfig :: NameConfig -&gt; String -&gt; String -&gt; [(String, TypeQ)] -&gt; [Name] -&gt; Q [Dec]
defineRecordTypeWithConfig config schema table columns =
  defineRecordType
  (recordTypeName config schema table)
  [ (columnName config schema n, t) | (n, t) &lt;- columns ]


-- | Default name of record construction function from SQL table name.
fromSqlNameDefault :: String -&gt; VarName
fromSqlNameDefault =  (`varNameWithPrefix` &quot;fromSqlOf&quot;)

-- | Default name of record decomposition function from SQL table name.
toSqlNameDefault :: String -&gt; VarName
toSqlNameDefault =  (`varNameWithPrefix` &quot;toSqlOf&quot;)

recordInfo' :: Info -&gt; Maybe ((TypeQ, ExpQ), (Maybe [Name], [TypeQ]))
recordInfo' =  d  where
  d (TyConI tcon) = do
    (_cxt, tcn, _bs, _mk, [r], _ds) &lt;- unDataD tcon
    case r of
      NormalC dcn ts   -&gt; Just ((conT tcn, conE dcn), (Nothing, [return t | (_, t) &lt;- ts]))
      RecC    dcn vts  -&gt; Just ((conT tcn, conE dcn), (Just ns, ts))
        where (ns, ts) = unzip [(n, return t) | (n, _, t) &lt;- vts]
      _                -&gt; Nothing
  d _                  =  Nothing

-- | Low-level reify interface for record type name.
reifyRecordType :: Name -&gt; Q ((TypeQ, ExpQ), (Maybe [Name], [TypeQ]))
reifyRecordType recTypeName = do
  tyConInfo   &lt;- reify recTypeName
  maybe
    (fail $ &quot;Defined record type constructor not found: &quot; ++ show recTypeName)
    return
    (recordInfo' tyConInfo)

-- | Record parser and printer instance templates for converting
--   between list of SQL type and Haskell record type.
definePersistableInstance :: TypeQ   -- ^ SQL value type.
                          -&gt; TypeQ   -- ^ Record type constructor.
                          -&gt; Q [Dec] -- ^ Instance declarations.
definePersistableInstance sqlType typeCon = do
  [d| instance FromSql $sqlType $typeCon
      instance ToSql $sqlType $typeCon
    |]

-- | All templates for record type.
defineRecord :: TypeQ              -- ^ SQL value type
             -&gt; ConName            -- ^ Record type name
             -&gt; [(VarName, TypeQ)] -- ^ Column schema
             -&gt; [Name]             -- ^ Record derivings
             -&gt; Q [Dec]            -- ^ Result declarations
defineRecord
  sqlValueType
  tyC
  columns drvs = do

  typ     &lt;- defineRecordType tyC columns drvs
  withSql &lt;- definePersistableInstance sqlValueType $ toTypeCon tyC
  return $ typ ++ withSql

-- | All templates for record type with configured names.
defineRecordWithConfig :: TypeQ             -- ^ SQL value type
                     -&gt; NameConfig        -- ^ name rule config
                     -&gt; String            -- ^ Schema name
                     -&gt; String            -- ^ Table name
                     -&gt; [(String, TypeQ)] -- ^ Column names and types
                     -&gt; [Name]            -- ^ Record derivings
                     -&gt; Q [Dec]           -- ^ Result declarations
defineRecordWithConfig sqlValueType config schema table columns derives = do
  typ     &lt;- defineRecordTypeWithConfig config schema table columns derives
  withSql &lt;- definePersistableInstance sqlValueType . fst $ recordTemplate config schema table

  return $ typ ++ withSql


-- | Templates for single column value type.
deriveNotNullType :: TypeQ -&gt; Q [Dec]
deriveNotNullType typeCon =
  [d| instance PersistableWidth $typeCon where
        persistableWidth = Persistable.unsafeValueWidth

      instance HasColumnConstraint NotNull $typeCon where
        columnConstraint = unsafeSpecifyNotNullValue
    |]
</span></pre></body></html>