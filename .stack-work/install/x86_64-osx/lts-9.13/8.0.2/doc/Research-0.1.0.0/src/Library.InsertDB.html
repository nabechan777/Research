<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleContexts, TemplateHaskell, DeriveGeneric #-}</span><span>
</span><a name="line-2"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Library</span><span class="hs-operator">.</span><span class="hs-identifier">InsertDB</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-3"></a><span>
</span><a name="line-4"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Applicative</span><span>
</span><a name="line-5"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">HDBC</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">commit</span><span class="hs-special">)</span><span>
</span><a name="line-6"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">HDBC</span><span class="hs-operator">.</span><span class="hs-identifier">PostgreSQL</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">connectPostgreSQL</span><span class="hs-special">)</span><span>
</span><a name="line-7"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">HDBC</span><span class="hs-operator">.</span><span class="hs-identifier">Record</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mapInsert</span><span class="hs-special">)</span><span>
</span><a name="line-8"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">HDBC</span><span class="hs-operator">.</span><span class="hs-identifier">Session</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">handleSqlError'</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">withConnectionIO'</span><span class="hs-special">)</span><span>
</span><a name="line-9"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Database.Relations.Student.html"><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">Relations</span><span class="hs-operator">.</span><span class="hs-identifier">Student</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Student</span><span>
</span><a name="line-10"></a><span class="hs-keyword">import</span><span> </span><a href="Database.Relations.Student.html"><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">Relations</span><span class="hs-operator">.</span><span class="hs-identifier">Student</span></a><span> </span><span class="hs-special">(</span><a href="Database.Relations.Student.html#Student"><span class="hs-identifier hs-type">Student</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Database.Relations.Student.html#insertStudent"><span class="hs-identifier hs-var">insertStudent</span></a><span class="hs-special">)</span><span>
</span><a name="line-11"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Database.Relations.Lecture.html"><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">Relations</span><span class="hs-operator">.</span><span class="hs-identifier">Lecture</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Lecture</span><span>
</span><a name="line-12"></a><span class="hs-keyword">import</span><span> </span><a href="Database.Relations.Lecture.html"><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">Relations</span><span class="hs-operator">.</span><span class="hs-identifier">Lecture</span></a><span> </span><span class="hs-special">(</span><a href="Database.Relations.Lecture.html#Lecture"><span class="hs-identifier hs-type">Lecture</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Database.Relations.Lecture.html#insertLecture"><span class="hs-identifier hs-var">insertLecture</span></a><span class="hs-special">)</span><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">Relational</span><span class="hs-operator">.</span><span class="hs-identifier">Query</span><span>
</span><a name="line-14"></a><span>
</span><a name="line-15"></a><span class="hs-identifier">students</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Database.Relations.Student.html#Student"><span class="hs-identifier hs-type">Student</span></a><span class="hs-special">]</span><span>
</span><a name="line-16"></a><a name="students"><a href="Library.InsertDB.html#students"><span class="hs-identifier">students</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">getZipList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679190988"><a href="#local-6989586621679190988"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679190989"><a href="#local-6989586621679190989"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621679190990"><a href="#local-6989586621679190990"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621679190991"><a href="#local-6989586621679190991"><span class="hs-identifier">d</span></a></a><span> </span><a name="local-6989586621679190992"><a href="#local-6989586621679190992"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621679190993"><a href="#local-6989586621679190993"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Relations.Student.html#Student"><span class="hs-identifier hs-var">Student</span></a><span> </span><a href="#local-6989586621679190988"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679190989"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-6989586621679190990"><span class="hs-identifier hs-var">c</span></a><span> </span><a href="#local-6989586621679190991"><span class="hs-identifier hs-var">d</span></a><span> </span><a href="#local-6989586621679190992"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="#local-6989586621679190993"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679190982"><span class="hs-identifier hs-var">studentIds</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="#local-6989586621679190983"><span class="hs-identifier hs-var">studentNumbers</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="#local-6989586621679190984"><span class="hs-identifier hs-var">names</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="#local-6989586621679190985"><span class="hs-identifier hs-var">faculties</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="#local-6989586621679190986"><span class="hs-identifier hs-var">departments</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="#local-6989586621679190987"><span class="hs-identifier hs-var">semesters</span></a><span>
</span><a name="line-17"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-18"></a><span>        </span><a name="local-6989586621679190982"><a href="#local-6989586621679190982"><span class="hs-identifier">studentIds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ZipList</span><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><a name="line-19"></a><span>        </span><a name="local-6989586621679190983"><a href="#local-6989586621679190983"><span class="hs-identifier">studentNumbers</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ZipList</span><span> </span><span class="hs-special">[</span><span class="hs-number">12345</span><span class="hs-special">,</span><span> </span><span class="hs-number">23421</span><span class="hs-special">,</span><span> </span><span class="hs-number">23453</span><span class="hs-special">]</span><span>
</span><a name="line-20"></a><span>        </span><a name="local-6989586621679190984"><a href="#local-6989586621679190984"><span class="hs-identifier">names</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ZipList</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;A&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;B&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;C&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-21"></a><span>        </span><a name="local-6989586621679190985"><a href="#local-6989586621679190985"><span class="hs-identifier">faculties</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ZipList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">cycle</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;&#12467;&#12531;&#12500;&#12517;&#12540;&#12479;&#29702;&#24037;&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-22"></a><span>        </span><a name="local-6989586621679190986"><a href="#local-6989586621679190986"><span class="hs-identifier">departments</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ZipList</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;&#12467;&#12531;&#12500;&#12517;&#12540;&#12479;&#12469;&#12452;&#12456;&#12531;&#12473;&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;&#12493;&#12483;&#12488;&#12527;&#12540;&#12463;&#12513;&#12487;&#12451;&#12450;&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;&#12452;&#12531;&#12486;&#12522;&#12472;&#12455;&#12531;&#12488;&#12471;&#12473;&#12486;&#12512;&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-23"></a><span>        </span><a name="local-6989586621679190987"><a href="#local-6989586621679190987"><span class="hs-identifier">semesters</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ZipList</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;8&#12475;&#12513;&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;6&#12475;&#12513;&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;4&#12475;&#12513;&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-24"></a><span>
</span><a name="line-25"></a><span class="hs-identifier">lectures</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Database.Relations.Lecture.html#Lecture"><span class="hs-identifier hs-type">Lecture</span></a><span class="hs-special">]</span><span>
</span><a name="line-26"></a><a name="lectures"><a href="Library.InsertDB.html#lectures"><span class="hs-identifier">lectures</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">getZipList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679191002"><a href="#local-6989586621679191002"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679191003"><a href="#local-6989586621679191003"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621679191004"><a href="#local-6989586621679191004"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621679191005"><a href="#local-6989586621679191005"><span class="hs-identifier">d</span></a></a><span> </span><a name="local-6989586621679191006"><a href="#local-6989586621679191006"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Database.Relations.Lecture.html#Lecture"><span class="hs-identifier hs-var">Lecture</span></a><span> </span><a href="#local-6989586621679191002"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679191003"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-6989586621679191004"><span class="hs-identifier hs-var">c</span></a><span> </span><a href="#local-6989586621679191005"><span class="hs-identifier hs-var">d</span></a><span> </span><a href="#local-6989586621679191006"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679190994"><span class="hs-identifier hs-var">lectureIds</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="#local-6989586621679190995"><span class="hs-identifier hs-var">names</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="#local-6989586621679190996"><span class="hs-identifier hs-var">periods</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="#local-6989586621679190997"><span class="hs-identifier hs-var">fields</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="#local-6989586621679190998"><span class="hs-identifier hs-var">credits</span></a><span>
</span><a name="line-27"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-28"></a><span>        </span><a name="local-6989586621679190994"><a href="#local-6989586621679190994"><span class="hs-identifier">lectureIds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ZipList</span><span> </span><span class="hs-special">[</span><span class="hs-number">1</span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><a name="line-29"></a><span>        </span><a name="local-6989586621679190995"><a href="#local-6989586621679190995"><span class="hs-identifier">names</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ZipList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">cycle</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;AAA&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;BBB&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;CCC&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;DDD&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-30"></a><span>        </span><a name="local-6989586621679190996"><a href="#local-6989586621679190996"><span class="hs-identifier">periods</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ZipList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">cycle</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679190999"><a href="#local-6989586621679190999"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679191000"><a href="#local-6989586621679191000"><span class="hs-identifier">y</span></a></a><span> </span><a name="local-6989586621679191001"><a href="#local-6989586621679191001"><span class="hs-identifier">z</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679190999"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679191000"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679191001"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;S&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;A&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-31"></a><span>                                                            </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;Mon&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;Tue&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;Wed&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;Thu&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;Fri&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;Sat&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;Sun&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-32"></a><span>                                                            </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;1&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;2&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;3&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;4&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;5&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-33"></a><span>        </span><a name="local-6989586621679190997"><a href="#local-6989586621679190997"><span class="hs-identifier">fields</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ZipList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">cycle</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;&#20849;&#36890;&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;&#23554;&#38272;&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-34"></a><span>        </span><a name="local-6989586621679190998"><a href="#local-6989586621679190998"><span class="hs-identifier">credits</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ZipList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">cycle</span><span> </span><span class="hs-special">[</span><span class="hs-number">2</span><span class="hs-special">]</span><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span class="hs-identifier">run</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-37"></a><a name="run"><a href="Library.InsertDB.html#run"><span class="hs-identifier">run</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">handleSqlError'</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">withConnectionIO'</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">connectPostgreSQL</span><span> </span><span class="hs-string">&quot;dbname=research&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679191007"><a href="#local-6989586621679191007"><span class="hs-identifier">conn</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-38"></a><span>    </span><span class="hs-identifier hs-var">mapInsert</span><span> </span><a href="#local-6989586621679191007"><span class="hs-identifier hs-var">conn</span></a><span> </span><a href="Database.Relations.Student.html#insertStudent"><span class="hs-identifier hs-var">insertStudent</span></a><span> </span><a href="Library.InsertDB.html#students"><span class="hs-identifier hs-var">students</span></a><span>
</span><a name="line-39"></a><span>    </span><span class="hs-identifier hs-var">mapInsert</span><span> </span><a href="#local-6989586621679191007"><span class="hs-identifier hs-var">conn</span></a><span> </span><a href="Database.Relations.Lecture.html#insertLecture"><span class="hs-identifier hs-var">insertLecture</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">take</span><span> </span><span class="hs-number">80</span><span> </span><a href="Library.InsertDB.html#lectures"><span class="hs-identifier hs-var">lectures</span></a><span>
</span><a name="line-40"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-41"></a></pre></body></html>