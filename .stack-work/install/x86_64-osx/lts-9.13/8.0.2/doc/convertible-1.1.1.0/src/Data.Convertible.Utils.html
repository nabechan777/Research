<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
Copyright (C) 2009-2011 John Goerzen &lt;jgoerzen@complete.org&gt;

All rights reserved.

For license and copyright information, see the file LICENSE

-}</span><span>
</span><a name="line-9"></a><span>
</span><a name="line-10"></a><span class="hs-comment">{- |
   Module     : Data.Convertible.Utils
   Copyright  : Copyright (C) 2009-2011 John Goerzen
   License    : BSD3

   Maintainer : John Goerzen &lt;jgoerzen@complete.org&gt;
   Stability  : provisional
   Portability: portable

-}</span><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Convertible</span><span class="hs-operator">.</span><span class="hs-identifier">Utils</span><span class="hs-special">(</span><a href="Data.Convertible.Utils.html#boundedConversion"><span class="hs-identifier hs-var">boundedConversion</span></a><span class="hs-special">,</span><span>
</span><a name="line-22"></a><span>                             </span><a href="Data.Convertible.Utils.html#convertVia"><span class="hs-identifier hs-var">convertVia</span></a><span>
</span><a name="line-23"></a><span>                             </span><span class="hs-special">)</span><span>
</span><a name="line-24"></a><span class="hs-keyword">where</span><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><a href="Data.Convertible.Base.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Convertible</span><span class="hs-operator">.</span><span class="hs-identifier">Base</span></a><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Typeable</span><span>
</span><a name="line-27"></a><span>
</span><a name="line-28"></a><span class="hs-comment">{- | Utility function to perform bounds checking as part of a conversion.

Does this be examining the bounds of the destination type, converting to the type of
the source via 'safeConvert', comparing to the source value.  Results in an error
if the conversion is out of bounds. -}</span><span>
</span><a name="line-33"></a><span class="hs-identifier">boundedConversion</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679035888"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bounded</span><span> </span><a href="#local-6989586621679035889"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="#local-6989586621679035888"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="#local-6989586621679035889"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Data.Convertible.Base.html#Convertible"><span class="hs-identifier hs-type">Convertible</span></a><span> </span><a href="#local-6989586621679035888"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">,</span><span>
</span><a name="line-34"></a><span>                      </span><a href="Data.Convertible.Base.html#Convertible"><span class="hs-identifier hs-type">Convertible</span></a><span> </span><a href="#local-6989586621679035889"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>                      </span><span class="hs-identifier hs-type">Typeable</span><span> </span><a href="#local-6989586621679035888"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Typeable</span><span> </span><a href="#local-6989586621679035889"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span>
</span><a name="line-36"></a><span>                     </span><span class="hs-special">(</span><a href="#local-6989586621679035888"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Convertible.Base.html#ConvertResult"><span class="hs-identifier hs-type">ConvertResult</span></a><span> </span><a href="#local-6989586621679035889"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Function to do the conversion</span><span>
</span><a name="line-37"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679035888"><span class="hs-identifier hs-type">a</span></a><span>                      </span><span class="hs-comment">-- ^ Input data</span><span>
</span><a name="line-38"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Convertible.Base.html#ConvertResult"><span class="hs-identifier hs-type">ConvertResult</span></a><span> </span><a href="#local-6989586621679035889"><span class="hs-identifier hs-type">b</span></a><span>        </span><span class="hs-comment">-- ^ Result</span><span>
</span><a name="line-39"></a><a name="boundedConversion"><a href="Data.Convertible.Utils.html#boundedConversion"><span class="hs-identifier">boundedConversion</span></a></a><span> </span><a name="local-6989586621679036307"><a href="#local-6989586621679036307"><span class="hs-identifier">func</span></a></a><span> </span><a name="local-6989586621679036308"><a href="#local-6989586621679036308"><span class="hs-identifier">inp</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-40"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679036309"><a href="#local-6989586621679036309"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679036307"><span class="hs-identifier hs-var">func</span></a><span> </span><a href="#local-6989586621679036308"><span class="hs-identifier hs-var">inp</span></a><span>
</span><a name="line-41"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679036310"><a href="#local-6989586621679036310"><span class="hs-identifier">smallest</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">asTypeOf</span><span> </span><span class="hs-identifier hs-var">minBound</span><span> </span><a href="#local-6989586621679036309"><span class="hs-identifier hs-var">result</span></a><span>
</span><a name="line-42"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679036311"><a href="#local-6989586621679036311"><span class="hs-identifier">biggest</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">asTypeOf</span><span> </span><span class="hs-identifier hs-var">maxBound</span><span> </span><a href="#local-6989586621679036309"><span class="hs-identifier hs-var">result</span></a><span>
</span><a name="line-43"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679036312"><a href="#local-6989586621679036312"><span class="hs-identifier">smallest'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Data.Convertible.Base.html#convert"><span class="hs-identifier hs-var">convert</span></a><span> </span><a href="#local-6989586621679036310"><span class="hs-identifier hs-var">smallest</span></a><span class="hs-special">)</span><span class="hs-glyph">::</span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-44"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679036313"><a href="#local-6989586621679036313"><span class="hs-identifier">biggest'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Data.Convertible.Base.html#convert"><span class="hs-identifier hs-var">convert</span></a><span> </span><a href="#local-6989586621679036311"><span class="hs-identifier hs-var">biggest</span></a><span class="hs-special">)</span><span class="hs-glyph">::</span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-45"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679036314"><a href="#local-6989586621679036314"><span class="hs-identifier">inp'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Data.Convertible.Base.html#convert"><span class="hs-identifier hs-var">convert</span></a><span> </span><a href="#local-6989586621679036308"><span class="hs-identifier hs-var">inp</span></a><span class="hs-special">)</span><span class="hs-glyph">::</span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-46"></a><span>       </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679036314"><span class="hs-identifier hs-var">inp'</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621679036312"><span class="hs-identifier hs-var">smallest'</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679036314"><span class="hs-identifier hs-var">inp'</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621679036313"><span class="hs-identifier hs-var">biggest'</span></a><span>
</span><a name="line-47"></a><span>          </span><span class="hs-keyword">then</span><span> </span><a href="Data.Convertible.Base.html#convError"><span class="hs-identifier hs-var">convError</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;Input value outside of bounds: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679036310"><span class="hs-identifier hs-var">smallest</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679036311"><span class="hs-identifier hs-var">biggest</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-48"></a><span>               </span><a href="#local-6989586621679036308"><span class="hs-identifier hs-var">inp</span></a><span>
</span><a name="line-49"></a><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679036309"><span class="hs-identifier hs-var">result</span></a><span>
</span><a name="line-50"></a><span>
</span><a name="line-51"></a><span class="hs-comment">{- | Useful for defining conversions that are implemented in terms of other
conversions via an intermediary type. Instead of:

&gt;instance Convertible CalendarTime POSIXTime where
&gt;    safeConvert a = do r &lt;- safeConvert a
&gt;                       safeConvert (r :: ClockTime)

we can now write:

&gt;instance Convertible CalendarTime POSIXTime where
&gt;    safeConvert = convertVia (undefined::ClockTime)

which does the same thing -- converts a CalendarTime to a ClockTime, then a
ClockTime to a POSIXTime, both using existing 'Convertible' instances.
 -}</span><span>
</span><a name="line-66"></a><span class="hs-identifier">convertVia</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Convertible.Base.html#Convertible"><span class="hs-identifier hs-type">Convertible</span></a><span> </span><a href="#local-6989586621679035885"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679035886"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Data.Convertible.Base.html#Convertible"><span class="hs-identifier hs-type">Convertible</span></a><span> </span><a href="#local-6989586621679035886"><span class="hs-identifier hs-type">b</span></a><span> </span><a href="#local-6989586621679035887"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-67"></a><span>              </span><a href="#local-6989586621679035886"><span class="hs-identifier hs-type">b</span></a><span>                 </span><span class="hs-comment">-- ^ Dummy data to establish intermediate type - can be undefined</span><span>
</span><a name="line-68"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679035885"><span class="hs-identifier hs-type">a</span></a><span>                 </span><span class="hs-comment">-- ^ Input value</span><span>
</span><a name="line-69"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Convertible.Base.html#ConvertResult"><span class="hs-identifier hs-type">ConvertResult</span></a><span> </span><a href="#local-6989586621679035887"><span class="hs-identifier hs-type">c</span></a><span>   </span><span class="hs-comment">-- ^ Result</span><span>
</span><a name="line-70"></a><a name="convertVia"><a href="Data.Convertible.Utils.html#convertVia"><span class="hs-identifier">convertVia</span></a></a><span> </span><a name="local-6989586621679036315"><a href="#local-6989586621679036315"><span class="hs-identifier">dummy</span></a></a><span> </span><a name="local-6989586621679036316"><a href="#local-6989586621679036316"><span class="hs-identifier">inp</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-71"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679036317"><a href="#local-6989586621679036317"><span class="hs-identifier">r1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.Convertible.Base.html#safeConvert"><span class="hs-identifier hs-var">safeConvert</span></a><span> </span><a href="#local-6989586621679036316"><span class="hs-identifier hs-var">inp</span></a><span>
</span><a name="line-72"></a><span>       </span><a href="Data.Convertible.Base.html#safeConvert"><span class="hs-identifier hs-var">safeConvert</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">asTypeOf</span><span> </span><a href="#local-6989586621679036317"><span class="hs-identifier hs-var">r1</span></a><span> </span><a href="#local-6989586621679036315"><span class="hs-identifier hs-var">dummy</span></a><span class="hs-special">)</span><span>
</span><a name="line-73"></a></pre></body></html>